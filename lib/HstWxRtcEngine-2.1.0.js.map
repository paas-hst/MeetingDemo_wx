{"version":3,"sources":["webpack://HstWxRtcEngine/webpack/bootstrap","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/applyDecoratedDescriptor.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/createClass.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/iterableToArray.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack://HstWxRtcEngine/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://HstWxRtcEngine/./node_modules/javascript-state-machine/lib/state-machine.js","webpack://HstWxRtcEngine/./src/common/common.js","webpack://HstWxRtcEngine/./src/common/enums.js","webpack://HstWxRtcEngine/./src/common/event-registry.js","webpack://HstWxRtcEngine/./src/common/hstRequest/interceptorsManage.js","webpack://HstWxRtcEngine/./src/common/hstRequest/request.js","webpack://HstWxRtcEngine/./src/common/logger.js","webpack://HstWxRtcEngine/./src/common/promise-handler.js","webpack://HstWxRtcEngine/./src/core/bbox.js","webpack://HstWxRtcEngine/./src/core/curve.js","webpack://HstWxRtcEngine/./src/core/vector.js","webpack://HstWxRtcEngine/./src/export/enums-export.js","webpack://HstWxRtcEngine/./src/export/media-export.js","webpack://HstWxRtcEngine/./src/export/message-export.js","webpack://HstWxRtcEngine/./src/export/online-export.js","webpack://HstWxRtcEngine/./src/export/platform-export.js","webpack://HstWxRtcEngine/./src/export/subevent-export.js","webpack://HstWxRtcEngine/./src/index.js","webpack://HstWxRtcEngine/./src/main/media/audio-manager.js","webpack://HstWxRtcEngine/./src/main/media/media-manager.js","webpack://HstWxRtcEngine/./src/main/media/share-manager.js","webpack://HstWxRtcEngine/./src/main/media/upload-manager.js","webpack://HstWxRtcEngine/./src/main/media/video-manager.js","webpack://HstWxRtcEngine/./src/main/media/white-board-manager.js","webpack://HstWxRtcEngine/./src/main/media/whiteBoard/Painter.js","webpack://HstWxRtcEngine/./src/main/media/whiteBoard/page-store.js","webpack://HstWxRtcEngine/./src/main/media/whiteBoard/render/render.js","webpack://HstWxRtcEngine/./src/main/media/whiteBoard/write/write.js","webpack://HstWxRtcEngine/./src/main/message/message-manager.js","webpack://HstWxRtcEngine/./src/main/online/online-manager.js","webpack://HstWxRtcEngine/./src/main/rtc-engine.js","webpack://HstWxRtcEngine/./src/main/util/draw.js","webpack://HstWxRtcEngine/./src/main/util/math.js","webpack://HstWxRtcEngine/./src/main/util/msg-dispatcher.js","webpack://HstWxRtcEngine/./src/main/util/new_webscoket.js","webpack://HstWxRtcEngine/./src/main/util/protocol-sender.js","webpack://HstWxRtcEngine/./src/main/util/store.js","webpack://HstWxRtcEngine/./src/main/util/tx-room.js"],"names":["resolutionArray","frameRateArray","lowBitRateTable","highBitRateTable","_getFrameRateIndex","frameRate","index","length","logger","warn","_getResolutionIndex","width","height","resolution","getBitRate","frameIndex","resolutionIndex","generateGUID","S4","Math","random","toString","substring","getAddrs","str","urlStrs","urlAddrs","split","addr","indexOf","detectOS","navigator","platform","String","userAgent","asyncWrapper","excutor","promise","Promise","resolve","then","tracelog","target","name","descriptor","oldValue","value","argString","i","arguments","JSON","stringify","trace","apply","getCtrlPoint","ps","a","b","pAx","parseInt","X","pAy","Y","last","pBx","pBy","pA","x","y","pB","getTrueLength","len","truelen","charCodeAt","cutString","leng","tlen","nlen","writeTextOnCanvas","ctx_2d","lineheight","bytelength","text","startleft","starttop","tl","fillText","substr","replace","preloadImage","canvas","url","callback","fail","img","createImage","src","complete","onload","console","log","onerror","getTempPath","success","wx","getImageInfo","result","path","stringToRGBA","strCL","opacity","R","slice","G","B","colorToNumber","color","charAt","stringToColor","sexadecimalCL","toLocaleUpperCase","BB","GG","RR","getEventPostfix","userId","mediaType","mediaId","checkParam","param","undefined","dealCanvasSize","getSystemInfoSync","windowWidth","windowHeight","ratio","MediaType","MediaOper","RecvState","Graphics","RecvMagicMode","EventResult","EventType","EVENT_INIT","EVENT_LOGIN","EVENT_LOGOUT","EVENT_JOIN_GROUP","EVENT_LEAVE_GROUP","EVENT_START_RCV_MEDIA","EVENT_STOP_RCV_MEDIA","EVENT_START_PUB_MEDIA","EVENT_STOP_PUB_MEDIA","EVENT_GET_ONLINE_USERS","EVENT_ONLINE_USERS_NOTIFY","EVENT_INVITE","EVENT_NOTICE_IGNORE_INVITE","EVENT_REPLY_INVITE","EVENT_CANCEL_INVITE","EVENT_NOTICE_CANCEL_INVITE","EVENT_CREATE_WHITE_BOARD","EVENT_CLOSE_WHITE_BOARD","DisplayMode","DBWZ","DBSY","DBSF","ProxyEventType","CREATE_CHANNEL","CREATE_CHANNEL_SUCCESS","BUSINESS_MESSAGE","CONNECT_ERROR","fillStyle","SOLID","L_SLASH","GRID","IN_GRID","R_SLASH","VERTICAL","HORIZONTAL","fillMode","EMPTY","FILL_WITH_BORDER","FILL_NO_BORDER","on","eventName","context","_registry","eventEntry","events","callbacks","push","_triggerCachedEvents","off","allEvents","Object","keys","l","event","retain","j","k","callbackItem","trigger","args","call","_triggerEvents","InterceptorsManage","handlers","onFulField","onRejected","HstRequest","interceptors","request","response","config","chain","sendMessge","bind","forEach","interceptor","unshift","shift","reject","eventRegistry","res","data","requestFn","Logger","info","_getFormatter","error","_dateFormat","fmt","date","Date","opt","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","regexp","RegExp","exec","padStart","hstRequest","use","NOADDR","retryConfig","num","max","err","promiseHandler","fn","Array","prototype","mathMin","min","mathMax","mathSin","sin","mathCos","cos","PI2","PI","start","vec2","end","extremity","fromPoints","points","p","left","right","top","bottom","fromLine","x0","y0","x1","y1","xDim","yDim","fromCubic","x2","y2","x3","y3","cubicExtrema","curve","cubicAt","n","Infinity","fromQuadratic","quadraticExtremum","quadraticAt","tx","ty","fromArc","rx","ry","startAngle","endAngle","anticlockwise","vec2Min","vec2Max","diff","abs","tmp","angle","mathPow","pow","mathSqrt","sqrt","EPSILON","EPSILON_NUMERIC","THREE_SQRT","ONE_THIRD","_v0","v2Create","_v1","_v2","isAroundZero","val","isNotAroundZero","p0","p1","p2","p3","t","onet","cubicDerivativeAt","cubicRootAt","roots","c","d","A","C","t1","disc","K","t2","discSqrt","Y1","Y2","T","theta","acos","ASqrt","t3","extrema","cubicSubdivide","out","p01","p12","p23","p012","p123","p0123","cubicProjectPoint","interval","prev","next","d1","d2","_t","v2DistSquare","quadraticDerivativeAt","quadraticRootAt","divider","quadraticSubdivide","quadraticProjectPoint","ArrayCtor","Float32Array","create","copy","v","clone","set","add","v1","v2","scaleAndAdd","sub","lenSquare","lengthSquare","mul","div","dot","scale","s","normalize","distance","dist","distanceSquare","distSquare","negate","lerp","applyTransform","m","initEnums","hstRtcEngine","SCREEN_SHARE","AUDIO","VIDEO","TRANSPARENT_DATA","WHITE_BOARD","OnlineType","OFFLINE","ONLINE","initMedia","startPublishMedia","params","mediaManager","stopPublishMedia","startReceiveMedia","stopReceiveMedia","setMediaRender","renderEle","unsetMediaRender","setSendMagicAudioValue","audioManager","setRecvMagicAudioMode","mode","createWhiteBoard","whiteBoardManger","closeWhiteBoard","getWhiteBoard","setWhiteBoardDisplayMode","setDisplayMode","rotateWhiteBoard","rotateAngle","switchWhiteBoard","switchWhiteBoardPage","curPage","needNotifyOthers","startUpload","startUploadDoc","initMessage","sendUserMsg","msgManger","sendGroupMsgWithWhiteList","sendGroupMsgWithBlackList","sendGroupMsg","initOnline","getOnlineUsers","onlineManager","invite","replyInvite","cancelInvite","initPlatform","HstEngine","init","rtcEngine","doInit","login","doLogin","joinGroup","groupId","doJoin","leaveGroup","doLeave","logout","doLogout","destroy","doDestroy","initSubscribe","HstRtcEngine","subEvent","unsubEvent","process","AudioManager","curMicDevId","curSpkDevId","audioMagicValue","recvMagicAudio","devId","setCurMicDevId","protocolSender","sendPublishMediaReq","START_PUBLISH","STOP_PUBLISH","sendRecvMediaReq","START_RECV","srcUserId","STOP_RECV","downPcMap","values","downPc","videoEle","setAudioSpeaker","upPcMap","pc","upTracks","track","sendSetAudioMagic","streamId","FOLLOW","ONLY_ORIGIN","ONLY_MAGIC","sinkId","setSinkId","audioConstraints","deviceId","audio","MediaManager","Map","restoreDownTracks","Store","msgDispatcher","addMsgHandler","onNotifyUserMediaState","onNotifyGroupMediaStates","onNotifyUserJoinGroup","onNotifyUserLeaveGroup","onRecvStreamRes","onNotifySendStreamRes","_onRestoreDownTrack","_doStartReceiveMedia","e","startPublishAudio","videoManager","startPublishVideo","shareManager","startScreenShare","boardManager","startPublishWhiteBoard","stopPublishAudio","stopPublishVideo","stopScreenShare","stopPublishWhiteBoard","startReceiveAudio","startReceiveVideo","startReceiveScreenShare","startReceiveWhiteBoard","stopReceiveAudio","stopReceiveVideo","stopReceiveScreenShare","stopReceiveWhiteBoard","setWhiteBoardRender","unsetWhiteBoardRender","videoParam","userInfo","setLocalVideoRender","setLocalScreenShareRender","findDownPcByUserMeida","srcObject","mediaStream","getTracks","stop","msg","socket","user_id","operation","media_type","stream_server","_getEventType","recv","media_id","group_id","streamServer","onStartRecvWhiteBoardRes","stream_id","streamToken","subscribe_token","onStopRecvWhiteBoardRes","SUCCESS","FAILED","send","sendNotifySendStreamRes","mediaName","media_description","media_name","restoring","groupUsers","user_info","user","media_info","media","group_media","ShareManager","screenShareStream","screenShareStreamRefCount","isCreatingStream","screenShareParam","bitRate","shareParam","setScreenShareParam","UploadManager","_onRecvOpenUploadMsg","_onRecvCloseUploadMsg","_onRecvTransCodeMsg","_init","startUpload_hook","sendOpenUpload","file_path","size","onStartUpload","uploadSuccess_hook","onUploadSuccess","startTransCode_hook","onStartTransCode","transCodeSuccess_hook","onTransCodeSuccess","failed_hook","onFiled","fileTempPath","file","file_name","file_size","upload_mode","check_code","CheckCode","appid","SrvAppID","link","SrvAddrLink","UserID","convert_file_path","Guid","toUpperCase","upLoadControl","code","bucket","end_point","access_id","signature","policy","key","guid","setTimeout","uploadFile","filePath","header","formData","statusCode","showToast","title","icon","sendUploadEnd","includes","board_name","id","sendTransCodeMsg","page","convert_counts","VideoManager","videoParamMap","defaultVideoParam","setVideoParam","WhiteboardManager","_onCreateWhiteBoardRes","_onCloseWhiteBoardRes","_onNotifyGetFileList","_onGetWhiteBoardFileUrlRes","_onNotifySwitchWhiteBoardRes","_onRestoreWhiteBoard","restoreWhiteBoards","board","parentEle","displayMode","displayParam","_doStartReceiveWhiteBoard","channel_id","selectMedia","whiteBoards","find","item","channelId","_updateMsgSeq","cacheFileUrlMap","cacheTempPathMap","board_type","lastIndexOf","sendCreateWhiteboardReq","board_id","sendCloseWhiteboardReq","rotate","sendGetWhiteBoardFullDataReq","switchBoard","sendRecvBoardFileList","switchBoardPage","pageStore","getConvertFilePath","UploaderManager","setRenderElement","Number","isInteger","_findWhiteBoard","parentWidth","parentHeight","canvasSizeChangeCallback","scaleRatio","canvasSizeChange","Painter","splice","close","arr","rootPath","fileUrls","get","httpsUrl","search","fileList","file_list","sendGetWhiteBoardFileUrlReq","EDIT_WHITE_BOARD","isClosing","isSelect","isRotate","isSwitchPage","render","firstFullData","write","canvasWidth","canvasHeight","canvasEle","canvasCtx","canvasLeft","canvasTop","sourcePaints","firstGetFullData","msg_seq_id","local_seq_id","seqId","MsgDispatcher","_editRes","_dealAmendData","_mouseMove","_pageChangeHandle","_moveGraph","_heartBeat","_dealFullData","_processLoginResp","_onConnectSuccess","websocket","hstWebSocket","createProxyConnect","backward_addr","handler","seq_id","closed","_onWebsocketClosed","_onWebsocketError","sendLoginRecvChannelReq","reconnectNum","reconnect","seq","_onWebsocketOpen","_showWhiteBoard","showRatio","toFixed","dataRatio","_refreshRender","_insertImage","_showWhiteBoardDbwz","_showWhiteBoardDbsy","_showWhiteBoardDbsf","screenWidth","screenHeigh","getContext","PageStore","Render","WriteBoard","_emptyCanvas","Error","boardInfo","clearRect","convertPath","count","handle","setInterval","wbManager","clearInterval","self","getCurPage","fullPath","toLowerCase","imgUrl","downloadFile","timeout","seal","tempFilePath","drawImage","_waitGetImageUrl","_drawImage","_drawAllPaint","paintObjs","findPagePaints","map","_drawPaint","type","pageData","paintObj","CURVE","paint","findPaintByGid","gid","dealAmendData","pageObj","pageChange","moveGraph","rotate_angle","cur_page","editConfig","edit_id","sendSwitchWhiteBoard","sendChangeWhiteBoardProperty","status","sendOpenEdit","setCurPage","intervalHandle","removeChild","concat","sync_end","_initCanvas","tryRestoreWhiteBoardRender","property","parse","user_data","rights_index","ex_name","boardName","rightIndex","getBoardName","totalPage","getPageCount","_checkMsgSeq","action","line_shape","LINE","MASK_CURVE","TEXT","GMOV","sendGraphMsg","sendPageInfoMsg","revokeStack","restoreStack","brush_size","shape","stack1","stack2","pop","graphType","pid","movePaint","_sendGraphMsg","_transrate","isEdit","boardData","paintMap","graphIdSeed","assign","items","current_pid","er","paintData","ox","oy","flag","point0","point1","isPointAt","rect","paints","isContain","graph","childrens","childRect","boundingRect","painter","_getFileUrl","obj","draw","addPaintObj","drawAmendData","amendPaintObj","deletePaintObj","repalcePaintObj","gmov","graphs","movePaintObj","beginPath","lineWidth","strokeStyle","closePath","stroke","parttern","getGraphId","graphChildren","moveStatus","registryTouchEvent","startId","moveId","endId","touchMoveStart","touchMoveEvent","touchMoveEnd","rateX","rateY","canvasDis","_calcXY","touches","ERASER","findPaintsByPoint","_storeStack","_createShapeObject","endx","floor","endy","drawBoundingRect","containPaintObj","groupBoundingRect","font","fontsize","ceil","offsetWidth","offsetHeight","MessageManager","_onRecvUserMsg","_onRecvGroupMsg","_onRecvServerAck","src_user_id","msgId","msg_id","sendUserMsgAck","sendGroupMsgAck","OnlineManager","cachedUserList","onGetOnlineUsersRes","onOnlineUsersNotify","onInviteRes","onNotifyInvite","onNotifyIgnoreInvite","onCancelInviteRes","onNotifyCancelInvite","business","_dealMsg","pageInfo","totalPages","page_info","total_pages","member_state_list","u","uid","onlineInfo","online_info","state","mutexType","mutex_type","customState","custom_state","extendInfo","extend_info","callee_info","calleeInfo","operate","userName","user_name","mainWebsocketChannelId","RtcEngine","StateMachine","transitions","from","to","registered","forceLogouted","kickedOut","hasLogin","methods","onWebSocketClosed","doRestore","onLeaveGroup","reinitialize","onLogout","onDestroy","appId","token","companyId","onLoginRes","txRoom","getLoginInfo","loginSuccess","sdkAppId","sdkAppID","userSig","accountType","loginFailed","onLogoutRes","logoutSuccess","logoutFailed","onJoinGroupRes","isPass","room_id","joinSuccess","serverRoomId","roomID","serverUserId","txRoomId","privateMapKey","joinFailed","createRoom","enterRoom","onLeaveGroupRes","leaveSuccess","leaveFailed","onForceLogout","onKickOut","onLogOut","sendKickOutRes","options","loginParams","osType","forceLogin","sendLoginReq","onDoInit","lifecycle","txRoomUrl","initFailed","serverDomain","initSuccess","onTransition","transition","onInitSuccess","accessUrl","onInitFailed","onDoLogin","buildGetProxyWayUrl","method","addrUrl","buildGetGateWayUrl","backwardAddr","onLoginSuccess","onLoginFailed","onDoJoin","sendJoinGroupReq","onJoinSuccess","onJoinFailed","onDoLeave","sendLeaveGroupReq","onLeaveSuccess","onLeaveFailed","onDoLogout","sendLogoutReq","onLogoutSuccess","onLogoutFailed","onDoDestroy","onRestoring","setLineDash","canv","lineType","width1","width2","fillCustom","clip","lineCap","bg_color","space","fillRect","moveTo","lineTo","fill","drawFillMode","fill_mode","bg_shape","line","ctrlP","bezierCurveTo","hasOwnProperty","textBaseline","indexLine","txt","cloudText","maxWidth","strArr","row","lineBreakNum","drawText","ctx","temp","rowTextArr","measureText","rectangle","mask_curve","arrow","drawLineArrow","fromX","fromY","toX","toY","headlen","arrowX","arrowY","atan2","angle1","angle2","topX","topY","botX","botY","save","restore","round_rect","radius","translate","arc","ellipse","r","ratioX","ratioY","pic","key2","insertSuccess","insertImage","maxAllowOffsetLength","dis","D","jiaoX","isNaN","getLengthOfTwoPoint","point2","handlerMap","HstWebSocket","curAddrUrl","allSocket","connected_hooks","closed_hooks","error_hooks","limitConnect","getTimer","proxyIndex","timer","lockReconnect","connectSocket","_eventBind","readyState","onOpen","_sendCreateProxyMsg","onClose","onMessage","store","onError","opened","_createWebsocket","clearTimeout","timerArray","getTime","ProtocolSender","channel_type","channelType","report_type","reportType","app_id","company_id","client_guid","os_type","force_login","registered_user","protocol_version","sdk_type","mediaOwner","media_owner","recvState","source_type","parmas","cli_seq_id","upload_id","checksum","client_id","bindId","stream_token","version","bind_id","description","pcId","pc_id","sdp","candidate","sdpMid","sdpMLineIndex","getClientId","param_type","param_value","zoom","mouse_posx","mouse_posy","scroll_posx","editId","is_select","dst_user_id","dstUserId","white_list","whiteList","black_list","blackList","sessionId","SDK_VERSION","TxRoom","requestNum","heart","heartBeatReq","requestSeq","requestTask","getSessionId","req","errCode","errMsg","message","abort","res_login","userID","roomType","roomInfo","heartBeat","clearRequest"],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,6E;;;;;;;;;;;AC9BA;AACA;;AAEA,wCAAwC,SAAS;AACjD;AACA;;AAEA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACXA,uBAAuB,mBAAO,CAAC,wFAAuB;;AAEtD;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACPA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA,6E;;;;;;;;;;;AChBA;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACLA;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACLA,wBAAwB,mBAAO,CAAC,0FAAwB;;AAExD,sBAAsB,mBAAO,CAAC,sFAAsB;;AAEpD,iCAAiC,mBAAO,CAAC,4GAAiC;;AAE1E,wBAAwB,mBAAO,CAAC,0FAAwB;;AAExD;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACbA,uBAAuB,mBAAO,CAAC,wFAAuB;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6E;;;;;;;;;;;ACZA;AACA,IAAI,IAAyD;AAC7D;AACA,MAAM,EAK6B;AACnC,CAAC;AACD,oCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,cAAc;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,0BAA0B,EAAE;AAC/D,yCAAyC,eAAe;AACxD;AACA;AACA;AACA;AACA;AACA,8DAA8D,+DAA+D;AAC7H;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA,aAAa,uBAAuB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,OAAO;AACP;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,qCAAqC,UAAU;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA,qCAAqC,UAAU;AAC/C;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA,OAAO;AACP;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,aAAa,mBAAmB;AAChC;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA,OAAO;AACP;AACA;;AAEA;;;AAGA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,iBAAiB,mCAAmC;AACpD,iBAAiB,mCAAmC;AACpD,iBAAiB,mCAAmC;AACpD,iBAAiB,mCAAmC;AACpD,iBAAiB;AACjB;AACA,GAAG;;AAEH;AACA;AACA,wCAAwC,uBAAuB,yBAAyB;AACxF;AACA;AACA,wCAAwC,6BAA6B,eAAe;AACpF;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,yBAAyB,aAAa;AACtC;AACA,yBAAyB,WAAW;AACpC,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,qCAAqC,UAAU;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,eAAe,yBAAyB;AACxC;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC,4BAA4B,+CAA+C;AAC3E;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA,CAAC;;AAED;;AAEA;;AAEA;;;AAGA,OAAO;AACP;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,6BAA6B;;AAE7B;;AAEA,kBAAkB;AAClB;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,qCAAqC,qBAAqB,kBAAkB;AAC5E,qCAAqC,sBAAsB,eAAe,EAAE;AAC5E,qCAAqC,sBAAsB,cAAc,GAAG;AAC5E,qCAAqC,2BAA2B,YAAY;;AAE5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,sCAAsC;AACtC;AACA,UAAU,UAAU;AACpB;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA,CAAC;;AAED;;AAEA;;AAEA;;;AAGA,OAAO;AACP;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G,8CAA8C,iEAAiE;AAC/G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,yBAAyB;AACzB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;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","file":"HstWxRtcEngine-2.1.0.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nmodule.exports = _applyDecoratedDescriptor;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\n\nvar iterableToArray = require(\"./iterableToArray.js\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;\nmodule.exports[\"default\"] = module.exports, module.exports.__esModule = true;","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachine\"] = factory();\n\telse\n\t\troot[\"StateMachine\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(target, sources) {\n  var n, source, key;\n  for(n = 1 ; n < arguments.length ; n++) {\n    source = arguments[n];\n    for(key in source) {\n      if (source.hasOwnProperty(key))\n        target[key] = source[key];\n    }\n  }\n  return target;\n}\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = {\n\n  build: function(target, config) {\n    var n, max, plugin, plugins = config.plugins;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (plugin.methods)\n        mixin(target, plugin.methods);\n      if (plugin.properties)\n        Object.defineProperties(target, plugin.properties);\n    }\n  },\n\n  hook: function(fsm, name, additional) {\n    var n, max, method, plugin,\n        plugins = fsm.config.plugins,\n        args    = [fsm.context];\n\n    if (additional)\n      args = args.concat(additional)\n\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n]\n      method = plugins[n][name]\n      if (method)\n        method.apply(plugin, args);\n    }\n  }\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2);\n\n//-------------------------------------------------------------------------------------------------\n\nfunction Config(options, StateMachine) {\n\n  options = options || {};\n\n  this.options     = options; // preserving original options can be useful (e.g visualize plugin)\n  this.defaults    = StateMachine.defaults;\n  this.states      = [];\n  this.transitions = [];\n  this.map         = {};\n  this.lifecycle   = this.configureLifecycle();\n  this.init        = this.configureInitTransition(options.init);\n  this.data        = this.configureData(options.data);\n  this.methods     = this.configureMethods(options.methods);\n\n  this.map[this.defaults.wildcard] = {};\n\n  this.configureTransitions(options.transitions || []);\n\n  this.plugins = this.configurePlugins(options.plugins, StateMachine.plugin);\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(Config.prototype, {\n\n  addState: function(name) {\n    if (!this.map[name]) {\n      this.states.push(name);\n      this.addStateLifecycleNames(name);\n      this.map[name] = {};\n    }\n  },\n\n  addStateLifecycleNames: function(name) {\n    this.lifecycle.onEnter[name] = camelize.prepended('onEnter', name);\n    this.lifecycle.onLeave[name] = camelize.prepended('onLeave', name);\n    this.lifecycle.on[name]      = camelize.prepended('on',      name);\n  },\n\n  addTransition: function(name) {\n    if (this.transitions.indexOf(name) < 0) {\n      this.transitions.push(name);\n      this.addTransitionLifecycleNames(name);\n    }\n  },\n\n  addTransitionLifecycleNames: function(name) {\n    this.lifecycle.onBefore[name] = camelize.prepended('onBefore', name);\n    this.lifecycle.onAfter[name]  = camelize.prepended('onAfter',  name);\n    this.lifecycle.on[name]       = camelize.prepended('on',       name);\n  },\n\n  mapTransition: function(transition) {\n    var name = transition.name,\n        from = transition.from,\n        to   = transition.to;\n    this.addState(from);\n    if (typeof to !== 'function')\n      this.addState(to);\n    this.addTransition(name);\n    this.map[from][name] = transition;\n    return transition;\n  },\n\n  configureLifecycle: function() {\n    return {\n      onBefore: { transition: 'onBeforeTransition' },\n      onAfter:  { transition: 'onAfterTransition'  },\n      onEnter:  { state:      'onEnterState'       },\n      onLeave:  { state:      'onLeaveState'       },\n      on:       { transition: 'onTransition'       }\n    };\n  },\n\n  configureInitTransition: function(init) {\n    if (typeof init === 'string') {\n      return this.mapTransition(mixin({}, this.defaults.init, { to: init, active: true }));\n    }\n    else if (typeof init === 'object') {\n      return this.mapTransition(mixin({}, this.defaults.init, init, { active: true }));\n    }\n    else {\n      this.addState(this.defaults.init.from);\n      return this.defaults.init;\n    }\n  },\n\n  configureData: function(data) {\n    if (typeof data === 'function')\n      return data;\n    else if (typeof data === 'object')\n      return function() { return data; }\n    else\n      return function() { return {};  }\n  },\n\n  configureMethods: function(methods) {\n    return methods || {};\n  },\n\n  configurePlugins: function(plugins, builtin) {\n    plugins = plugins || [];\n    var n, max, plugin;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (typeof plugin === 'function')\n        plugins[n] = plugin = plugin()\n      if (plugin.configure)\n        plugin.configure(this);\n    }\n    return plugins\n  },\n\n  configureTransitions: function(transitions) {\n    var i, n, transition, from, to, wildcard = this.defaults.wildcard;\n    for(n = 0 ; n < transitions.length ; n++) {\n      transition = transitions[n];\n      from  = Array.isArray(transition.from) ? transition.from : [transition.from || wildcard]\n      to    = transition.to || wildcard;\n      for(i = 0 ; i < from.length ; i++) {\n        this.mapTransition({ name: transition.name, from: from[i], to: to });\n      }\n    }\n  },\n\n  transitionFor: function(state, transition) {\n    var wildcard = this.defaults.wildcard;\n    return this.map[state][transition] ||\n           this.map[wildcard][transition];\n  },\n\n  transitionsFor: function(state) {\n    var wildcard = this.defaults.wildcard;\n    return Object.keys(this.map[state]).concat(Object.keys(this.map[wildcard]));\n  },\n\n  allStates: function() {\n    return this.states;\n  },\n\n  allTransitions: function() {\n    return this.transitions;\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = Config;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\nvar mixin      = __webpack_require__(0),\n    Exception  = __webpack_require__(6),\n    plugin     = __webpack_require__(1),\n    UNOBSERVED = [ null, [] ];\n\n//-------------------------------------------------------------------------------------------------\n\nfunction JSM(context, config) {\n  this.context   = context;\n  this.config    = config;\n  this.state     = config.init.from;\n  this.observers = [context];\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(JSM.prototype, {\n\n  init: function(args) {\n    mixin(this.context, this.config.data.apply(this.context, args));\n    plugin.hook(this, 'init');\n    if (this.config.init.active)\n      return this.fire(this.config.init.name, []);\n  },\n\n  is: function(state) {\n    return Array.isArray(state) ? (state.indexOf(this.state) >= 0) : (this.state === state);\n  },\n\n  isPending: function() {\n    return this.pending;\n  },\n\n  can: function(transition) {\n    return !this.isPending() && !!this.seek(transition);\n  },\n\n  cannot: function(transition) {\n    return !this.can(transition);\n  },\n\n  allStates: function() {\n    return this.config.allStates();\n  },\n\n  allTransitions: function() {\n    return this.config.allTransitions();\n  },\n\n  transitions: function() {\n    return this.config.transitionsFor(this.state);\n  },\n\n  seek: function(transition, args) {\n    var wildcard = this.config.defaults.wildcard,\n        entry    = this.config.transitionFor(this.state, transition),\n        to       = entry && entry.to;\n    if (typeof to === 'function')\n      return to.apply(this.context, args);\n    else if (to === wildcard)\n      return this.state\n    else\n      return to\n  },\n\n  fire: function(transition, args) {\n    return this.transit(transition, this.state, this.seek(transition, args), args);\n  },\n\n  transit: function(transition, from, to, args) {\n\n    var lifecycle = this.config.lifecycle,\n        changed   = this.config.options.observeUnchangedState || (from !== to);\n\n    if (!to)\n      return this.context.onInvalidTransition(transition, from, to);\n\n    if (this.isPending())\n      return this.context.onPendingTransition(transition, from, to);\n\n    this.config.addState(to);  // might need to add this state if it's unknown (e.g. conditional transition or goto)\n\n    this.beginTransit();\n\n    args.unshift({             // this context will be passed to each lifecycle event observer\n      transition: transition,\n      from:       from,\n      to:         to,\n      fsm:        this.context\n    });\n\n    return this.observeEvents([\n                this.observersForEvent(lifecycle.onBefore.transition),\n                this.observersForEvent(lifecycle.onBefore[transition]),\n      changed ? this.observersForEvent(lifecycle.onLeave.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onLeave[from]) : UNOBSERVED,\n                this.observersForEvent(lifecycle.on.transition),\n      changed ? [ 'doTransit', [ this ] ]                       : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter[to])   : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.on[to])        : UNOBSERVED,\n                this.observersForEvent(lifecycle.onAfter.transition),\n                this.observersForEvent(lifecycle.onAfter[transition]),\n                this.observersForEvent(lifecycle.on[transition])\n    ], args);\n  },\n\n  beginTransit: function()          { this.pending = true;                 },\n  endTransit:   function(result)    { this.pending = false; return result; },\n  failTransit:  function(result)    { this.pending = false; throw result;  },\n  doTransit:    function(lifecycle) { this.state = lifecycle.to;           },\n\n  observe: function(args) {\n    if (args.length === 2) {\n      var observer = {};\n      observer[args[0]] = args[1];\n      this.observers.push(observer);\n    }\n    else {\n      this.observers.push(args[0]);\n    }\n  },\n\n  observersForEvent: function(event) { // TODO: this could be cached\n    var n = 0, max = this.observers.length, observer, result = [];\n    for( ; n < max ; n++) {\n      observer = this.observers[n];\n      if (observer[event])\n        result.push(observer);\n    }\n    return [ event, result, true ]\n  },\n\n  observeEvents: function(events, args, previousEvent, previousResult) {\n    if (events.length === 0) {\n      return this.endTransit(previousResult === undefined ? true : previousResult);\n    }\n\n    var event     = events[0][0],\n        observers = events[0][1],\n        pluggable = events[0][2];\n\n    args[0].event = event;\n    if (event && pluggable && event !== previousEvent)\n      plugin.hook(this, 'lifecycle', args);\n\n    if (observers.length === 0) {\n      events.shift();\n      return this.observeEvents(events, args, event, previousResult);\n    }\n    else {\n      var observer = observers.shift(),\n          result = observer[event].apply(observer, args);\n      if (result && typeof result.then === 'function') {\n        return result.then(this.observeEvents.bind(this, events, args, event))\n                     .catch(this.failTransit.bind(this))\n      }\n      else if (result === false) {\n        return this.endTransit(false);\n      }\n      else {\n        return this.observeEvents(events, args, event, result);\n      }\n    }\n  },\n\n  onInvalidTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid in current state\", transition, from, to, this.state);\n  },\n\n  onPendingTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid while previous transition is still in progress\", transition, from, to, this.state);\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = JSM;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-----------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2),\n    plugin   = __webpack_require__(1),\n    Config   = __webpack_require__(3),\n    JSM      = __webpack_require__(4);\n\n//-----------------------------------------------------------------------------------------------\n\nvar PublicMethods = {\n  is:                  function(state)       { return this._fsm.is(state)                                     },\n  can:                 function(transition)  { return this._fsm.can(transition)                               },\n  cannot:              function(transition)  { return this._fsm.cannot(transition)                            },\n  observe:             function()            { return this._fsm.observe(arguments)                            },\n  transitions:         function()            { return this._fsm.transitions()                                 },\n  allTransitions:      function()            { return this._fsm.allTransitions()                              },\n  allStates:           function()            { return this._fsm.allStates()                                   },\n  onInvalidTransition: function(t, from, to) { return this._fsm.onInvalidTransition(t, from, to)              },\n  onPendingTransition: function(t, from, to) { return this._fsm.onPendingTransition(t, from, to)              },\n}\n\nvar PublicProperties = {\n  state: {\n    configurable: false,\n    enumerable:   true,\n    get: function() {\n      return this._fsm.state;\n    },\n    set: function(state) {\n      throw Error('use transitions to change state')\n    }\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nfunction StateMachine(options) {\n  return apply(this || {}, options);\n}\n\nfunction factory() {\n  var cstor, options;\n  if (typeof arguments[0] === 'function') {\n    cstor   = arguments[0];\n    options = arguments[1] || {};\n  }\n  else {\n    cstor   = function() { this._fsm.apply(this, arguments) };\n    options = arguments[0] || {};\n  }\n  var config = new Config(options, StateMachine);\n  build(cstor.prototype, config);\n  cstor.prototype._fsm.config = config; // convenience access to shared config without needing an instance\n  return cstor;\n}\n\n//-------------------------------------------------------------------------------------------------\n\nfunction apply(instance, options) {\n  var config = new Config(options, StateMachine);\n  build(instance, config);\n  instance._fsm();\n  return instance;\n}\n\nfunction build(target, config) {\n  if ((typeof target !== 'object') || Array.isArray(target))\n    throw Error('StateMachine can only be applied to objects');\n  plugin.build(target, config);\n  Object.defineProperties(target, PublicProperties);\n  mixin(target, PublicMethods);\n  mixin(target, config.methods);\n  config.allTransitions().forEach(function(transition) {\n    target[camelize(transition)] = function() {\n      return this._fsm.fire(transition, [].slice.call(arguments))\n    }\n  });\n  target._fsm = function() {\n    this._fsm = new JSM(this, config);\n    this._fsm.init(arguments);\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nStateMachine.version  = '3.0.1';\nStateMachine.factory  = factory;\nStateMachine.apply    = apply;\nStateMachine.defaults = {\n  wildcard: '*',\n  init: {\n    name: 'init',\n    from: 'none'\n  }\n}\n\n//===============================================================================================\n\nmodule.exports = StateMachine;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(message, transition, from, to, current) {\n  this.message    = message;\n  this.transition = transition;\n  this.from       = from;\n  this.to         = to;\n  this.current    = current;\n}\n\n\n/***/ })\n/******/ ]);\n});","import logger from \"./logger\"\r\n\r\n\r\n// Resolution array\r\nlet resolutionArray = [328*240, 480*360, 640*480, 800*600, 1280*720, 1440*900, 1920*1080];\r\n\r\n// Frame rate array\r\nlet frameRateArray = [5, 10, 15, 18, 20, 25, 30];\r\n\r\n// BitRate control table for h265/vp9\r\nlet lowBitRateTable = [\r\n// 5     10   15   18   20   25   30  (fps)\r\n  [130, 180, 220, 230, 240, 260, 290],    // 320*240\r\n  [157, 233, 277, 304, 336, 366, 431],    // 480*360\r\n  [220, 270, 330, 372, 392, 450, 520],    // 640*480\r\n  [230, 305, 393, 483, 505, 610, 725],    // 800*600\r\n  [229, 339, 489, 613, 630, 730, 910],    // 1280*720\r\n  [294, 498, 653, 823, 927, 1151, 1355],  // 1440*900\r\n  [370, 670, 870, 1058, 1150, 1410, 1530] // 1920*1080\r\n];\r\n\r\n// BitRate control table for h264/vp8\r\nlet highBitRateTable = [\r\n// 5     10   15   18   20   25   30  (fps)\r\n  [50, 100, 150, 180, 200, 250, 300],       // 320*240\r\n  [87, 173, 261, 314, 346, 434, 521],       // 480*360\r\n  [120, 240, 360, 432, 460, 600, 720],      // 640*480\r\n  [187, 375, 563, 675, 700, 900, 1125],     // 800*600\r\n  [239, 479, 719, 863, 900, 1100, 1400],    // 1280*720\r\n  [384, 768, 1153, 1383, 1537, 1921, 2305], // 1440*900\r\n  [480, 960, 1440, 1728, 1920, 2400, 3000]  // 1920*1080\r\n];\r\n\r\n/**\r\n * 获取帧率在帧率表的索引\r\n * @param {*} frameRate \r\n */\r\nfunction _getFrameRateIndex(frameRate) {\r\n  let index = 0;\r\n  for ( ; index < frameRateArray.length; index++) {\r\n    if (frameRate <= frameRateArray[index]) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  // 比最大的帧率还大\r\n  if (index === frameRateArray.length) {\r\n    logger.warn(\"Frame rate is too big, \", frameRate);\r\n    index--;\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\n/**\r\n * 获取分辨率在分辨率表的索引\r\n * @param {*} width \r\n * @param {*} height \r\n */\r\nfunction _getResolutionIndex(width, height) {\r\n  let resolution = width * height;\r\n\r\n  let index = 0;\r\n  for ( ; index < resolutionArray.length; index++) {\r\n    if (resolution <= resolutionArray[index]) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  // 比最大的分辨率还大\r\n  if (index === resolutionArray.length) {\r\n    logger.warn(\"Resolution is too big, \", width + \"*\" + height);\r\n    index--;\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\n/**\r\n * 根据视频的宽、高、帧率计算码率\r\n * @param {*} width \r\n * @param {*} height \r\n * @param {*} frameRate \r\n */\r\nexport function getBitRate(width, height, frameRate) {\r\n  let frameIndex = _getFrameRateIndex(frameRate);\r\n  let resolutionIndex = _getResolutionIndex(width, height);\r\n  \r\n  return highBitRateTable[resolutionIndex][frameIndex];\r\n}\r\n\r\n/**\r\n * 生成GUID\r\n */\r\nexport function generateGUID() {\r\n  function S4() {\r\n    return (((1+Math.random())*0x10000)|0).toString(16).substring(1);\r\n  }\r\n  return (S4()+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+\"-\"+S4()+S4()+S4());\r\n}\r\n\r\nexport function getAddrs (str, urlStrs) {\r\n  let urlAddrs = urlStrs.split(';')\r\n  for (let addr of urlAddrs) {\r\n    if (addr.indexOf(str) > -1) {\r\n      return addr;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * 检测操作系统类型\r\n */\r\nexport function detectOS() { \r\n  if ((navigator.platform == \"Win32\") || (navigator.platform == \"Windows\")) {\r\n    return \"windows\";\r\n  } else if ((navigator.platform == \"Mac68K\") \r\n    || (navigator.platform == \"MacPPC\") \r\n    || (navigator.platform == \"Macintosh\") \r\n    || (navigator.platform == \"MacIntel\")) {\r\n    return \"mac\";\r\n  } else if (String(navigator.platform).indexOf(\"Linux\") > -1) {\r\n    return \"linux\";\r\n  } else if (navigator.userAgent.indexOf('Android') > -1 \r\n    || navigator.userAgent.indexOf('Linux') > -1) {\r\n    return \"android\";\r\n  } else if (navigator.userAgent.indexOf('iPhone') > -1) {\r\n    return \"ios\";\r\n  } else {\r\n    return \"unknown\";\r\n  }\r\n}\r\n\r\n/**\r\n * 函数同步转异步包装器\r\n * @param {*} excutor 待执行函数\r\n */\r\nexport function asyncWrapper(excutor) {\r\n  let promise = new Promise(function(resolve) {\r\n    resolve();\r\n  });\r\n  promise.then(()=>{excutor()});\r\n}\r\n\r\n/**\r\n * 打印函数跟踪日志的装饰器\r\n * @param {*} target \r\n * @param {*} name \r\n * @param {*} descriptor \r\n */\r\nexport function tracelog(target, name, descriptor) {\r\n  var oldValue = descriptor.value;\r\n\r\n  descriptor.value = function() {\r\n    let argString = \"\";\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      if (argString) {\r\n        argString += \", \" + JSON.stringify(arguments[i])\r\n      } else {\r\n        argString += JSON.stringify(arguments[i])\r\n      }\r\n    }\r\n\r\n    if (argString) {\r\n      logger.trace(`${name}: ` + argString);\r\n    } else {\r\n      logger.trace(`\"${name}\"`);\r\n    }\r\n    \r\n    return oldValue.apply(this, arguments);\r\n  };\r\n\r\n  return descriptor;\r\n}\r\n\r\n// 两点确定三次贝塞尔曲线函数的两个控制点\r\nexport const getCtrlPoint = (ps, i, a, b) => {\r\n  if (!a || !b) {\r\n    a = 0.25;\r\n    b = 0.25;\r\n  }\r\n  // 处理两种极端情形\r\n  if (i < 1) {\r\n    var pAx = parseInt(ps[0].X) + (ps[1].X - ps[0].X) * a;\r\n    var pAy = parseInt(ps[0].Y) + (ps[1].Y - ps[0].Y) * a;\r\n  } else {\r\n    var pAx = parseInt(ps[i].X) + (ps[i + 1].X - ps[i - 1].X) * a;\r\n    var pAy = parseInt(ps[i].Y) + (ps[i + 1].Y - ps[i - 1].Y) * a;\r\n  }\r\n  if (i > ps.length - 3) {\r\n    var last = ps.length - 1\r\n    var pBx = parseInt(ps[last].X) - (ps[last].X - ps[last - 1].X) * b;\r\n    var pBy = parseInt(ps[last].Y) - (ps[last].Y - ps[last - 1].Y) * b;\r\n  } else {\r\n    var pBx = parseInt(ps[i + 1].X) - (ps[i + 2].X - ps[i].X) * b;\r\n    var pBy = parseInt(ps[i + 1].Y) - (ps[i + 2].Y - ps[i].Y) * b;\r\n  }\r\n  return {\r\n    pA: {\r\n      x: pAx,\r\n      y: pAy\r\n    },\r\n    pB: {\r\n      x: pBx,\r\n      y: pBy\r\n    }\r\n  }\r\n}\r\n\r\n// 获取字符串的真实长度（字节长度） \r\nconst getTrueLength = (str) => {\r\n  var len = str.length,\r\n    truelen = 0;\r\n  for (var x = 0; x < len; x++) {\r\n    if (str.charCodeAt(x) > 128) {\r\n      truelen += 2;\r\n    } else {\r\n      truelen += 1;\r\n    }\r\n  }\r\n  return truelen;\r\n}\r\n\r\n// 按字节长度截取字符串，返回substr截取位置  \r\nconst cutString = (str, leng) => {\r\n  var len = str.length,\r\n    tlen = len,\r\n    nlen = 0;\r\n  for (var x = 0; x < len; x++) {\r\n    if (str.charCodeAt(x) > 128) {\r\n      if (nlen + 2 < leng) {\r\n        nlen += 2;\r\n      } else {\r\n        tlen = x;\r\n        break;\r\n      }\r\n    } else {\r\n      if (nlen + 1 < leng) {\r\n        nlen += 1;\r\n      } else {\r\n        tlen = x;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return tlen;\r\n}\r\n//ctx_2d        getContext(\"2d\") 对象  \r\n//lineheight    段落文本行高  \r\n//bytelength    设置单字节文字一行内的数量  \r\n//text          写入画面的段落文本  \r\n//startleft     开始绘制文本的 x 坐标位置（相对于画布）  \r\n//starttop      开始绘制文本的 y 坐标位置（相对于画布）  \r\nexport const writeTextOnCanvas = (ctx_2d, lineheight, bytelength, text, startleft, starttop) => {\r\n  for (var i = 1; getTrueLength(text) > 0; i++) {\r\n    var tl = cutString(text, bytelength);\r\n    ctx_2d.fillText(text.substr(0, tl).replace(/^\\s+|\\s+$/, \"\"), startleft, (i - 1) * lineheight + starttop);\r\n    text = text.substr(tl);\r\n  }\r\n}\r\n\r\n/**\r\n * 预加载白板图片\r\n * @param {*} url \r\n * @param {*} callback \r\n * @param {*} n \r\n */\r\nexport const preloadImage = (canvas, url, callback, fail) => {\r\n  let img = canvas.createImage()\r\n  img.src = url\r\n  if (img.complete) {\r\n    callback(img)\r\n    return\r\n  }\r\n  img.onload = ()=> {\r\n    console.log(\"加载图片成功\")\r\n    callback && callback(img)\r\n  }\r\n  img.onerror = ()=> {\r\n    fail && fail()\r\n  }\r\n  // wx.downloadFile({\r\n  //   url: url,\r\n  //   success(res) {\r\n  //     if (res.statusCode === 200) {\r\n  //       callback(res.tempFilePath)\r\n  //     } else {\r\n  //       console.warn(\"Unexpected status code: \" + res.statusCode)\r\n  //     }\r\n  //   },\r\n  //   fail() {\r\n  //     logger.error(\"Download image failed: \" + url)\r\n  //     if (n > 5) return\r\n  //     n++;\r\n  //     preloadImage(url, callback, n);\r\n  //   }\r\n  // })\r\n  // let img = new Image()\r\n  // img.onload = () => {\r\n  //   callback && callback()\r\n  // }\r\n  // img.onerror = () => {\r\n  //   if (n > 10) return\r\n  //   n++\r\n  //   preloadImage(url, callback, n)\r\n  // }\r\n  // img.src = url\r\n}\r\n\r\nexport function getTempPath(url, success, fail) {\r\n  wx.getImageInfo({\r\n    src: url,\r\n    success: (result) => {\r\n      success && success(result.path)\r\n    },\r\n    fail: () => {\r\n      fail && fail()\r\n      console.warn(\"Get image info failed!\")\r\n    },\r\n  });\r\n}\r\n\r\nexport function stringToRGBA(strCL, opacity='1') {\r\n  var R = parseInt(strCL.slice(1, 3), 16)\r\n  var G = parseInt(strCL.slice(3, 5), 16)\r\n  var B = parseInt(strCL.slice(5, 7), 16)\r\n  return `rgba(${R}, ${G}, ${B}, ${opacity})`\r\n}\r\n\r\n/**\r\n * #00000 转换为 256x256x256x256的数字\r\n */\r\n export function colorToNumber (color) {\r\n  color = (color.charAt(0)==\"#\") ? color.substring(1,7): color\r\n  while (color.length < 8) {\r\n    color = 'f' + color\r\n  }\r\n  return parseInt(color, 16)\r\n}\r\n\r\n/**\r\n * 字符串到颜色的转换\r\n * @param {*} strCL \r\n */\r\nexport function stringToColor(strCL) {\r\n\tvar sexadecimalCL;\r\n\t// 判断十进制是整型还是字符串，字符串为负数十进制，整型为正数十进制\r\n\tif(typeof(strCL) == \"string\"){\r\n\t\tsexadecimalCL = (parseInt(strCL) >>> 0).toString(16).toLocaleUpperCase();\r\n\t}\r\n\telse{\r\n\t\tsexadecimalCL = parseInt(strCL).toString(16);\r\n\t}\r\n\twhile(sexadecimalCL.length < 6) {\r\n\t\tsexadecimalCL = \"0\" + sexadecimalCL;\r\n\t}\r\n\t// 前端color#RRGGBB，转换成客户端类型#BBGGRR\r\n\tvar BB = sexadecimalCL.substring(sexadecimalCL.length - 2);\r\n\tvar GG = sexadecimalCL.substring(sexadecimalCL.length - 4, sexadecimalCL.length - 2);\r\n\tvar RR = sexadecimalCL.substring(sexadecimalCL.length - 6, sexadecimalCL.length - 4);\r\n\treturn \"#\" + RR + GG + BB;\r\n}\r\n\r\n/**\r\n * 有些媒体事件，需要使用后缀进行隔离，否则可能会相互影响\r\n * @param {*} userId \r\n * @param {*} mediaType \r\n * @param {*} mediaId \r\n */\r\nexport function getEventPostfix(userId, mediaType, mediaId) {\r\n  if (userId) {\r\n    return \"_\" + userId + \"_\" + mediaType + \"_\" + mediaId;\r\n  } else {\r\n    return \"_\" + mediaType + \"_\" + mediaId;\r\n  }\r\n}\r\n\r\n/**\r\n * 判断参数是否合法\r\n * @param {} param \r\n */\r\nexport function checkParam(param) {\r\n  return param !== null && param !== undefined && param !== '';\r\n}\r\n\r\nexport function dealCanvasSize(width, height) {\r\n  const { windowWidth, windowHeight } = wx.getSystemInfoSync()\r\n  let ratio = width / height\r\n  if (width > windowWidth * 2) {\r\n    width = windowWidth * 2\r\n  }\r\n  if (width < windowWidth) {\r\n    width = windowWidth\r\n  }\r\n  height = width / ratio\r\n  if (height > windowHeight * 3) {\r\n    height = windowHeight * 3\r\n    width = height * ratio\r\n  }\r\n  return { width, height }\r\n}","\r\nexport var MediaType = {\r\n  \"SCREEN_SHARE\": 0,\r\n  \"AUDIO\": 1,\r\n  \"VIDEO\": 2,\r\n  \"WHITE_BOARD\": 4\r\n};\r\n\r\nexport var MediaOper = {\r\n  \"STOP_PUBLISH\": 0,\r\n  \"START_PUBLISH\": 1\r\n};\r\n\r\nexport var RecvState = {\r\n  \"STOP_RECV\": 0,\r\n  \"START_RECV\": 1\r\n};\r\n\r\nexport var Graphics = {\r\n  'LINE': 'line',\r\n  'CURVE': 'curve',\r\n  'TEXT': 'text',\r\n  'ERASER': 'eraser',\r\n  'MASK_CURVE': 'mask_curve'\r\n}\r\n\r\nexport var RecvMagicMode = {\r\n  \"FOLLOW\": 0,\r\n  \"ONLY_ORIGIN\": 1,\r\n  \"ONLY_MAGIC\": 2\r\n}\r\n\r\nexport var EventResult = {\r\n  \"SUCCESS\": 0,\r\n  \"FAILED\": 1,\r\n  \"NOADDR\": 1001\r\n}\r\n\r\nexport var EventType = {\r\n  EVENT_INIT                    : \"EVENT_INIT\",\r\n  EVENT_LOGIN                   : \"EVENT_LOGIN\",\r\n  EVENT_LOGOUT                  : \"EVENT_LOGOUT\",\r\n  EVENT_JOIN_GROUP              : \"EVENT_JOIN_GROUP\",\r\n  EVENT_LEAVE_GROUP             : \"EVENT_LEAVE_GROUP\",\r\n  EVENT_START_RCV_MEDIA         : \"EVENT_START_RECV_MEDIA\",\r\n  EVENT_STOP_RCV_MEDIA          : \"EVENT_STOP_RECV_MEDIA\",\r\n  EVENT_START_PUB_MEDIA         : \"EVENT_START_PUB_MEDIA\",\r\n  EVENT_STOP_PUB_MEDIA          : \"EVENT_STOP_PUB_MEDIA\",\r\n  EVENT_GET_ONLINE_USERS        : \"EVENT_GET_ONLINE_USERS\",\r\n  EVENT_ONLINE_USERS_NOTIFY     : \"EVENT_ONLINE_USERS_NOTIFY\",\r\n  EVENT_INVITE                  : \"EVENT_INVITE\",\r\n  EVENT_NOTICE_IGNORE_INVITE    : \"EVENT_NOTICE_IGNORE_INVITE\",\r\n  EVENT_REPLY_INVITE            : \"EVENT_REPLY_INVITE\",\r\n  EVENT_CANCEL_INVITE           : \"EVENT_CANCEL_INVITE\",\r\n  EVENT_NOTICE_CANCEL_INVITE    : \"EVENT_NOTICE_CANCEL_INVITE\",\r\n  EVENT_CREATE_WHITE_BOARD      : \"EVENT_CREATE_WHITE_BOARD\",\r\n  EVENT_CLOSE_WHITE_BOARD       : \"EVENT_CLOSE_WHITE_BOARD\"\r\n}\r\n\r\nexport var DisplayMode = {\r\n  DBWZ: 1,\r\n  DBSY: 2,\r\n  DBSF: 3\r\n}\r\n\r\nexport var ProxyEventType = {\r\n  CREATE_CHANNEL:               100,\r\n  CREATE_CHANNEL_SUCCESS:       101,\r\n  BUSINESS_MESSAGE:             103,\r\n  CONNECT_ERROR:                106,\r\n}\r\n\r\n// 填充样式\r\nexport const fillStyle = {\r\n  SOLID: 0, //实心填充\r\n  L_SLASH: 1, // 左斜线\r\n  GRID: 2, //网格\r\n  IN_GRID: 3, // 斜网格\r\n  R_SLASH: 4, // 右斜线\r\n  VERTICAL: 6, // 竖线\r\n  HORIZONTAL: 5\r\n};\r\n// 填充模式\r\nexport const fillMode = {\r\n  EMPTY: 0,\r\n  FILL_WITH_BORDER: 1, // 填充带边框\r\n  FILL_NO_BORDER: 2 // 填充不带边框\r\n}","// 基于Backbone.Events(Backbone.js 1.1.2)改造的事件注册中心，主要改造点如下：\r\n// 1）简化接口和实现，去除暂时用不到的接口和功能。\r\n// 2）支持事件缓存，确保事件不丢失\r\n\r\nconst slice = [].slice\r\n\r\n/**\r\n * 订阅事件\r\n * @param {*} eventName \r\n * @param {*} callback \r\n * @param {*} context \r\n */\r\nexport function on (eventName, callback, context) {\r\n  const _registry = this._registry || (this._registry = {})\r\n  const eventEntry = _registry[eventName] || (_registry[eventName] = {events: [], callbacks: []})\r\n  eventEntry.callbacks.push({ callback: callback, context: context })\r\n  _triggerCachedEvents(eventEntry, callback, context);\r\n  return this\r\n}\r\n\r\n/**\r\n * 取消订阅事件\r\n * @param {*} eventName \r\n * @param {*} callback \r\n * @param {*} context \r\n */\r\nexport function off (eventName, callback, context) {\r\n  // 都为空，表示删除所有注册事件\r\n  if (!eventName && !callback && !context) {\r\n    delete this._registry\r\n    return this\r\n  }\r\n  // 如果未指定事件，则遍历所有事件删除回调函数\r\n  const allEvents = eventName ? [eventName] : Object.keys(this._registry)\r\n  for (let i = 0, l = allEvents.length; i < l; i++) {\r\n    let event = allEvents[i]\r\n    const callbacks = this._registry[event] && this._registry[event].callbacks;\r\n    if (callbacks) {\r\n      const retain = this._registry[event].callbacks = []\r\n      if (callback || context) {\r\n        for (let j = 0, k = callbacks.length; j < k; j++) {\r\n          const callbackItem = callbacks[j]\r\n          if ((callback && callback !== callbackItem.callback) \r\n            || (context && context !== callbackItem.context)) {\r\n            retain.push(callbackItem)\r\n          }\r\n        }\r\n      }\r\n      if (!retain.length) {\r\n        delete this._registry[event];\r\n      }\r\n    } else {\r\n      console.warn(\"Empty callbacks of event: \" + event);\r\n    }\r\n  }\r\n  return this\r\n}\r\n\r\n/**\r\n * 触发事件\r\n * @param {*} eventName \r\n */\r\nexport function trigger (eventName) {\r\n  if (!this._registry) {\r\n    this._registry = {};\r\n  }\r\n  const args = slice.call(arguments, 1)\r\n  const eventEntry = this._registry[eventName] || (this._registry[eventName] = {events:[], callbacks:[]});\r\n  if (eventEntry.callbacks.length > 0) {\r\n    _triggerEvents(eventEntry, args, this)\r\n  } else {\r\n    if (eventEntry.events.length < 1024) {\r\n      eventEntry.events.push(args);\r\n    } else {\r\n      console.warn(\"Events queue is full, event: \" + eventName);\r\n    }\r\n  }\r\n  return this\r\n}\r\n\r\n/**\r\n * 触发缓存事件\r\n * @param {*} eventEntry \r\n * @param {*} callback \r\n * @param {*} context \r\n */\r\nfunction _triggerCachedEvents(eventEntry, callback, context) {\r\n  if (eventEntry.events.length > 0) {\r\n    for (const event of eventEntry.events) {\r\n      callback.apply(context || this, event);\r\n    }\r\n    eventEntry.events = [];\r\n  }\r\n}\r\n\r\n/**\r\n * 实时触发事件\r\n * @param {*} eventEntry \r\n * @param {*} args \r\n * @param {*} context \r\n */\r\nfunction _triggerEvents (eventEntry, args, context) {\r\n  let i = -1;\r\n  const l = eventEntry.callbacks.length;\r\n  while (++i < l) {\r\n    const callbackItem = eventEntry.callbacks[i];\r\n    callbackItem.callback.apply(callbackItem.context || context, args);\r\n  }\r\n}\r\n\r\nexport default {\r\n  on, off, trigger\r\n}\r\n","class InterceptorsManage {\r\n  constructor () {\r\n    this.handlers = []\r\n  }\r\n  use (onFulField, onRejected) {\r\n    this.handlers.push({\r\n      onFulField,\r\n      onRejected\r\n    })\r\n  }\r\n}\r\n\r\nexport default InterceptorsManage","import eventRegistry from \"../event-registry\";\r\nimport InterceptorsManage from \"./interceptorsManage\";\r\n/**\r\n * 仿照axios做的基于promise websocket请求对象 可以实现请求拦截\r\n * 请求参数: config {\r\n *  eventName // 事件名称\r\n *  requestFn // websocket 请求函数\r\n *  retryConfig: {\r\n *    num // 当前重试次数\r\n *    max // 最大重试次数\r\n *  }\r\n * }\r\n * 请求拦截器 interceptors.request.use()\r\n * 响应拦截器 interceptors.respone.use()\r\n */\r\n\r\nclass HstRequest {\r\n  constructor () {\r\n    this.interceptors = {\r\n      request: new InterceptorsManage(),\r\n      response: new InterceptorsManage()\r\n    } \r\n  }\r\n  request (config)   {\r\n    let chain = [this.sendMessge.bind(this),undefined];\r\n\r\n    this.interceptors.request.handlers.forEach(interceptor => {\r\n      chain.unshift(interceptor.onFulField,interceptor.onRejected);\r\n    })\r\n\r\n    this.interceptors.response.handlers.forEach(interceptor => {\r\n      chain.push(interceptor.onFulField, interceptor.onRejected)\r\n    })\r\n    let promise = Promise.resolve(config);\r\n    while (chain.length > 0){\r\n      promise = promise.then(chain.shift(),chain.shift());\r\n    }\r\n    return promise;\r\n  }\r\n\r\n  sendMessge( config ) {\r\n    return new Promise((resolve, reject) => {\r\n      eventRegistry.on(config.eventName, function(res) {\r\n        resolve({\r\n          data: res,\r\n          config\r\n        });\r\n      });\r\n      config.requestFn()\r\n    });\r\n  }\r\n}\r\nexport default HstRequest\r\n","/**\r\n * 自定义日志输出，主要是添加时间\r\n */\r\nclass Logger {\r\n  /**\r\n   * state级别日志，状态机专用\r\n   * @param {*} data \r\n   */\r\n  state(data) {\r\n    console.info(\"%c\" + this._getFormatter() + \" \" + data, \"color: #FF6347\");\r\n  }\r\n\r\n  /**\r\n   * trace级别日志\r\n   * @param {*} data \r\n   */\r\n  trace(data) {\r\n    console.info(\"%c\" + this._getFormatter() + \" \" + data, \"color: #008080\");\r\n    //console.info((new Error(\"backtrace\")).stack);\r\n  }\r\n\r\n  /**\r\n   * info级别日志\r\n   * @param {*} data \r\n   */\r\n  info(data) {\r\n    console.info(this._getFormatter() + \" \" + data);\r\n    //console.info((new Error(\"backtrace\")).stack);\r\n  }\r\n\r\n  /**\r\n   * warn级别日志\r\n   * @param {*} data \r\n   */\r\n  warn(data) {\r\n    console.warn(this._getFormatter() + \" \" + data);\r\n  }\r\n\r\n  /**\r\n   * error级别日志\r\n   * @param {*} data \r\n   */\r\n  error(data) {\r\n    console.error(this._getFormatter() + \" \" + data);\r\n  }\r\n\r\n  /**\r\n   * info级别日志别名\r\n   * @param {*} data \r\n   */\r\n  log(data) {\r\n    this.info(data);\r\n  }\r\n\r\n  /**\r\n   * 获取格式化时间\r\n   */\r\n  _getFormatter() {\r\n    return this._dateFormat(\"[YY-MM-DD HH:mm:SS.sss]\");\r\n  }\r\n\r\n  /**\r\n   * 时间格式化\r\n   * @param {*} fmt \r\n   */\r\n  _dateFormat(fmt) {\r\n    let date = new Date();\r\n    const opt = {\r\n      \"Y+\": date.getFullYear().toString(),        // 年\r\n      \"M+\": (date.getMonth() + 1).toString(),     // 月\r\n      \"D+\": date.getDate().toString(),            // 日\r\n      \"H+\": date.getHours().toString(),           // 时\r\n      \"m+\": date.getMinutes().toString(),         // 分\r\n      \"S+\": date.getSeconds().toString(),         // 秒\r\n      \"s+\": date.getMilliseconds().toString()     // 毫秒\r\n    };\r\n    for (let k in opt) {\r\n        let regexp = new RegExp(\"(\" + k + \")\").exec(fmt);\r\n        if (regexp) {\r\n          fmt = fmt.replace(regexp[1], (regexp[1].length == 1) ? (opt[k]) : (opt[k].padStart(regexp[1].length, \"0\")))\r\n        };\r\n    };\r\n    return fmt;\r\n  }  \r\n}\r\n\r\nexport default new Logger();","import eventRegistry from \"./event-registry\";\r\n\r\nimport HstRequest from \"./hstRequest/request\";\r\nimport { EventResult } from \"./enums\"\r\nimport logger from \"./logger\"\r\n\r\nlet hstRequest = new HstRequest()\r\n// websocket 请求拦截\r\nhstRequest.interceptors.response.use(({data, config}) => {\r\n  // 订阅事件\r\n  if (data === EventResult.NOADDR && config.retryConfig.num < config.retryConfig.max) {\r\n    config.retryConfig.num ++\r\n    logger.warn(`start retry receive media: ${config.retryConfig.num}`)\r\n    return hstRequest.request(config)\r\n  }\r\n  return data\r\n}, (err) => {\r\n})\r\n\r\n// 使用事件回调的方式来封装Promise以方便外部处理异步调用\r\nconst promiseHandler = function(eventName, fn) {\r\n  return new Promise((resolve, reject) => {\r\n    //FIXME：这里是否要考虑once场景\r\n    eventRegistry.on(eventName, function() {\r\n      // 第一个参数为异步调用的处理结果\r\n      let result = Array.prototype.shift.call(arguments);\r\n      if (parseInt(result) === 0) {\r\n        fn && fn.call(this);\r\n        resolve(...arguments);\r\n      } else {\r\n        reject(...arguments);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport {\r\n  promiseHandler,\r\n  hstRequest\r\n}\r\n","/**\r\n * @author Yi Shen(https://github.com/pissang)\r\n */\r\n\r\nimport * as vec2 from './vector';\r\nimport * as curve from './curve';\r\n\r\nvar mathMin = Math.min;\r\nvar mathMax = Math.max;\r\nvar mathSin = Math.sin;\r\nvar mathCos = Math.cos;\r\nvar PI2 = Math.PI * 2;\r\n\r\nvar start = vec2.create();\r\nvar end = vec2.create();\r\nvar extremity = vec2.create();\r\n\r\n/**\r\n * 从顶点数组中计算出最小包围盒，写入`min`和`max`中\r\n * @module zrender/core/bbox\r\n * @param {Array<Object>} points 顶点数组\r\n * @param {number} min\r\n * @param {number} max\r\n */\r\nexport function fromPoints(points, min, max) {\r\n    if (points.length === 0) {\r\n        return;\r\n    }\r\n    var p = points[0];\r\n    var left = p[0];\r\n    var right = p[0];\r\n    var top = p[1];\r\n    var bottom = p[1];\r\n    var i;\r\n\r\n    for (i = 1; i < points.length; i++) {\r\n        p = points[i];\r\n        left = mathMin(left, p[0]);\r\n        right = mathMax(right, p[0]);\r\n        top = mathMin(top, p[1]);\r\n        bottom = mathMax(bottom, p[1]);\r\n    }\r\n\r\n    min[0] = left;\r\n    min[1] = top;\r\n    max[0] = right;\r\n    max[1] = bottom;\r\n}\r\n\r\n/**\r\n * @memberOf module:zrender/core/bbox\r\n * @param {number} x0\r\n * @param {number} y0\r\n * @param {number} x1\r\n * @param {number} y1\r\n * @param {Array.<number>} min\r\n * @param {Array.<number>} max\r\n */\r\nexport function fromLine(x0, y0, x1, y1, min, max) {\r\n    min[0] = mathMin(x0, x1);\r\n    min[1] = mathMin(y0, y1);\r\n    max[0] = mathMax(x0, x1);\r\n    max[1] = mathMax(y0, y1);\r\n}\r\n\r\nvar xDim = [];\r\nvar yDim = [];\r\n/**\r\n * 从三阶贝塞尔曲线(p0, p1, p2, p3)中计算出最小包围盒，写入`min`和`max`中\r\n * @memberOf module:zrender/core/bbox\r\n * @param {number} x0\r\n * @param {number} y0\r\n * @param {number} x1\r\n * @param {number} y1\r\n * @param {number} x2\r\n * @param {number} y2\r\n * @param {number} x3\r\n * @param {number} y3\r\n * @param {Array.<number>} min\r\n * @param {Array.<number>} max\r\n */\r\nexport function fromCubic(\r\n    x0, y0, x1, y1, x2, y2, x3, y3, min, max\r\n) {\r\n    var cubicExtrema = curve.cubicExtrema;\r\n    var cubicAt = curve.cubicAt;\r\n    var i;\r\n    var n = cubicExtrema(x0, x1, x2, x3, xDim);\r\n    min[0] = Infinity;\r\n    min[1] = Infinity;\r\n    max[0] = -Infinity;\r\n    max[1] = -Infinity;\r\n\r\n    for (i = 0; i < n; i++) {\r\n        var x = cubicAt(x0, x1, x2, x3, xDim[i]);\r\n        min[0] = mathMin(x, min[0]);\r\n        max[0] = mathMax(x, max[0]);\r\n    }\r\n    n = cubicExtrema(y0, y1, y2, y3, yDim);\r\n    for (i = 0; i < n; i++) {\r\n        var y = cubicAt(y0, y1, y2, y3, yDim[i]);\r\n        min[1] = mathMin(y, min[1]);\r\n        max[1] = mathMax(y, max[1]);\r\n    }\r\n\r\n    min[0] = mathMin(x0, min[0]);\r\n    max[0] = mathMax(x0, max[0]);\r\n    min[0] = mathMin(x3, min[0]);\r\n    max[0] = mathMax(x3, max[0]);\r\n\r\n    min[1] = mathMin(y0, min[1]);\r\n    max[1] = mathMax(y0, max[1]);\r\n    min[1] = mathMin(y3, min[1]);\r\n    max[1] = mathMax(y3, max[1]);\r\n}\r\n\r\n/**\r\n * 从二阶贝塞尔曲线(p0, p1, p2)中计算出最小包围盒，写入`min`和`max`中\r\n * @memberOf module:zrender/core/bbox\r\n * @param {number} x0\r\n * @param {number} y0\r\n * @param {number} x1\r\n * @param {number} y1\r\n * @param {number} x2\r\n * @param {number} y2\r\n * @param {Array.<number>} min\r\n * @param {Array.<number>} max\r\n */\r\nexport function fromQuadratic(x0, y0, x1, y1, x2, y2, min, max) {\r\n    var quadraticExtremum = curve.quadraticExtremum;\r\n    var quadraticAt = curve.quadraticAt;\r\n    // Find extremities, where derivative in x dim or y dim is zero\r\n    var tx =\r\n        mathMax(\r\n            mathMin(quadraticExtremum(x0, x1, x2), 1), 0\r\n        );\r\n    var ty =\r\n        mathMax(\r\n            mathMin(quadraticExtremum(y0, y1, y2), 1), 0\r\n        );\r\n\r\n    var x = quadraticAt(x0, x1, x2, tx);\r\n    var y = quadraticAt(y0, y1, y2, ty);\r\n\r\n    min[0] = mathMin(x0, x2, x);\r\n    min[1] = mathMin(y0, y2, y);\r\n    max[0] = mathMax(x0, x2, x);\r\n    max[1] = mathMax(y0, y2, y);\r\n}\r\n\r\n/**\r\n * 从圆弧中计算出最小包围盒，写入`min`和`max`中\r\n * @method\r\n * @memberOf module:zrender/core/bbox\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} rx\r\n * @param {number} ry\r\n * @param {number} startAngle\r\n * @param {number} endAngle\r\n * @param {number} anticlockwise\r\n * @param {Array.<number>} min\r\n * @param {Array.<number>} max\r\n */\r\nexport function fromArc(\r\n    x, y, rx, ry, startAngle, endAngle, anticlockwise, min, max\r\n) {\r\n    var vec2Min = vec2.min;\r\n    var vec2Max = vec2.max;\r\n\r\n    var diff = Math.abs(startAngle - endAngle);\r\n\r\n\r\n    if (diff % PI2 < 1e-4 && diff > 1e-4) {\r\n        // Is a circle\r\n        min[0] = x - rx;\r\n        min[1] = y - ry;\r\n        max[0] = x + rx;\r\n        max[1] = y + ry;\r\n        return;\r\n    }\r\n\r\n    start[0] = mathCos(startAngle) * rx + x;\r\n    start[1] = mathSin(startAngle) * ry + y;\r\n\r\n    end[0] = mathCos(endAngle) * rx + x;\r\n    end[1] = mathSin(endAngle) * ry + y;\r\n\r\n    vec2Min(min, start, end);\r\n    vec2Max(max, start, end);\r\n\r\n    // Thresh to [0, Math.PI * 2]\r\n    startAngle = startAngle % (PI2);\r\n    if (startAngle < 0) {\r\n        startAngle = startAngle + PI2;\r\n    }\r\n    endAngle = endAngle % (PI2);\r\n    if (endAngle < 0) {\r\n        endAngle = endAngle + PI2;\r\n    }\r\n\r\n    if (startAngle > endAngle && !anticlockwise) {\r\n        endAngle += PI2;\r\n    }\r\n    else if (startAngle < endAngle && anticlockwise) {\r\n        startAngle += PI2;\r\n    }\r\n    if (anticlockwise) {\r\n        var tmp = endAngle;\r\n        endAngle = startAngle;\r\n        startAngle = tmp;\r\n    }\r\n\r\n    // var number = 0;\r\n    // var step = (anticlockwise ? -Math.PI : Math.PI) / 2;\r\n    for (var angle = 0; angle < endAngle; angle += Math.PI / 2) {\r\n        if (angle > startAngle) {\r\n            extremity[0] = mathCos(angle) * rx + x;\r\n            extremity[1] = mathSin(angle) * ry + y;\r\n\r\n            vec2Min(min, extremity, min);\r\n            vec2Max(max, extremity, max);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * 曲线辅助模块\r\n * @module zrender/core/curve\r\n * @author pissang(https://www.github.com/pissang)\r\n */\r\n\r\nimport {\r\n    create as v2Create,\r\n    distSquare as v2DistSquare\r\n} from './vector';\r\n\r\nvar mathPow = Math.pow;\r\nvar mathSqrt = Math.sqrt;\r\n\r\nvar EPSILON = 1e-8;\r\nvar EPSILON_NUMERIC = 1e-4;\r\n\r\nvar THREE_SQRT = mathSqrt(3);\r\nvar ONE_THIRD = 1 / 3;\r\n\r\n// 临时变量\r\nvar _v0 = v2Create();\r\nvar _v1 = v2Create();\r\nvar _v2 = v2Create();\r\n\r\nfunction isAroundZero(val) {\r\n    return val > -EPSILON && val < EPSILON;\r\n}\r\nfunction isNotAroundZero(val) {\r\n    return val > EPSILON || val < -EPSILON;\r\n}\r\n/**\r\n * 计算三次贝塞尔值\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} t\r\n * @return {number}\r\n */\r\nexport function cubicAt(p0, p1, p2, p3, t) {\r\n    var onet = 1 - t;\r\n    return onet * onet * (onet * p0 + 3 * t * p1)\r\n            + t * t * (t * p3 + 3 * onet * p2);\r\n}\r\n\r\n/**\r\n * 计算三次贝塞尔导数值\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} t\r\n * @return {number}\r\n */\r\nexport function cubicDerivativeAt(p0, p1, p2, p3, t) {\r\n    var onet = 1 - t;\r\n    return 3 * (\r\n        ((p1 - p0) * onet + 2 * (p2 - p1) * t) * onet\r\n        + (p3 - p2) * t * t\r\n    );\r\n}\r\n\r\n/**\r\n * 计算三次贝塞尔方程根，使用盛金公式\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} val\r\n * @param  {Array.<number>} roots\r\n * @return {number} 有效根数目\r\n */\r\nexport function cubicRootAt(p0, p1, p2, p3, val, roots) {\r\n    // Evaluate roots of cubic functions\r\n    var a = p3 + 3 * (p1 - p2) - p0;\r\n    var b = 3 * (p2 - p1 * 2 + p0);\r\n    var c = 3 * (p1 - p0);\r\n    var d = p0 - val;\r\n\r\n    var A = b * b - 3 * a * c;\r\n    var B = b * c - 9 * a * d;\r\n    var C = c * c - 3 * b * d;\r\n\r\n    var n = 0;\r\n\r\n    if (isAroundZero(A) && isAroundZero(B)) {\r\n        if (isAroundZero(b)) {\r\n            roots[0] = 0;\r\n        }\r\n        else {\r\n            var t1 = -c / b;  //t1, t2, t3, b is not zero\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        var disc = B * B - 4 * A * C;\r\n\r\n        if (isAroundZero(disc)) {\r\n            var K = B / A;\r\n            var t1 = -b / a + K;  // t1, a is not zero\r\n            var t2 = -K / 2;  // t2, t3\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n            if (t2 >= 0 && t2 <= 1) {\r\n                roots[n++] = t2;\r\n            }\r\n        }\r\n        else if (disc > 0) {\r\n            var discSqrt = mathSqrt(disc);\r\n            var Y1 = A * b + 1.5 * a * (-B + discSqrt);\r\n            var Y2 = A * b + 1.5 * a * (-B - discSqrt);\r\n            if (Y1 < 0) {\r\n                Y1 = -mathPow(-Y1, ONE_THIRD);\r\n            }\r\n            else {\r\n                Y1 = mathPow(Y1, ONE_THIRD);\r\n            }\r\n            if (Y2 < 0) {\r\n                Y2 = -mathPow(-Y2, ONE_THIRD);\r\n            }\r\n            else {\r\n                Y2 = mathPow(Y2, ONE_THIRD);\r\n            }\r\n            var t1 = (-b - (Y1 + Y2)) / (3 * a);\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n        }\r\n        else {\r\n            var T = (2 * A * b - 3 * a * B) / (2 * mathSqrt(A * A * A));\r\n            var theta = Math.acos(T) / 3;\r\n            var ASqrt = mathSqrt(A);\r\n            var tmp = Math.cos(theta);\r\n\r\n            var t1 = (-b - 2 * ASqrt * tmp) / (3 * a);\r\n            var t2 = (-b + ASqrt * (tmp + THREE_SQRT * Math.sin(theta))) / (3 * a);\r\n            var t3 = (-b + ASqrt * (tmp - THREE_SQRT * Math.sin(theta))) / (3 * a);\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n            if (t2 >= 0 && t2 <= 1) {\r\n                roots[n++] = t2;\r\n            }\r\n            if (t3 >= 0 && t3 <= 1) {\r\n                roots[n++] = t3;\r\n            }\r\n        }\r\n    }\r\n    return n;\r\n}\r\n\r\n/**\r\n * 计算三次贝塞尔方程极限值的位置\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {Array.<number>} extrema\r\n * @return {number} 有效数目\r\n */\r\nexport function cubicExtrema(p0, p1, p2, p3, extrema) {\r\n    var b = 6 * p2 - 12 * p1 + 6 * p0;\r\n    var a = 9 * p1 + 3 * p3 - 3 * p0 - 9 * p2;\r\n    var c = 3 * p1 - 3 * p0;\r\n\r\n    var n = 0;\r\n    if (isAroundZero(a)) {\r\n        if (isNotAroundZero(b)) {\r\n            var t1 = -c / b;\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                extrema[n++] = t1;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        var disc = b * b - 4 * a * c;\r\n        if (isAroundZero(disc)) {\r\n            extrema[0] = -b / (2 * a);\r\n        }\r\n        else if (disc > 0) {\r\n            var discSqrt = mathSqrt(disc);\r\n            var t1 = (-b + discSqrt) / (2 * a);\r\n            var t2 = (-b - discSqrt) / (2 * a);\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                extrema[n++] = t1;\r\n            }\r\n            if (t2 >= 0 && t2 <= 1) {\r\n                extrema[n++] = t2;\r\n            }\r\n        }\r\n    }\r\n    return n;\r\n}\r\n\r\n/**\r\n * 细分三次贝塞尔曲线\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} t\r\n * @param  {Array.<number>} out\r\n */\r\nexport function cubicSubdivide(p0, p1, p2, p3, t, out) {\r\n    var p01 = (p1 - p0) * t + p0;\r\n    var p12 = (p2 - p1) * t + p1;\r\n    var p23 = (p3 - p2) * t + p2;\r\n\r\n    var p012 = (p12 - p01) * t + p01;\r\n    var p123 = (p23 - p12) * t + p12;\r\n\r\n    var p0123 = (p123 - p012) * t + p012;\r\n    // Seg0\r\n    out[0] = p0;\r\n    out[1] = p01;\r\n    out[2] = p012;\r\n    out[3] = p0123;\r\n    // Seg1\r\n    out[4] = p0123;\r\n    out[5] = p123;\r\n    out[6] = p23;\r\n    out[7] = p3;\r\n}\r\n\r\n/**\r\n * 投射点到三次贝塞尔曲线上，返回投射距离。\r\n * 投射点有可能会有一个或者多个，这里只返回其中距离最短的一个。\r\n * @param {number} x0\r\n * @param {number} y0\r\n * @param {number} x1\r\n * @param {number} y1\r\n * @param {number} x2\r\n * @param {number} y2\r\n * @param {number} x3\r\n * @param {number} y3\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {Array.<number>} [out] 投射点\r\n * @return {number}\r\n */\r\nexport function cubicProjectPoint(\r\n    x0, y0, x1, y1, x2, y2, x3, y3,\r\n    x, y, out\r\n) {\r\n    // http://pomax.github.io/bezierinfo/#projections\r\n    var t;\r\n    var interval = 0.005;\r\n    var d = Infinity;\r\n    var prev;\r\n    var next;\r\n    var d1;\r\n    var d2;\r\n\r\n    _v0[0] = x;\r\n    _v0[1] = y;\r\n\r\n    // 先粗略估计一下可能的最小距离的 t 值\r\n    // PENDING\r\n    for (var _t = 0; _t < 1; _t += 0.05) {\r\n        _v1[0] = cubicAt(x0, x1, x2, x3, _t);\r\n        _v1[1] = cubicAt(y0, y1, y2, y3, _t);\r\n        d1 = v2DistSquare(_v0, _v1);\r\n        if (d1 < d) {\r\n            t = _t;\r\n            d = d1;\r\n        }\r\n    }\r\n    d = Infinity;\r\n\r\n    // At most 32 iteration\r\n    for (var i = 0; i < 32; i++) {\r\n        if (interval < EPSILON_NUMERIC) {\r\n            break;\r\n        }\r\n        prev = t - interval;\r\n        next = t + interval;\r\n        // t - interval\r\n        _v1[0] = cubicAt(x0, x1, x2, x3, prev);\r\n        _v1[1] = cubicAt(y0, y1, y2, y3, prev);\r\n\r\n        d1 = v2DistSquare(_v1, _v0);\r\n\r\n        if (prev >= 0 && d1 < d) {\r\n            t = prev;\r\n            d = d1;\r\n        }\r\n        else {\r\n            // t + interval\r\n            _v2[0] = cubicAt(x0, x1, x2, x3, next);\r\n            _v2[1] = cubicAt(y0, y1, y2, y3, next);\r\n            d2 = v2DistSquare(_v2, _v0);\r\n\r\n            if (next <= 1 && d2 < d) {\r\n                t = next;\r\n                d = d2;\r\n            }\r\n            else {\r\n                interval *= 0.5;\r\n            }\r\n        }\r\n    }\r\n    // t\r\n    if (out) {\r\n        out[0] = cubicAt(x0, x1, x2, x3, t);\r\n        out[1] = cubicAt(y0, y1, y2, y3, t);\r\n    }\r\n    // console.log(interval, i);\r\n    return mathSqrt(d);\r\n}\r\n\r\n/**\r\n * 计算二次方贝塞尔值\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} t\r\n * @return {number}\r\n */\r\nexport function quadraticAt(p0, p1, p2, t) {\r\n    var onet = 1 - t;\r\n    return onet * (onet * p0 + 2 * t * p1) + t * t * p2;\r\n}\r\n\r\n/**\r\n * 计算二次方贝塞尔导数值\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} t\r\n * @return {number}\r\n */\r\nexport function quadraticDerivativeAt(p0, p1, p2, t) {\r\n    return 2 * ((1 - t) * (p1 - p0) + t * (p2 - p1));\r\n}\r\n\r\n/**\r\n * 计算二次方贝塞尔方程根\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} t\r\n * @param  {Array.<number>} roots\r\n * @return {number} 有效根数目\r\n */\r\nexport function quadraticRootAt(p0, p1, p2, val, roots) {\r\n    var a = p0 - 2 * p1 + p2;\r\n    var b = 2 * (p1 - p0);\r\n    var c = p0 - val;\r\n\r\n    var n = 0;\r\n    if (isAroundZero(a)) {\r\n        if (isNotAroundZero(b)) {\r\n            var t1 = -c / b;\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        var disc = b * b - 4 * a * c;\r\n        if (isAroundZero(disc)) {\r\n            var t1 = -b / (2 * a);\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n        }\r\n        else if (disc > 0) {\r\n            var discSqrt = mathSqrt(disc);\r\n            var t1 = (-b + discSqrt) / (2 * a);\r\n            var t2 = (-b - discSqrt) / (2 * a);\r\n            if (t1 >= 0 && t1 <= 1) {\r\n                roots[n++] = t1;\r\n            }\r\n            if (t2 >= 0 && t2 <= 1) {\r\n                roots[n++] = t2;\r\n            }\r\n        }\r\n    }\r\n    return n;\r\n}\r\n\r\n/**\r\n * 计算二次贝塞尔方程极限值\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @return {number}\r\n */\r\nexport function quadraticExtremum(p0, p1, p2) {\r\n    var divider = p0 + p2 - 2 * p1;\r\n    if (divider === 0) {\r\n        // p1 is center of p0 and p2\r\n        return 0.5;\r\n    }\r\n    else {\r\n        return (p0 - p1) / divider;\r\n    }\r\n}\r\n\r\n/**\r\n * 细分二次贝塞尔曲线\r\n * @memberOf module:zrender/core/curve\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} t\r\n * @param  {Array.<number>} out\r\n */\r\nexport function quadraticSubdivide(p0, p1, p2, t, out) {\r\n    var p01 = (p1 - p0) * t + p0;\r\n    var p12 = (p2 - p1) * t + p1;\r\n    var p012 = (p12 - p01) * t + p01;\r\n\r\n    // Seg0\r\n    out[0] = p0;\r\n    out[1] = p01;\r\n    out[2] = p012;\r\n\r\n    // Seg1\r\n    out[3] = p012;\r\n    out[4] = p12;\r\n    out[5] = p2;\r\n}\r\n\r\n/**\r\n * 投射点到二次贝塞尔曲线上，返回投射距离。\r\n * 投射点有可能会有一个或者多个，这里只返回其中距离最短的一个。\r\n * @param {number} x0\r\n * @param {number} y0\r\n * @param {number} x1\r\n * @param {number} y1\r\n * @param {number} x2\r\n * @param {number} y2\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {Array.<number>} out 投射点\r\n * @return {number}\r\n */\r\nexport function quadraticProjectPoint(\r\n    x0, y0, x1, y1, x2, y2,\r\n    x, y, out\r\n) {\r\n    // http://pomax.github.io/bezierinfo/#projections\r\n    var t;\r\n    var interval = 0.005;\r\n    var d = Infinity;\r\n\r\n    _v0[0] = x;\r\n    _v0[1] = y;\r\n\r\n    // 先粗略估计一下可能的最小距离的 t 值\r\n    // PENDING\r\n    for (var _t = 0; _t < 1; _t += 0.05) {\r\n        _v1[0] = quadraticAt(x0, x1, x2, _t);\r\n        _v1[1] = quadraticAt(y0, y1, y2, _t);\r\n        var d1 = v2DistSquare(_v0, _v1);\r\n        if (d1 < d) {\r\n            t = _t;\r\n            d = d1;\r\n        }\r\n    }\r\n    d = Infinity;\r\n\r\n    // At most 32 iteration\r\n    for (var i = 0; i < 32; i++) {\r\n        if (interval < EPSILON_NUMERIC) {\r\n            break;\r\n        }\r\n        var prev = t - interval;\r\n        var next = t + interval;\r\n        // t - interval\r\n        _v1[0] = quadraticAt(x0, x1, x2, prev);\r\n        _v1[1] = quadraticAt(y0, y1, y2, prev);\r\n\r\n        var d1 = v2DistSquare(_v1, _v0);\r\n\r\n        if (prev >= 0 && d1 < d) {\r\n            t = prev;\r\n            d = d1;\r\n        }\r\n        else {\r\n            // t + interval\r\n            _v2[0] = quadraticAt(x0, x1, x2, next);\r\n            _v2[1] = quadraticAt(y0, y1, y2, next);\r\n            var d2 = v2DistSquare(_v2, _v0);\r\n            if (next <= 1 && d2 < d) {\r\n                t = next;\r\n                d = d2;\r\n            }\r\n            else {\r\n                interval *= 0.5;\r\n            }\r\n        }\r\n    }\r\n    // t\r\n    if (out) {\r\n        out[0] = quadraticAt(x0, x1, x2, t);\r\n        out[1] = quadraticAt(y0, y1, y2, t);\r\n    }\r\n    // console.log(interval, i);\r\n    return mathSqrt(d);\r\n}\r\n","/* global Float32Array */\r\n\r\nvar ArrayCtor = typeof Float32Array === 'undefined'\r\n    ? Array\r\n    : Float32Array;\r\n\r\n/**\r\n * 创建一个向量\r\n * @param {number} [x=0]\r\n * @param {number} [y=0]\r\n * @return {Vector2}\r\n */\r\nexport function create(x, y) {\r\n    var out = new ArrayCtor(2);\r\n    if (x == null) {\r\n        x = 0;\r\n    }\r\n    if (y == null) {\r\n        y = 0;\r\n    }\r\n    out[0] = x;\r\n    out[1] = y;\r\n    return out;\r\n}\r\n\r\n/**\r\n * 复制向量数据\r\n * @param {Vector2} out\r\n * @param {Vector2} v\r\n * @return {Vector2}\r\n */\r\nexport function copy(out, v) {\r\n    out[0] = v[0];\r\n    out[1] = v[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 克隆一个向量\r\n * @param {Vector2} v\r\n * @return {Vector2}\r\n */\r\nexport function clone(v) {\r\n    var out = new ArrayCtor(2);\r\n    out[0] = v[0];\r\n    out[1] = v[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 设置向量的两个项\r\n * @param {Vector2} out\r\n * @param {number} a\r\n * @param {number} b\r\n * @return {Vector2} 结果\r\n */\r\nexport function set(out, a, b) {\r\n    out[0] = a;\r\n    out[1] = b;\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量相加\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n */\r\nexport function add(out, v1, v2) {\r\n    out[0] = v1[0] + v2[0];\r\n    out[1] = v1[1] + v2[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量缩放后相加\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n * @param {number} a\r\n */\r\nexport function scaleAndAdd(out, v1, v2, a) {\r\n    out[0] = v1[0] + v2[0] * a;\r\n    out[1] = v1[1] + v2[1] * a;\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量相减\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n */\r\nexport function sub(out, v1, v2) {\r\n    out[0] = v1[0] - v2[0];\r\n    out[1] = v1[1] - v2[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量长度\r\n * @param {Vector2} v\r\n * @return {number}\r\n */\r\nexport function len(v) {\r\n    return Math.sqrt(lenSquare(v));\r\n}\r\nexport var length = len; // jshint ignore:line\r\n\r\n/**\r\n * 向量长度平方\r\n * @param {Vector2} v\r\n * @return {number}\r\n */\r\nexport function lenSquare(v) {\r\n    return v[0] * v[0] + v[1] * v[1];\r\n}\r\nexport var lengthSquare = lenSquare;\r\n\r\n/**\r\n * 向量乘法\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n */\r\nexport function mul(out, v1, v2) {\r\n    out[0] = v1[0] * v2[0];\r\n    out[1] = v1[1] * v2[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量除法\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n */\r\nexport function div(out, v1, v2) {\r\n    out[0] = v1[0] / v2[0];\r\n    out[1] = v1[1] / v2[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量点乘\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n * @return {number}\r\n */\r\nexport function dot(v1, v2) {\r\n    return v1[0] * v2[0] + v1[1] * v2[1];\r\n}\r\n\r\n/**\r\n * 向量缩放\r\n * @param {Vector2} out\r\n * @param {Vector2} v\r\n * @param {number} s\r\n */\r\nexport function scale(out, v, s) {\r\n    out[0] = v[0] * s;\r\n    out[1] = v[1] * s;\r\n    return out;\r\n}\r\n\r\n/**\r\n * 向量归一化\r\n * @param {Vector2} out\r\n * @param {Vector2} v\r\n */\r\nexport function normalize(out, v) {\r\n    var d = len(v);\r\n    if (d === 0) {\r\n        out[0] = 0;\r\n        out[1] = 0;\r\n    }\r\n    else {\r\n        out[0] = v[0] / d;\r\n        out[1] = v[1] / d;\r\n    }\r\n    return out;\r\n}\r\n\r\n/**\r\n * 计算向量间距离\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n * @return {number}\r\n */\r\nexport function distance(v1, v2) {\r\n    return Math.sqrt(\r\n        (v1[0] - v2[0]) * (v1[0] - v2[0])\r\n        + (v1[1] - v2[1]) * (v1[1] - v2[1])\r\n    );\r\n}\r\nexport var dist = distance;\r\n\r\n/**\r\n * 向量距离平方\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n * @return {number}\r\n */\r\nexport function distanceSquare(v1, v2) {\r\n    return (v1[0] - v2[0]) * (v1[0] - v2[0])\r\n        + (v1[1] - v2[1]) * (v1[1] - v2[1]);\r\n}\r\nexport var distSquare = distanceSquare;\r\n\r\n/**\r\n * 求负向量\r\n * @param {Vector2} out\r\n * @param {Vector2} v\r\n */\r\nexport function negate(out, v) {\r\n    out[0] = -v[0];\r\n    out[1] = -v[1];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 插值两个点\r\n * @param {Vector2} out\r\n * @param {Vector2} v1\r\n * @param {Vector2} v2\r\n * @param {number} t\r\n */\r\nexport function lerp(out, v1, v2, t) {\r\n    out[0] = v1[0] + t * (v2[0] - v1[0]);\r\n    out[1] = v1[1] + t * (v2[1] - v1[1]);\r\n    return out;\r\n}\r\n\r\n/**\r\n * 矩阵左乘向量\r\n * @param {Vector2} out\r\n * @param {Vector2} v\r\n * @param {Vector2} m\r\n */\r\nexport function applyTransform(out, v, m) {\r\n    var x = v[0];\r\n    var y = v[1];\r\n    out[0] = m[0] * x + m[2] * y + m[4];\r\n    out[1] = m[1] * x + m[3] * y + m[5];\r\n    return out;\r\n}\r\n\r\n/**\r\n * 求两个向量最小值\r\n * @param  {Vector2} out\r\n * @param  {Vector2} v1\r\n * @param  {Vector2} v2\r\n */\r\nexport function min(out, v1, v2) {\r\n    out[0] = Math.min(v1[0], v2[0]);\r\n    out[1] = Math.min(v1[1], v2[1]);\r\n    return out;\r\n}\r\n\r\n/**\r\n * 求两个向量最大值\r\n * @param  {Vector2} out\r\n * @param  {Vector2} v1\r\n * @param  {Vector2} v2\r\n */\r\nexport function max(out, v1, v2) {\r\n    out[0] = Math.max(v1[0], v2[0]);\r\n    out[1] = Math.max(v1[1], v2[1]);\r\n    return out;\r\n}\r\n","\r\nexport function initEnums(hstRtcEngine) {\r\n  /**\r\n   * 导出的媒体类型\r\n   */\r\n  hstRtcEngine.prototype.MediaType = {\r\n    SCREEN_SHARE: 0,\r\n    AUDIO: 1,\r\n    VIDEO: 2,\r\n    TRANSPARENT_DATA: 3,\r\n    WHITE_BOARD: 4\r\n  };\r\n\r\n  /**\r\n   * 导出的在线状态\r\n   */\r\n  hstRtcEngine.prototype.OnlineType = {\r\n    OFFLINE: 0,\r\n    ONLINE: 1\r\n  };\r\n\r\n  /**\r\n   * 导出白板显示模式\r\n   */\r\n  hstRtcEngine.prototype.DisplayMode = {\r\n    DBWZ: 1,  // 等比完整\r\n    DBSY: 2,  // 等比适应\r\n    DBSF: 3   // 等比缩放\r\n  }\r\n}\r\n","\r\nimport audioManager from \"../main/media/audio-manager\";\r\nimport mediaManager from \"../main/media/media-manager\"\r\nimport whiteBoardManger from \"../main/media/white-board-manager\"\r\n\r\n\r\nexport function initMedia(hstRtcEngine) {\r\n  /**\r\n   * 开始广播本地媒体\r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   * @param {*} params\r\n   * @returns 无\r\n   */\r\n  hstRtcEngine.prototype.startPublishMedia = function(mediaType, mediaId, params) {\r\n    mediaManager.startPublishMedia(mediaType, mediaId, params)\r\n  };\r\n\r\n  /**\r\n   * 停止广播本地媒体\r\n   * @param {*} mediaType \r\n   * @param {*} mediaId\r\n   * @returns 无 \r\n   */\r\n  hstRtcEngine.prototype.stopPublishMedia = function(mediaType, mediaId) {\r\n    mediaManager.stopPublishMedia(mediaType, mediaId);\r\n  };\r\n\r\n  /**\r\n   * 开始接收远端媒体\r\n   * @param {*} userId \r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   * @returns Promise\r\n   */\r\n  hstRtcEngine.prototype.startReceiveMedia = function(userId, mediaType, mediaId) {      \r\n    return mediaManager.startReceiveMedia(userId, mediaType, mediaId);\r\n  };\r\n\r\n  /**\r\n   * 停止接收远端媒体\r\n   * @param {*} userId \r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   * @returns Promise\r\n   */\r\n  hstRtcEngine.prototype.stopReceiveMedia = function(userId, mediaType, mediaId) {      \r\n    return mediaManager.stopReceiveMedia(userId, mediaType, mediaId);\r\n  };\r\n\r\n  /**\r\n   * 设置媒体渲染器\r\n   * @param {*} userId      用户ID，可以是本地用户或远端用户 \r\n   * @param {*} mediaType   媒体类型：音频、视频、屏幕共享、电子白板\r\n   * @param {*} mediaId     媒体ID\r\n   * @param {*} renderEle   HTML标签，对于白板来说是canvas，其它是video\r\n   * @param {*} params      控制本地采集分辨率和帧率 \r\n   */\r\n  hstRtcEngine.prototype.setMediaRender = function(userId, mediaType, mediaId, renderEle, params) {\r\n    mediaManager.setMediaRender(userId, mediaType, mediaId, renderEle, params);\r\n  };\r\n\r\n  /**\r\n   * 取消设置媒体渲染器\r\n   * @param {*} userId \r\n   * @param {*} mediaType FIXME：音频和视频都传入MediaType？\r\n   * @param {*} htmlEle \r\n   */\r\n  hstRtcEngine.prototype.unsetMediaRender = function(userId, mediaType, mediaId) {\r\n    mediaManager.unsetMediaRender(userId, mediaType, mediaId);\r\n  };\r\n\r\n  /**\r\n   * 设置本地是否发送变声\r\n   * @param {*} value 变声程度值，取值范围为[-12, 12]，0表示没有变声\r\n   */\r\n  hstRtcEngine.prototype.setSendMagicAudioValue = function(value) {\r\n    audioManager.setSendMagicAudioValue(value)\r\n  };\r\n\r\n  /**\r\n   * 设置是否接收变声\r\n   * @param {*} mode 0：跟随，1：只接原声，2：只接变声\r\n   */\r\n  hstRtcEngine.prototype.setRecvMagicAudioMode = function(mode) {\r\n    audioManager.setRecvMagicAudioMode(mode)\r\n  };\r\n\r\n  /**\r\n   * 创建白板\r\n   */\r\n  hstRtcEngine.prototype.createWhiteBoard = function (params) {\r\n    return whiteBoardManger.createWhiteBoard(params);\r\n  }\r\n\r\n  /**\r\n   * 关闭白板\r\n   * @param {*} mediaId \r\n   */\r\n  hstRtcEngine.prototype.closeWhiteBoard = function (mediaId) {\r\n    return whiteBoardManger.closeWhiteBoard(mediaId);\r\n  }\r\n\r\n  /**\r\n   * 查找白板\r\n   * @param {*} mediaId \r\n   */\r\n   hstRtcEngine.prototype.getWhiteBoard = function (mediaId) {\r\n    return whiteBoardManger.getWhiteBoard(mediaId);\r\n  }\r\n\r\n  /**\r\n   * 设置白板显示模式\r\n   * @param {*} mediaId 指定白板，为null表示所有白板\r\n   * @param {*} mode 1：等比完整，2：等比适应，3：等比缩放\r\n   * @param {*} param mode为3时，指定缩放比例\r\n   */\r\n  hstRtcEngine.prototype.setWhiteBoardDisplayMode =  function(mediaId, mode, param) {\r\n    return whiteBoardManger.setDisplayMode(mediaId, mode, param);\r\n  }\r\n\r\n  /**\r\n   *  旋转白板\r\n   */\r\n   hstRtcEngine.prototype.rotateWhiteBoard = function (rotateAngle, mediaId) {\r\n    return whiteBoardManger.rotateWhiteBoard(rotateAngle, mediaId)\r\n  }\r\n\r\n  /**\r\n   *  切换白板\r\n   */\r\n   hstRtcEngine.prototype.switchWhiteBoard = function (mediaId) {\r\n    return whiteBoardManger.switchWhiteBoard(mediaId)\r\n  }\r\n\r\n  /**\r\n   *  切换白板页\r\n   */\r\n   hstRtcEngine.prototype.switchWhiteBoardPage = function (curPage, mediaId, needNotifyOthers) {\r\n    return whiteBoardManger.switchWhiteBoardPage(curPage, mediaId, needNotifyOthers)\r\n  }\r\n\r\n  /**\r\n   * 上传文档\r\n   */\r\n  hstRtcEngine.prototype.startUpload = function (params) {\r\n    return whiteBoardManger.startUploadDoc(params)\r\n  }\r\n}\r\n","import msgManger from \"../main/message/message-manager\"\r\n\r\nexport function initMessage(hstRtcEngine) {\r\n  /**\r\n   * 发送单播消息\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.sendUserMsg = function(params) {\r\n    msgManger.sendUserMsg(params);\r\n  };\r\n\r\n  /**\r\n   * 发送白名单消息\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.sendGroupMsgWithWhiteList = function(params) {\r\n    msgManger.sendGroupMsgWithWhiteList(params);\r\n  };\r\n\r\n  /**\r\n   * 发送黑名单消息\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.sendGroupMsgWithBlackList = function(params) {\r\n    msgManger.sendGroupMsgWithBlackList(params);\r\n  };\r\n\r\n  /**\r\n   * 发送广播消息\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.sendGroupMsg = function(params) {\r\n    msgManger.sendGroupMsg(params);\r\n  };\r\n}","import { promiseHandler } from \"../common/promise-handler\"\r\nimport onlineManager from \"../main/online/online-manager\"\r\nimport { EventType } from \"../common/enums\"\r\n\r\nexport function initOnline(hstRtcEngine) {\r\n  /**\r\n   * 获取所有在线用户列表\r\n   */\r\n  hstRtcEngine.prototype.getOnlineUsers = function() {\r\n    onlineManager.getOnlineUsers();\r\n    return promiseHandler(EventType.EVENT_GET_ONLINE_USERS);\r\n  };\r\n\r\n  /**\r\n   * 邀请其他用户加入分组\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.invite = function(params) {\r\n    onlineManager.invite(params);\r\n    return promiseHandler(EventType.EVENT_INVITE);\r\n  };\r\n\r\n  /**\r\n   * 响应邀请\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.replyInvite = function(params) {\r\n    onlineManager.replyInvite(params);\r\n  };\r\n\r\n  /**\r\n   * 邀请方取消邀请协议\r\n   * @param {*} params \r\n   */\r\n  hstRtcEngine.prototype.cancelInvite = function(params) {\r\n    onlineManager.cancelInvite(params);\r\n    return promiseHandler(EventType.EVENT_CANCEL_INVITE);\r\n  };\r\n}\r\n","import rtcEngine from '../main/rtc-engine'\r\nimport { promiseHandler } from '../common/promise-handler'\r\nimport { EventType } from \"../common/enums\"\r\n\r\nexport function initPlatform(HstEngine) {\r\n  /**\r\n   * 初始化引擎\r\n   * @params {*} params \r\n   */\r\n  HstEngine.prototype.init = function(params) {\r\n    rtcEngine.doInit(params);\r\n    return promiseHandler(EventType.EVENT_INIT);\r\n  };\r\n\r\n  /**\r\n   * 登录\r\n   * @params {*} params \r\n   */\r\n  HstEngine.prototype.login = function(params) {\r\n    rtcEngine.doLogin(params);\r\n    return promiseHandler(EventType.EVENT_LOGIN);\r\n  };\r\n\r\n  /**\r\n   * 加入分组\r\n   * @params {*} groupId \r\n   */\r\n  HstEngine.prototype.joinGroup = function(groupId) {\r\n    rtcEngine.doJoin(groupId);\r\n    return promiseHandler(EventType.EVENT_JOIN_GROUP);\r\n  };\r\n\r\n  /**\r\n   * 离开分组\r\n   */\r\n  HstEngine.prototype.leaveGroup = function() {\r\n    rtcEngine.doLeave();\r\n    return promiseHandler(EventType.EVENT_LEAVE_GROUP);\r\n  };\r\n\r\n  /**\r\n   * 退出\r\n   */\r\n  HstEngine.prototype.logout = function() {\r\n    rtcEngine.doLogout();\r\n    return promiseHandler(EventType.EVENT_LOGOUT);\r\n  };\r\n\r\n  /**\r\n   * 销毁引擎\r\n   */\r\n  HstEngine.prototype.destroy = function() {\r\n    rtcEngine.doDestroy();\r\n  }\r\n}","import eventRegistry from '../common/event-registry'\r\n\r\nexport function initSubscribe(HstRtcEngine) {\r\n  /**\r\n   * 订阅事件\r\n   */  \r\n  HstRtcEngine.prototype.subEvent = function () {\r\n    console.log(\"Subscribe event: \", arguments[0]);\r\n    eventRegistry.on(...arguments)\r\n  }\r\n\r\n  /**\r\n   * 取消订阅事件，参数为空则为取消订阅所有事件\r\n   */\r\n  HstRtcEngine.prototype.unsubEvent = function () {\r\n    console.log(\"Unsubscribe event: \", arguments[0]);\r\n    eventRegistry.off(...arguments);  \r\n  }\r\n}","import { initPlatform } from './export/platform-export'\r\nimport { initSubscribe } from './export/subevent-export'\r\nimport { initMedia } from './export/media-export'\r\nimport { initOnline } from './export/online-export'\r\nimport { initEnums} from './export/enums-export'\r\nimport { initMessage } from \"./export/message-export\"\r\n\r\nfunction HstRtcEngine() {\r\n  if (process.env.NODE_ENV !== \"production\" && !(this instanceof HstRtcEngine)) {\r\n    console.error(\"HstRtcEngine is a constructor and should be called with the `new` keyword\");\r\n  }\r\n}\r\n\r\ninitSubscribe(HstRtcEngine);\r\ninitPlatform(HstRtcEngine);\r\ninitMedia(HstRtcEngine);\r\ninitOnline(HstRtcEngine);\r\ninitEnums(HstRtcEngine);\r\ninitMessage(HstRtcEngine);\r\n\r\nexport default HstRtcEngine;","import { MediaType, MediaOper, RecvState, EventType, RecvMagicMode } from \"../../common/enums\"\r\nimport protocolSender from \"../util/protocol-sender\"\r\nimport { promiseHandler } from \"../../common/promise-handler\"\r\nimport { getEventPostfix } from \"../../common/common\"\r\nimport mediaManager from \"./media-manager\"\r\nimport logger from \"../../common/logger\"\r\n\r\nclass AudioManager {\r\n  constructor() {\r\n    // Current microphone device\r\n    this.curMicDevId = null\r\n\r\n    // Current speaker device\r\n    this.curSpkDevId = null\r\n\r\n    // magic audio, 0: original\r\n    this.audioMagicValue = 0\r\n    this.recvMagicAudio = false\r\n  }\r\n\r\n  /**\r\n   * 开始广播音频\r\n   * @param {*} devId \r\n   */\r\n  startPublishAudio(devId) {\r\n    if (!devId) { // TODO：不允许默认设备\r\n      logger.error(\"Invalid devId!\")\r\n      return\r\n    }\r\n\r\n    // 保存指定的麦克风设备\r\n    this.setCurMicDevId(devId)\r\n\r\n    // 其他端SDK将音频的MediaId写死为“appdef_mic”，为了保持一致\r\n    // 这里强制把mediaId也写死为“appdef_mic”，但是可能会有问题\r\n    let mediaId = null\r\n    if (this.audioMagicValue == 0) {\r\n      mediaId = \"appdef_mic\"  // 原声\r\n    } else { // 变声\r\n      mediaId = \"appdef_mic_magic\"\r\n    }\r\n\r\n    protocolSender.sendPublishMediaReq(\r\n      MediaOper.START_PUBLISH, \r\n      MediaType.AUDIO, \r\n      mediaId)\r\n    \r\n    // 发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_START_PUB_AUDIO)\r\n  }\r\n\r\n  /**\r\n   * 停止广播音频\r\n   * @param {*} devId 允许不填deviceId\r\n   */\r\n  stopPublishAudio(devId) {\r\n    let mediaId = null\r\n    if (this.audioMagicValue == 0) {\r\n      mediaId = \"appdef_mic\"  // 原声\r\n    } else { // 变声\r\n      mediaId = \"appdef_mic_magic\"\r\n    }\r\n\r\n    protocolSender.sendPublishMediaReq(\r\n      MediaOper.STOP_PUBLISH,\r\n      MediaType.AUDIO, \r\n      mediaId)\r\n\r\n    // 取消发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_STOP_PUB_AUDIO)\r\n  }\r\n\r\n  /**\r\n   * 开始接收远端音频\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  startReceiveAudio(userId, mediaId) {\r\n    if (!userId || !mediaId) {\r\n      logger.error(\"Invalid srcUserId or mediaId!\")\r\n      return\r\n    }\r\n\r\n    protocolSender.sendRecvMediaReq(\r\n      RecvState.START_RECV, \r\n      userId, \r\n      MediaType.AUDIO, \r\n      mediaId)\r\n\r\n    // 可能同时接收多个音频，保证请求和响应匹配\r\n    return promiseHandler(EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.AUDIO, mediaId))\r\n  }\r\n\r\n  /**\r\n   * 停止接收远端音频\r\n   * @param {*} srcUserId \r\n   * @param {*} mediaId \r\n   */\r\n  stopReceiveAudio(srcUserId, mediaId) {\r\n    if (!srcUserId || !mediaId) {\r\n      logger.error(\"Invalid srcUserId or mediaId!\")\r\n      return\r\n    }\r\n\r\n    protocolSender.sendRecvMediaReq(\r\n      RecvState.STOP_RECV, \r\n      srcUserId, \r\n      MediaType.AUDIO, \r\n      mediaId)\r\n\r\n    return promiseHandler(EventType.EVENT_STOP_RCV_MEDIA + getEventPostfix(srcUserId, MediaType.AUDIO, mediaId))\r\n  }\r\n\r\n  /**\r\n   * 选择扬声器设备\r\n   * @param {*} devId \r\n   */\r\n  chooseSpkDevice(devId) {\r\n    this.curSpkDevId = devId\r\n\r\n    // 更新所有downPeerConnection的扬声器设置\r\n    for (const downPc of mediaManager.downPcMap.values()) {\r\n      if (downPc.videoEle) {\r\n        this.setAudioSpeaker(downPc.videoEle)\r\n      }  \r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置本地是否发送变声\r\n   * @param {*} value 变声程度值，取值范围为[-12, 12]，0表示没有变声\r\n   */\r\n  setSendMagicAudioValue(value) {\r\n    if (this.audioMagicValue == value) return\r\n\r\n    this.audioMagicValue = value\r\n    logger.log(\"Set send audio magic to \" + value)\r\n\r\n    // 可能已经有音频正在发送中\r\n    for (const pc of mediaManager.upPcMap) {\r\n      for (const track of pc.upTracks) {\r\n        if (track.mediaType == MediaType.AUDIO) {\r\n          protocolSender.sendSetAudioMagic(track.streamId, value)\r\n          break // 每个PC最多一路音频\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置是否接收变声\r\n   * @param {*} mode 0：跟随，1：只接原声，2：只接变声\r\n   */\r\n  setRecvMagicAudioMode(mode) {\r\n    if (mode != RecvMagicMode.FOLLOW \r\n      && mode != RecvMagicMode.ONLY_ORIGIN \r\n      && mode != RecvMagicMode.ONLY_MAGIC) {\r\n      logger.error(\"Invalid recv audio magic mode: \" + mode)\r\n      return\r\n    }\r\n    logger.log(\"Set recv audio magic mode: \" + mode)\r\n    this.recvMagicAudio = mode\r\n  }\r\n\r\n  /**\r\n   * 设置video标签上的音频到指定扬声器\r\n   * @param {*} videoEle \r\n   */\r\n  setAudioSpeaker(videoEle) {\r\n    if (typeof videoEle.sinkId !== 'undefined') {\r\n      videoEle.setSinkId(this.curSpkDevId).then(() => { \r\n        logger.log(\"Set speaker \" + this.curSpkDevId + \" success.\") \r\n      }).catch((err) => { \r\n        logger.error(\"Set speaker \" + this.curSpkDevId + \" failed!\", err) \r\n      })\r\n    } else {\r\n      logger.error(\"Invalid media element!\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置当前使用的麦克风设备\r\n   * TODO: 当前这个方法没有暴露出去，而curMicDev默认是null，如果在本地没有广播过\r\n   * 音频的前提下，远端想查看本地音频，这时候可能会出错\r\n   * @param {*} devId \r\n   */\r\n  setCurMicDevId(devId) {\r\n    if (devId) {\r\n      this.curMicDevId = devId\r\n    } else {\r\n      logger.error(\"Invalid microphone device!\")\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取当前使用的麦克风设备\r\n   */\r\n  getCurMicDevId() {\r\n    return this.curMicDevId\r\n  }\r\n\r\n  /**\r\n   * 获取当前使用的扬声器设备\r\n   */\r\n  getCurSpkDevId() {\r\n    return this.curSpkDevId\r\n  }\r\n\r\n  /**\r\n   * 构建音频设备采集的constraints\r\n   * @param {*} devId \r\n   */\r\n  buildConstraints(devId) {\r\n    let audioConstraints = { deviceId: devId }\r\n    return { audio: audioConstraints }\r\n  }\r\n}\r\n\r\nexport default new AudioManager()","import Store from '../util/store'\r\nimport { MediaType, MediaOper, EventResult, RecvState, EventType } from \"../../common/enums\"\r\nimport { asyncWrapper, getAddrs, getEventPostfix, tracelog, checkParam } from \"../../common/common\"\r\nimport logger from \"../../common/logger\"\r\nimport videoManager from \"./video-manager\"\r\nimport audioManager from \"./audio-manager\"\r\nimport shareManager from \"./share-manager\"\r\nimport boardManager from \"./white-board-manager\"\r\nimport eventRegistry from '../../common/event-registry'\r\nimport protocolSender from '../util/protocol-sender'\r\n\r\n/**\r\n * 有些处理是多个媒体类型（音频、视频、屏幕共享、电子白板）所共有的\r\n */\r\nclass MediaManager {\r\n  constructor() {\r\n    // BindId : UpPeerConnection\r\n    this.upPcMap = new Map();\r\n\r\n    // BindId : DownPeerConnection\r\n    this.downPcMap = new Map();\r\n\r\n    // To be restored down tracks \r\n    this.restoreDownTracks = new Array();\r\n\r\n    // 订阅消息处理\r\n    Store.msgDispatcher.addMsgHandler(14106, this.onNotifyUserMediaState.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14109, this.onNotifyGroupMediaStates.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14110, this.onNotifyUserJoinGroup.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14111, this.onNotifyUserLeaveGroup.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(18003, this.onRecvStreamRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(18000, this.onNotifySendStreamRes.bind(this));\r\n\r\n    // 重新接收媒体\r\n    eventRegistry.on(\"restoreDownTrack\", this._onRestoreDownTrack.bind(this));\r\n  }\r\n\r\n  /**\r\n   * 恢复媒体渲染\r\n   * @param {*} params \r\n   * @returns 找到了track\r\n   */\r\n  @tracelog\r\n  tryRestoreMediaRender(params) {\r\n    if (this.restoreDownTracks.length == 0) {\r\n      logger.log(\"Empty restore tracks.\");\r\n      return false;\r\n    }\r\n\r\n    let track = this.restoreDownTracks[0];\r\n    if (params.userId !== track.userId\r\n      || params.mediaType !== track.mediaType\r\n      || params.mediaId !== track.mediaId) {\r\n      logger.log(\"Different track.\");\r\n      return false;\r\n    }\r\n\r\n    if (track.videoEle) {\r\n      this.setMediaRender(track.userId, track.mediaType, track.mediaId, track.videoEle);\r\n    }\r\n\r\n    this.restoreDownTracks.shift();\r\n    if (this.restoreDownTracks.length > 0) {\r\n      asyncWrapper(()=>{this._doStartReceiveMedia(this.restoreDownTracks[0])})\r\n    }\r\n      \r\n    return true;\r\n}\r\n\r\n  /**\r\n   * 停止接收媒体\r\n   * @param {*} params \r\n   */\r\n  _doStartReceiveMedia(params) {\r\n    this.startReceiveMedia(params.userId, params.mediaType, params.mediaId).then(()=>{\r\n      logger.log(\"Start receive media success.\");\r\n    }).catch((e)=>{\r\n      logger.error(\"Start receive media failed, err: \" + e);\r\n      this.restoreDownTracks.shift();\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 停止接收媒体\r\n   * @param {*} params \r\n   */\r\n  _doStopReceiveMedia(params) {\r\n    this.stopReceiveMedia(params.userId, params.mediaType, params.mediaId).then(()=>{\r\n      logger.log(\"Start receive media success.\");\r\n    }).catch((e)=>{\r\n      logger.error(\"Start receive media failed, err: \" + e);\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 恢复接受媒体的事件处理\r\n   * @param {*} params \r\n   */\r\n  @tracelog\r\n  _onRestoreDownTrack(params) {\r\n    this.restoreDownTracks.push(params);\r\n    if (this.restoreDownTracks.length == 1) {\r\n      this._doStartReceiveMedia(params);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 开始广播本地媒体\r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   * @param {*} params\r\n   * @returns 无\r\n   */\r\n  @tracelog\r\n  startPublishMedia(mediaType, mediaId, params) {\r\n    switch(mediaType) {\r\n      case MediaType.AUDIO:\r\n        audioManager.startPublishAudio(mediaId);\r\n        break;\r\n      case MediaType.VIDEO:\r\n        videoManager.startPublishVideo(mediaId, params);\r\n        break;\r\n      case MediaType.SCREEN_SHARE:\r\n        shareManager.startScreenShare(params);\r\n        break;\r\n      case MediaType.WHITE_BOARD:\r\n        boardManager.startPublishWhiteBoard(mediaId);\r\n        break;\r\n      default:\r\n        logger.error(\"Unknown media type: \" + mediaType);\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 停止广播本地媒体\r\n   * @param {*} mediaType \r\n   * @param {*} mediaId\r\n   * @returns 无 \r\n   */\r\n  @tracelog\r\n  stopPublishMedia(mediaType, mediaId) {\r\n    switch(mediaType) {\r\n      case MediaType.AUDIO:\r\n        audioManager.stopPublishAudio();\r\n        break;\r\n      case MediaType.VIDEO:\r\n        videoManager.stopPublishVideo(mediaId);\r\n        break;\r\n      case MediaType.SCREEN_SHARE:\r\n        shareManager.stopScreenShare();\r\n        break;\r\n      case MediaType.WHITE_BOARD:\r\n        boardManager.stopPublishWhiteBoard(mediaId);\r\n        break;\r\n      default:\r\n        logger.error(\"Unknown media type: \" + mediaType);\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 开始接收远端媒体，FIXME：需要返回Promise\r\n   * @param {*} userId \r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   * @returns Promise\r\n   */\r\n  @tracelog\r\n  startReceiveMedia(userId, mediaType, mediaId) {      \r\n    switch(mediaType) {\r\n      case MediaType.AUDIO:\r\n        return audioManager.startReceiveAudio(userId, mediaId);\r\n      case MediaType.VIDEO:\r\n        return videoManager.startReceiveVideo(userId, mediaId);\r\n      case MediaType.SCREEN_SHARE:\r\n        return shareManager.startReceiveScreenShare(userId, mediaId);\r\n      case MediaType.WHITE_BOARD:\r\n        return boardManager.startReceiveWhiteBoard(userId, mediaId);\r\n      default:\r\n        return new Promise((resolve, reject) => {\r\n          reject(\"Unknown media type: \" + mediaType);\r\n        });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 停止接收远端媒体\r\n   * @param {*} userId \r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   */\r\n  @tracelog\r\n  stopReceiveMedia(userId, mediaType, mediaId) {    \r\n    switch(mediaType) {\r\n      case MediaType.AUDIO:\r\n        return audioManager.stopReceiveAudio(userId, mediaId);\r\n      case MediaType.VIDEO:\r\n        return videoManager.stopReceiveVideo(userId, mediaId);\r\n      case MediaType.SCREEN_SHARE:\r\n        return shareManager.stopReceiveScreenShare(userId, mediaId);\r\n      case MediaType.WHITE_BOARD:\r\n        return boardManager.stopReceiveWhiteBoard(userId, mediaId);\r\n      default:\r\n        logger.error(\"Unknown media type: \" + mediaType);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置媒体渲染器\r\n   * @param {*} userId      用户ID，可以是本地用户或远端用户 \r\n   * @param {*} mediaType   媒体类型：音频、视频、屏幕共享、电子白板\r\n   * @param {*} mediaId     媒体ID\r\n   * @param {*} renderEle   HTML标签，对于白板来说是canvas，其它是video\r\n   * @param {*} params      本地渲染有效 \r\n   */\r\n  @tracelog\r\n  setMediaRender(userId, mediaType, mediaId, renderEle, params) {\r\n    switch(mediaType) {\r\n      case MediaType.AUDIO: \r\n      case MediaType.VIDEO:\r\n      case MediaType.SCREEN_SHARE:\r\n        console.warn(\"Unexpected mediaType: \" + mediaType);\r\n        break;\r\n      case MediaType.WHITE_BOARD:\r\n        boardManager.setWhiteBoardRender(mediaId, renderEle, params);\r\n        break;\r\n      default:\r\n        logger.error(\"Unknown media type: \" + mediaType);\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 取消设置媒体渲染器\r\n   * @param {*} userId \r\n   * @param {*} mediaType FIXME：音频和视频都传入MediaType？\r\n   * @param {*} mediaId \r\n   */\r\n  @tracelog\r\n  unsetMediaRender(userId, mediaType, mediaId) {\r\n    logger.trace(\"Calling unsetMediaRender: \" + userId + \", \" + mediaType);\r\n    switch(mediaType) {\r\n      case MediaType.AUDIO: \r\n      case MediaType.VIDEO:\r\n      case MediaType.SCREEN_SHARE:\r\n        console.warn(\"Unexpected mediaType: \" + mediaType);\r\n        break;\r\n      case MediaType.WHITE_BOARD:\r\n        boardManager.unsetWhiteBoardRender(mediaId);\r\n        break;\r\n      default:\r\n        logger.error(\"Unknown media type: \" + mediaType);\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 设置音视频播放对象 \r\n   * @param {*} videoEle\r\n   * @param {*} streamId \r\n   */\r\n  _setMediaRender(userId, mediaType, mediaId, videoEle, videoParam){\r\n    if (userId == Store.userInfo.userId) { // 本端\r\n      if (mediaType == MediaType.VIDEO) {\r\n        videoManager.setLocalVideoRender(mediaId, videoEle, videoParam);\r\n      } else if (mediaType == MediaType.SCREEN_SHARE) {\r\n        shareManager.setLocalScreenShareRender(videoEle);\r\n      } else {\r\n        logger.error(\"Unexpected media type: \" + mediaType);\r\n      }\r\n    } else { // 远端\r\n      let pc = this.findDownPcByUserMeida(userId, mediaType, mediaId);\r\n      if (pc) {\r\n        videoEle.srcObject = pc.mediaStream;\r\n        pc.videoEle = videoEle;\r\n        if (this.curSpkDevId) { // 同时设置下扬声器\r\n          audioManager.setAudioSpeaker(videoEle);\r\n        }\r\n      } else {\r\n        logger.error(\"Cannot find down peer connection!\");\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 取消设置音视频播放对象\r\n   * 音频不需要显式调用unset，本端没有渲染，远端停止接收即可\r\n   * @param {*} userId \r\n   * @param {*} videoEle \r\n   */\r\n  _unsetMediaRender(userId, videoEle) {\r\n    if (!videoEle || !('srcObject' in videoEle)){\r\n      logger.error(\"Invalid videoEle!\");\r\n      return;\r\n    }\r\n\r\n    if (userId == Store.userInfo.userId) { // 本端视频\r\n      if (videoEle.srcObject) {\r\n          for (const track of videoEle.srcObject.getTracks()) {\r\n            track.stop();\r\n          }\r\n          videoEle.srcObject = null;\r\n      } else {\r\n        logger.warn(\"Invalid srcObject!\");\r\n      }\r\n    } else { // 远端视频\r\n      videoEle.srcObject = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 通知有用户加入分组\r\n   * @param {*} msg \r\n   * @param {*} socket \r\n   */\r\n  onNotifyUserJoinGroup(msg, socket) {\r\n    eventRegistry.trigger(\"onUserJoinGroup\", msg.user_id);\r\n  }\r\n\r\n  /**\r\n   * 通知有用户退出分组\r\n   * @param {*} msg \r\n   * @param {*} socket \r\n   */\r\n  onNotifyUserLeaveGroup(msg, socket) {\r\n    eventRegistry.trigger(\"onUserLeaveGroup\", msg.user_id);\r\n  }\r\n\r\n    /**\r\n   * 构造事件类型\r\n   * @param {*} operation \r\n   * @param {*} userId \r\n   * @param {*} mediaType \r\n   * @param {*} mediaId \r\n   */\r\n  _getEventType(operation, userId, mediaType, mediaId) {\r\n    return (\r\n      (operation == RecvState.START_RECV) \r\n        ? EventType.EVENT_START_RCV_MEDIA \r\n        : EventType.EVENT_STOP_RCV_MEDIA\r\n      ) + getEventPostfix(userId, mediaType, mediaId)\r\n  }\r\n\r\n  /**\r\n   * 开始/停止接收音视频响应\r\n   * @param {*} data \r\n   * @param {*} socket \r\n   */\r\n  onRecvStreamRes(data, socket) {\r\n    if (data.media_type === MediaType.SCREEN_SHARE && !data.stream_server) {\r\n      return eventRegistry.trigger(\r\n        this._getEventType(data.recv, data.user_id, data.media_type, data.media_id),\r\n        EventResult.NOADDR);\r\n    }\r\n    if (data.media_type !== MediaType.WHITE_BOARD) {\r\n      return // 暂不处理接收音频、视频、屏幕共享的响应\r\n    }\r\n\r\n    try {\r\n      if (data.group_id.length === 0 || data.media_id.length === 0) {\r\n        throw \"Invalid recv stream response!!!\" + data;\r\n      }\r\n  \r\n      // 解析websocket服务地址\r\n      let streamServer = null;\r\n      if (data.stream_server) {\r\n        // streamServer = getAddrs(\"ws\", data.stream_server);\r\n        streamServer = data.stream_server\r\n        if (!streamServer) {\r\n          throw \"Cannot find webrtc gateway: \" + data.stream_server;\r\n        }\r\n      } else {\r\n        // throw \"Cannot find 'stream_server' in msg!\"\r\n        return eventRegistry.trigger(\r\n          this._getEventType(data.recv, data.user_id, data.media_type, data.media_id),\r\n          EventResult.NOADDR);\r\n      }\r\n      if (data.recv === RecvState.START_RECV) {\r\n        boardManager.onStartRecvWhiteBoardRes({\r\n          userId: data.user_id,\r\n          mediaType: data.media_type,\r\n          mediaId: data.media_id,\r\n          streamId: data.stream_id,\r\n          streamServer: streamServer, \r\n          streamToken: data.subscribe_token\r\n        });\r\n      } else {\r\n        boardManager.onStopRecvWhiteBoardRes({\r\n          userId: data.user_id,\r\n          mediaType: data.media_type,\r\n          mediaId: data.media_id,\r\n          streamId: data.stream_id,\r\n        });\r\n      }\r\n      \r\n      eventRegistry.trigger(\r\n        this._getEventType(data.recv, data.user_id, data.media_type, data.media_id),\r\n        EventResult.SUCCESS);\r\n    } catch (err) {\r\n      logger.error(err)\r\n      eventRegistry.trigger(\r\n        this._getEventType(data.recv, data.user_id, data.media_type, data.media_id),\r\n        EventResult.FAILED);\r\n    }\r\n  }\r\n\r\n  onNotifySendStreamRes(data) {\r\n    const params = {\r\n      streamId: data.stream_id,\r\n      send: data.send,\r\n    }\r\n    protocolSender.sendNotifySendStreamRes(params)\r\n  }\r\n\r\n  /**\r\n   * 通知分组内其他用户媒体状态\r\n   * @param {*} data \r\n   * @param {*} socket \r\n   */\r\n  onNotifyUserMediaState(data, socket) {\r\n    if (data.media_type != MediaType.SCREEN_SHARE\r\n      && data.media_type != MediaType.AUDIO\r\n      && data.media_type != MediaType.VIDEO\r\n      && data.media_type != MediaType.WHITE_BOARD){\r\n      logger.warn(\"Unexpected media type: \", data.media_type);\r\n      return;\r\n    }\r\n\r\n    let params = {\r\n      userId: data.user_id, \r\n      mediaType: data.media_type,\r\n      mediaId: data.media_id,\r\n      mediaName: data.media_description || data.media_name\r\n    };\r\n\r\n    // 通知用户广播/停止广播\r\n    if (data.operation == MediaOper.STOP_PUBLISH){\r\n      eventRegistry.trigger(\"onUnPublishMedia\", params);\r\n      // this._doStopReceiveMedia(params); // 小程序计费\r\n    } else if (data.operation == MediaOper.START_PUBLISH) {\r\n      eventRegistry.trigger(\"onPublishMedia\", params);\r\n      // this._doStartReceiveMedia(params); // 小程序计费\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 通知分组中全量用户及其媒体状态\r\n   * @param {*} data \r\n   * @param {*} socket \r\n   */\r\n  onNotifyGroupMediaStates(data, socket) {\r\n    // FIXME：在恢复的过程中，有可能媒体状态发生了改变，这里简化处理了\r\n    if (Store.restoring) {\r\n      Store.restoring = false\r\n      return\r\n    }\r\n    \r\n    let groupUsers = [];\r\n    for (const user of data.user_info) {\r\n      groupUsers.push(user.user_id);\r\n    }\r\n\r\n    // 先通知分组用户列表\r\n    if (groupUsers.length > 0){\r\n      eventRegistry.trigger(\"onGroupUserList\", groupUsers);\r\n    }\r\n\r\n    // 然后再通知媒体广播\r\n    for (const user of data.user_info) {\r\n      if (user.media_info.length <= 0) { \r\n        continue; \r\n      }\r\n    \r\n      for (const media of user.media_info) {\r\n        let params = {\r\n          userId: user.user_id,\r\n          mediaType: media.media_type,\r\n          mediaId: media.media_id,\r\n          mediaName: media.media_description\r\n        };\r\n        eventRegistry.trigger(\"onPublishMedia\", params);\r\n        // this._doStartReceiveMedia(params); // 小程序计费\r\n      }\r\n    }\r\n\r\n    // 通知白板广播\r\n    for (const media of data.group_media) {\r\n      let params = {\r\n        userId: media.user_id,\r\n        mediaType: media.media_type,\r\n        mediaId: media.media_id,\r\n        mediaName: media.media_name\r\n      };\r\n      eventRegistry.trigger(\"onPublishMedia\", params);\r\n      // this._doStartReceiveMedia(params)\r\n    }\r\n\r\n    // 全量推送完成\r\n    eventRegistry.trigger(\"onGroupPushComplete\");\r\n  }\r\n}\r\n\r\nexport default new MediaManager();","import { MediaOper, MediaType, RecvState, EventType, PubEventType } from \"../../common/enums\"\r\nimport protocolSender from \"../util/protocol-sender\"\r\nimport { promiseHandler, hstRequest } from \"../../common/promise-handler\"\r\nimport { getEventPostfix, tracelog, getBitRate } from \"../../common/common\"\r\nimport mediaManager from \"./media-manager\"\r\nimport eventRegistry from \"../../common/event-registry\"\r\n\r\nclass ShareManager {\r\n  constructor() {\r\n    // Screen share media stream\r\n    this.screenShareStream = null;\r\n    this.screenShareStreamRefCount = 0;\r\n\r\n    // Make sure one screen share stream\r\n    this.isCreatingStream = false;\r\n\r\n    // User defined screen share parameters(init value is default)\r\n    this.screenShareParam = { frameRate: 15, width: 1920, height: 1080, bitRate: 0 };\r\n  }\r\n\r\n  /**\r\n   * 开始屏幕共享\r\n   * @param {*} shareParam { width: 640, height: 360, frameRate: 15, bitRate: 1000 }\r\n   */\r\n  @tracelog\r\n  startScreenShare(shareParam) {\r\n    if (shareParam) { \r\n      if (!('width' in shareParam) || typeof shareParam.width !== 'number') {\r\n        console.error(\"No width or invalid width in shareParam!\");\r\n        return;\r\n      }\r\n\r\n      if (!('height' in shareParam) || typeof shareParam.height !== 'number') {\r\n        console.error(\"No height or invalid height in shareParam!\");\r\n        return;\r\n      }\r\n      \r\n      if (!('frameRate' in shareParam) || typeof shareParam.frameRate !== 'number') {\r\n        console.error(\"No frameRate or invaid frameRate in shareParam!\");\r\n        return;\r\n      }\r\n      \r\n      if (!('bitRate' in shareParam) || typeof shareParam.bitRate !== 'number') {\r\n        console.error(\"No bitRate or invalid bitRate in shareParam!\");\r\n        return;\r\n      }\r\n\r\n      // 保存参数\r\n      this.setScreenShareParam(shareParam);\r\n\r\n      console.log(\"Set screen share param: \", shareParam);\r\n    }\r\n\r\n    protocolSender.sendPublishMediaReq(\r\n      MediaOper.START_PUBLISH, \r\n      MediaType.SCREEN_SHARE, \r\n      \"0\");\r\n  };\r\n\r\n  /**\r\n   * 停止屏幕共享\r\n   */\r\n  stopScreenShare() {\r\n    protocolSender.sendPublishMediaReq(\r\n      MediaOper.STOP_PUBLISH, \r\n      MediaType.SCREEN_SHARE, \r\n      \"0\");\r\n  };\r\n\r\n  /**\r\n   * 开始接受远端屏幕共享\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  startReceiveScreenShare(userId, mediaId) {\r\n    return hstRequest.request({\r\n      eventName: EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.SCREEN_SHARE, mediaId),\r\n      retryConfig: {\r\n        num: 0,\r\n        max: 4\r\n      },\r\n      requestFn: () => {\r\n        protocolSender.sendRecvMediaReq(\r\n          RecvState.START_RECV, \r\n          userId, \r\n          MediaType.SCREEN_SHARE,\r\n          '0');\r\n      }\r\n    })\r\n    // protocolSender.sendRecvMediaReq(\r\n    //   RecvState.START_RECV, \r\n    //   userId, \r\n    //   MediaType.SCREEN_SHARE, \r\n    //   mediaId);\r\n\r\n    // // 可能同时接收多个共享，保证请求和响应匹配\r\n    // return promiseHandler(EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.SCREEN_SHARE, mediaId));\r\n  };\r\n\r\n  /**\r\n   * 停止接收远端屏幕共享\r\n   * @param {*} srcUserId \r\n   * @param {*} mediaId \r\n   */\r\n  stopReceiveScreenShare(srcUserId, mediaId) {\r\n    protocolSender.sendRecvMediaReq(\r\n      RecvState.STOP_RECV, \r\n      srcUserId, MediaType.SCREEN_SHARE, \r\n      mediaId);\r\n\r\n    return promiseHandler(EventType.EVENT_STOP_RCV_MEDIA + getEventPostfix(srcUserId, MediaType.SCREEN_SHARE, mediaId));\r\n  };\r\n}\r\n\r\nexport default new ShareManager();","import Store from \"../util/store\"\r\nimport protocolSender from \"../util/protocol-sender\"\r\n\r\nclass UploadManager {\r\n  constructor () {\r\n    Store.msgDispatcher.addMsgHandler(20011, this._onRecvOpenUploadMsg.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(20003, this._onRecvCloseUploadMsg.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(21001, this._onRecvTransCodeMsg.bind(this));\r\n  }\r\n  startUpload (params) {\r\n    this._init(params)\r\n    this.startUpload_hook.call(this)\r\n    protocolSender.sendOpenUpload({\r\n      file_path: `/${this.file_path}/0.jpg`,\r\n      size: this.size\r\n    })\r\n  }\r\n\r\n  _init(params) {\r\n    // 开始上传\r\n    this.startUpload_hook = params.onStartUpload || function () {}\r\n    // 上传成功（jpg格式）\r\n    this.uploadSuccess_hook = params.onUploadSuccess || function () {}\r\n    // 开始转码\r\n    this.startTransCode_hook = params.onStartTransCode || function () {}\r\n    // 转码成功\r\n    this.transCodeSuccess_hook = params.onTransCodeSuccess || function () {}\r\n\r\n    this.failed_hook = params.onFiled || function () {}\r\n\r\n    this.fileTempPath = params.file\r\n    this.file_name = params.file_name\r\n    this.size = params.file_size\r\n    this.upload_mode = params.upload_mode || 0\r\n    this.check_code = params.CheckCode\r\n    this.appid = params.SrvAppID\r\n    this.link = params.SrvAddrLink\r\n    this.user_id = params.UserID\r\n    this.convert_file_path = String(params.Guid).toUpperCase()\r\n    this.file_path = String(params.Guid).toUpperCase()\r\n    this.upLoadControl = false\r\n\r\n  }\r\n  /**\r\n   * 开始上传响应消息\r\n   * @param {*} data \r\n   */\r\n  _onRecvOpenUploadMsg (data) {\r\n    if (data.code === 0) {\r\n      if (this.upLoadControl) return\r\n      const { bucket, end_point, access_id, signature, policy, key } = data.data\r\n      const guid = this.file_path\r\n      const url = `https://${bucket}.${end_point}`\r\n      this.upLoadControl = true\r\n      setTimeout(()=> {\r\n        this.upLoadControl = false\r\n      }, 1000)\r\n      wx.uploadFile({\r\n        url: url,\r\n        filePath: this.fileTempPath,\r\n        name: 'file',\r\n        header: {\r\n          'content-type': `multipart/form-data; boundary=${guid}`,\r\n        },\r\n        formData: {\r\n          'AccessKeyID': access_id,\r\n          'signature': signature,\r\n          'policy': policy,\r\n          'key': key,\r\n        },\r\n\r\n        success: (res)=> {\r\n          console.log(res.statusCode);            //打印响应状态码\r\n          if(res.statusCode == '204'){\r\n            console.warn('上传图片成功', res)\r\n            wx.showToast({\r\n              title: '上传成功',\r\n              icon: '成功'\r\n            });\r\n            const params = {\r\n              guid,\r\n              check_code: this.check_code,\r\n              appid: this.appid,\r\n              link: this.link,\r\n              file_path: `/${this.file_path}/0.jpg`,\r\n              file_name: this.file_name,\r\n              file_size: this.size,\r\n              user_id: this.user_id\r\n            }\r\n            protocolSender.sendUploadEnd(params)\r\n          }\r\n          else{\r\n            console.log('上传图片失败', res)\r\n            wx.showToast({\r\n              title: '上传失败',\r\n              icon: '失败'\r\n            });\r\n          }\r\n        },\r\n        fail: function(e){\r\n          console.log(e);\r\n        }\r\n      })\r\n    } else {\r\n      this.failed_hook.call(this, {\r\n        code: -1,\r\n        msg: data.msg\r\n      })\r\n    }\r\n  }\r\n  /**\r\n   * 上传结束响应消息\r\n   */\r\n  _onRecvCloseUploadMsg (data) {\r\n    if (data.code === 0) {\r\n      if (this.file_name.includes('.jpg')) {\r\n        this.uploadSuccess_hook.call(this, {\r\n          board_name: this.file_name,\r\n          convert_file_path: data.data.file_path,\r\n          file_path: data.data.file_path,\r\n          check_code: this.check_code,\r\n          appid: this.appid,\r\n          link: this.link,\r\n          id: this.convert_file_path\r\n        })\r\n      } else {\r\n        this.startTransCode_hook.call(this)\r\n        protocolSender.sendTransCodeMsg(this.file_path)\r\n      }\r\n    } else {\r\n      this.failed_hook({\r\n        code: -1,\r\n        msg: data.msg\r\n      })\r\n    }\r\n  }\r\n  /**\r\n   * 转码响应消息\r\n   */\r\n  _onRecvTransCodeMsg (data) {\r\n    if (data.code === 0) {\r\n      data = data.data\r\n      this.transCodeSuccess_hook.call(this, {\r\n        board_name: this.file_name,\r\n        convert_file_path: data.convert_file_path,\r\n        file_path: data.file_path,\r\n        width: data.width,\r\n        height: data.height,\r\n        page: data.convert_counts\r\n      })\r\n    } else {\r\n      this.failed_hook.call(this, {\r\n        code: -1,\r\n        msg: data.msg\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\n\r\n// function getQueryString(name, str) {\r\n//   var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');\r\n//   var r = str.substr(1).match(reg);\r\n//   if (r != null) {\r\n//   return unescape(r[2]);\r\n//   }\r\n//   return null;\r\n// }\r\nexport default new UploadManager()","import protocolSender from \"../util/protocol-sender\"\r\nimport Store from \"../util/store\"\r\nimport { RecvState, MediaType, MediaOper, EventType } from \"../../common/enums\"\r\nimport { promiseHandler, hstRequest } from \"../../common/promise-handler\"\r\nimport logger from \"../../common/logger\"\r\nimport { tracelog, getBitRate } from \"../../common/common\"\r\nimport mediaManager from \"./media-manager\"\r\nimport { getEventPostfix } from '../../common/common'\r\n\r\nclass VideoManager {\r\n  constructor() {\r\n    // User defined video parameters\r\n    // Media Id: { width: xx, height: xx, frameRate: xx, bitRate: xx }\r\n    this.videoParamMap = new Map();\r\n\r\n    // Default video parameters\r\n    this.defaultVideoParam = { frameRate: 15, width: 640, height: 480, bitRate: 0 };\r\n  }\r\n  /**\r\n   * 开始广播视频\r\n   * @param {*} deviceId \r\n   * @param {*} videoParam \r\n   */\r\n  @tracelog\r\n  startPublishVideo(deviceId, videoParam) {\r\n    if (!deviceId) { // TODO：不允许默认设备\r\n      logger.error(\"Invalid deviceId!\");\r\n      return;\r\n    }\r\n\r\n    // videoParam: { width: 640, height: 360, frameRate: 15, bitRate: 1000 }\r\n    if (videoParam) { \r\n      if (!('width' in videoParam) || typeof videoParam.width !== 'number') {\r\n        logger.error(\"No width or invalid width in videoParam!\");\r\n        return;\r\n      }\r\n\r\n      if (!('height' in videoParam) || typeof videoParam.height !== 'number') {\r\n        logger.error(\"No height or invalid height in videoParam!\");\r\n        return;\r\n      }\r\n      \r\n      if (!('frameRate' in videoParam) || typeof videoParam.frameRate !== 'number') {\r\n        logger.error(\"No frameRate or invaid frameRate in videoParam!\");\r\n        return;\r\n      }\r\n      \r\n      if (!('bitRate' in videoParam) || typeof videoParam.bitRate !== 'number') {\r\n        logger.error(\"No bitRate or invalid bitRate in videoParam!\");\r\n        return;\r\n      }\r\n\r\n      // 保存视频参数\r\n      this.setVideoParam(deviceId, videoParam);\r\n    }\r\n\r\n    protocolSender.sendPublishMediaReq(MediaOper.START_PUBLISH, MediaType.VIDEO, deviceId);\r\n    \r\n    // 发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_START_PUB_VIDEO);\r\n  };\r\n\r\n  /**\r\n   * 停止广播视频\r\n   * @param {*} deviceId \r\n   */\r\n  @tracelog\r\n  stopPublishVideo(deviceId) {\r\n    protocolSender.sendPublishMediaReq(MediaOper.STOP_PUBLISH, MediaType.VIDEO, deviceId);\r\n\r\n    // 取消发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_STOP_PUB_VIDEO);\r\n  };\r\n\r\n  /**\r\n   * 开始接收远端视频\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  @tracelog\r\n  startReceiveVideo(userId, mediaId) {\r\n    protocolSender.sendRecvMediaReq(\r\n      RecvState.START_RECV, \r\n      userId, \r\n      MediaType.VIDEO, \r\n      mediaId);\r\n\r\n    // 可能同时接收多个视频，保证请求和响应匹配\r\n    return promiseHandler(EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.VIDEO, mediaId));\r\n  };\r\n\r\n  /**\r\n   * 停止接收远端视频\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  @tracelog\r\n  stopReceiveVideo(userId, mediaId) {\r\n    protocolSender.sendRecvMediaReq(\r\n      RecvState.STOP_RECV, \r\n      userId, \r\n      MediaType.VIDEO, \r\n      mediaId);\r\n\r\n    return promiseHandler(EventType.EVENT_STOP_RCV_MEDIA + getEventPostfix(userId, MediaType.VIDEO, mediaId));\r\n  };\r\n}\r\n\r\nexport default new VideoManager();\r\n","\r\nimport Store from \"../util/store\"\r\nimport protocolSender from \"../util/protocol-sender\"\r\nimport { MediaType, MediaOper, EventType, RecvState, DisplayMode, EventResult } from \"../../common/enums\"\r\nimport { tracelog, asyncWrapper } from '../../common/common'\r\nimport { promiseHandler, hstRequest } from \"../../common/promise-handler\"\r\nimport logger from '../../common/logger'\r\nimport { getEventPostfix } from '../../common/common'\r\nimport Painter from \"./whiteBoard/Painter\"\r\nimport eventRegistry from \"../../common/event-registry\"\r\nimport UploaderManager  from './upload-manager'\r\n\r\n/**\r\n * 管理所有白板对象\r\n */\r\nclass WhiteboardManager {\r\n  constructor() {\r\n    this._init();\r\n\r\n    // 注册信令服务事件\r\n    Store.msgDispatcher.addMsgHandler(19001, this._onCreateWhiteBoardRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(19003, this._onCloseWhiteBoardRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(20005, this._onNotifyGetFileList.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(20007, this._onGetWhiteBoardFileUrlRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(30101, this._onNotifySwitchWhiteBoardRes.bind(this));\r\n\r\n    // 自动恢复白板\r\n    eventRegistry.on(\"restoreWhiteBoard\", this._onRestoreWhiteBoard.bind(this));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * 尝试恢复白板的渲染\r\n   * @param {*} mediaId\r\n   * @returns 是否找到白板 \r\n   */\r\n  @tracelog\r\n  tryRestoreWhiteBoardRender(mediaId) {\r\n    if (this.restoreWhiteBoards.length == 0) {\r\n      logger.log(\"Empty restore white boards.\")\r\n      return false;\r\n    }\r\n\r\n    let board = this.restoreWhiteBoards[0];\r\n    if (board.mediaId != mediaId) {\r\n      logger.log(\"Different white board.\");\r\n      return false;\r\n    }\r\n\r\n    this.setWhiteBoardRender(mediaId, board.parentEle);\r\n    this.setDisplayMode(mediaId, board.displayMode, board.displayParam);\r\n\r\n    this.restoreWhiteBoards.shift();\r\n    if (this.restoreWhiteBoards.length > 0) {\r\n      let board = this.restoreWhiteBoards[0]\r\n      asyncWrapper(()=>{this._doStartReceiveWhiteBoard(board.userId, board.mediaId)})\r\n      console.warn(\"Try to restore white board: \" + board.mediaId)\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * 接收白板\r\n   * @param {*} mediaId \r\n   */\r\n  _doStartReceiveWhiteBoard(userId, mediaId) {\r\n    this.startReceiveWhiteBoard(userId, mediaId).then(()=>{\r\n      logger.log(\"Start receive white board success.\");\r\n    }).catch((e)=>{\r\n      logger.error(\"Start receive white board failed, err: \" + e);\r\n      this.restoreWhiteBoards.shift();\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 恢复白板事件处理\r\n   * @param {*} params \r\n   */\r\n  @tracelog\r\n  _onRestoreWhiteBoard(params) {\r\n    this.restoreWhiteBoards.push(params);\r\n    if (this.restoreWhiteBoards.length == 1) {\r\n      this._doStartReceiveWhiteBoard(params.userId, params.mediaId);\r\n    }\r\n  }\r\n  \r\n\r\n  _onNotifySwitchWhiteBoardRes(params) {\r\n    const { channel_id } = params\r\n    const selectMedia = this.whiteBoards.find(item => { return item.channelId === channel_id })\r\n    selectMedia._updateMsgSeq(params)\r\n  }\r\n\r\n  /**\r\n   * 初始化\r\n   */\r\n  _init() {\r\n    // 包含本地创建和接收远端的白板\r\n    this.whiteBoards = new Array();\r\n\r\n    // 全局显示模式和参数\r\n    this.displayMode = null;\r\n    this.displayParam = null;\r\n\r\n    // fileUrlMap\r\n    this.cacheFileUrlMap = new Map()\r\n    this.cacheTempPathMap = new Map()\r\n\r\n    // 自动恢复白板\r\n    this.restoreWhiteBoards = new Array();\r\n  }\r\n\r\n  /**\r\n   * 创建白板\r\n   */\r\n  createWhiteBoard(params) {\r\n    const path = params.convert_file_path\r\n    if (path) {\r\n      params.board_type = 1\r\n      params.convert_file_path = path.substr(0, path.lastIndexOf('/'))\r\n    }\r\n    protocolSender.sendCreateWhiteboardReq(params);\r\n    return promiseHandler(EventType.EVENT_CREATE_WHITE_BOARD).catch(err=> {\r\n      console.error('createWhiteBoard err', err)\r\n    })\r\n}\r\n  \r\n  /**\r\n   * 创建白板响应\r\n   * @param {*} params \r\n   */\r\n  _onCreateWhiteBoardRes(params) {\r\n    if (params.result === 0) {\r\n      this.startPublishWhiteBoard(params.board_id)\r\n      eventRegistry.trigger(\r\n        EventType.EVENT_CREATE_WHITE_BOARD, \r\n        EventType.EVENT_CREATE_WHITE_BOARD, \r\n        EventType.EVENT_CREATE_WHITE_BOARD, \r\n        params.result == 0 ? EventResult.SUCCESS : EventResult.FAILED)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭白板\r\n   * @param {*} mediaId \r\n   */\r\n  closeWhiteBoard(mediaId) {\r\n    if (!mediaId) {\r\n      console.error(\"Invalid mediaId!\");\r\n      return;\r\n    }\r\n    \r\n    protocolSender.sendCloseWhiteboardReq(mediaId)\r\n    return promiseHandler(EventType.EVENT_CLOSE_WHITE_BOARD);\r\n  }\r\n\r\n  rotateWhiteBoard(rotateAngle, mediaId) {\r\n    const board = this.whiteBoards.find(item => { return item.mediaId === mediaId })\r\n    if (board) {\r\n      board.rotate(rotateAngle)\r\n    }\r\n  }\r\n\r\n  switchWhiteBoard(mediaId) {\r\n    const board = this.whiteBoards.find(item =>item.mediaId === mediaId)\r\n    if (board) {\r\n      protocolSender.sendGetWhiteBoardFullDataReq(board.channelId)\r\n      board.switchBoard()\r\n    }\r\n  }\r\n\r\n  getFileList(filePath) {\r\n    protocolSender.sendRecvBoardFileList(filePath)\r\n  }\r\n\r\n  switchWhiteBoardPage(curPage, mediaId, needNotifyOthers) {\r\n    const board = this.whiteBoards.find(item => { return item.mediaId === mediaId })\r\n    if (board) {\r\n      board.switchBoardPage(curPage, needNotifyOthers)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭白板响应\r\n   * @param {*} params \r\n   */\r\n  _onCloseWhiteBoardRes(params) {\r\n    eventRegistry.trigger(\r\n      EventType.EVENT_CREATE_WHITE_BOARD, \r\n      params.result == 0 ? EventResult.SUCCESS : EventResult.FAILED)\r\n  }\r\n\r\n  /**\r\n   * 开始广播白板\r\n   * @param {*} mediaId \r\n   */\r\n  startPublishWhiteBoard(mediaId) {\r\n    protocolSender.sendPublishMediaReq(MediaOper.START_PUBLISH, MediaType.WHITE_BOARD, mediaId, 'group');\r\n    \r\n    // 发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_START_PUB_WHITE_BOARD);\r\n  }\r\n\r\n  /**\r\n   * 停止广播白板\r\n   * @param {*} mediaId \r\n   */\r\n  stopPublishWhiteBoard(mediaId) {\r\n    protocolSender.sendPublishMediaReq(MediaOper.STOP_PUBLISH, MediaType.WHITE_BOARD, mediaId, 'group');\r\n    \r\n    // 发布响应（暂未实现）\r\n    // return promiseHandler(EventType.EVENT_STOP_PUB_WHITE_BOARD);\r\n  }\r\n\r\n  /**\r\n   * 开始接收白板\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  startReceiveWhiteBoard(userId, mediaId) {\r\n    return hstRequest.request({\r\n      eventName: EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.WHITE_BOARD, mediaId),\r\n      retryConfig: {\r\n        num: 0,\r\n        max: 4\r\n      },\r\n      requestFn: () => {\r\n        protocolSender.sendRecvMediaReq(\r\n          RecvState.START_RECV, \r\n          userId, \r\n          MediaType.WHITE_BOARD,\r\n          mediaId);\r\n      }\r\n    })\r\n    // protocolSender.sendRecvMediaReq(\r\n    //   RecvState.START_RECV, \r\n    //   userId, \r\n    //   MediaType.WHITE_BOARD, \r\n    //   mediaId);\r\n\r\n    // // 可能同时接收多个视频，保证请求和响应匹配\r\n    // return promiseHandler(EventType.EVENT_START_RCV_MEDIA + getEventPostfix(userId, MediaType.WHITE_BOARD, mediaId));\r\n  }\r\n\r\n  /**\r\n   * 停止接收白板\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  stopReceiveWhiteBoard(userId, mediaId) {\r\n    // 关闭远端白板时如果有背景图则删除图片缓存，否则会影响下次创建相同文档白板\r\n    const board = this.whiteBoards.find(board=> { return board.mediaId === mediaId })\r\n    if (board && board.pageStore) {\r\n      const path = board.pageStore.getConvertFilePath()\r\n      if (path) {\r\n        this.cacheFileUrlMap.delete(path)\r\n      }\r\n    }\r\n    // 加上延时避免上面的循环还没做完消息已经发出，白板被销毁\r\n    setTimeout(()=> {\r\n      protocolSender.sendRecvMediaReq(\r\n        RecvState.STOP_RECV, \r\n        userId, \r\n        MediaType.WHITE_BOARD, \r\n        mediaId)\r\n    }, 100)\r\n\r\n    return promiseHandler(EventType.EVENT_STOP_RCV_MEDIA + getEventPostfix(userId, MediaType.WHITE_BOARD, mediaId));\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {*} mediaId \r\n   */\r\n   startUploadDoc(params) {\r\n    UploaderManager.startUpload(params)\r\n  }\r\n\r\n  /**\r\n   * 设置白板渲染器\r\n   * @param {*} mediaId \r\n   * @param {*} parentEle \r\n   */\r\n  setWhiteBoardRender(mediaId, renderEle, params) {\r\n    for (let board of this.whiteBoards) {\r\n      if (board.mediaId == mediaId) {\r\n        board.setRenderElement(renderEle, params);\r\n        return\r\n      }\r\n    }\r\n    logger.warn(\"Cannot find white board by mediaId: \" + mediaId)\r\n  }\r\n\r\n  /**\r\n   * 取消设置白板渲染器\r\n   * @param {*} userId \r\n   * @param {*} mediaId \r\n   */\r\n  unsetWhiteBoardRender(mediaId) {\r\n    for (let board of this.whiteBoards) {\r\n      if (board.mediaId == mediaId) {\r\n        board.setRenderElement(null, null);\r\n        return\r\n      }\r\n    }\r\n    logger.warn(\"Cannot find white board by mediaId: \" + mediaId)\r\n  }\r\n\r\n  /**\r\n   * 设置显示模式\r\n   * @param {*} mediaId \r\n   * @param {*} mode \r\n   * @param {*} param \r\n   */\r\n  @tracelog\r\n  setDisplayMode(mediaId, mode, param) {\r\n    if (mode != DisplayMode.DBWZ \r\n      && mode != DisplayMode.DBSY \r\n      && mode != DisplayMode.DBSF) {\r\n      logger.error(\"Invalid display mode: \" + mode);\r\n      return;\r\n    }\r\n\r\n    if (mode == DisplayMode.DBSF) { \r\n      if (!param) {\r\n        logger.error(\"setDisplayMode param is invalid!\");\r\n        return;\r\n      } else {\r\n        if (!Number.isInteger(param)) {\r\n          logger.error(\"setDisplayMode param should be integer!\");\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!mediaId) { // 全局设置\r\n      for (const board of this.whiteBoards) {\r\n        board.setDisplayMode(mode, param);\r\n      }\r\n      this.displayMode = mode;\r\n      this.displayParam = param;\r\n    } else { // 单独设置\r\n      let board = this._findWhiteBoard(mediaId);\r\n      if (board) {\r\n        board.setDisplayMode(mode, param);\r\n      } else {\r\n        logger.error(\"Cannot find white board \" + mediaId);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 收到开始接收白板的响应\r\n   * @param {*} params \r\n   */\r\n  onStartRecvWhiteBoardRes(params) {\r\n    let board = this._findWhiteBoard(params.mediaId)\r\n    if (board) {\r\n      const { renderEle, parentWidth, parentHeight, displayParam, canvasSizeChangeCallback } = board\r\n      const params = {\r\n        parentWidth, \r\n        parentHeight,\r\n        scaleRatio: displayParam,\r\n        canvasSizeChange: canvasSizeChangeCallback\r\n      }\r\n      renderEle && board.setRenderElement(renderEle, params)\r\n      logger.info(\"board exits:\", board)\r\n    } else {\r\n      let board = new Painter(params);\r\n      this.whiteBoards.push(board);\r\n      if (this.displayMode) { // 默认使用全局设置\r\n        board.setDisplayMode(this.displayMode, this.displayParam);\r\n      }\r\n      logger.info(\"Total white board count: \" + this.whiteBoards.length)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 收到停止接收白板的响应\r\n   * @param {*} params \r\n   */\r\n  @tracelog\r\n  onStopRecvWhiteBoardRes(params) {\r\n    let board = this._findWhiteBoard(params.mediaId)\r\n    if (board) {\r\n      for (let i = 0; i < this.whiteBoards.length; i++) {\r\n        if (this.whiteBoards[i].mediaId == params.mediaId) {\r\n          // this.whiteBoards[i].close();\r\n          this.whiteBoards.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n    } else {\r\n      logger.error(\"Cannot find White baord \" + params.mediaId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重新初始化\r\n   */\r\n  @tracelog\r\n  reinitialize() {\r\n    for (const board of this.whiteBoards) {\r\n      board.close();\r\n    }\r\n    this._init();\r\n  }\r\n\r\n  /**\r\n   * 移除指定白板\r\n   * @param {*} mediaId \r\n   */\r\n  removeWhiteBoard(mediaId) {\r\n    this.whiteBoards.forEach(function(board, index, arr) {\r\n      if (board.mediaId == mediaId) {\r\n        arr.splice(index, 1);\r\n        return false;\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取指定白板\r\n   * @param {*} mediaId \r\n   */\r\n  getWhiteBoard(mediaId) {\r\n    return this._findWhiteBoard(mediaId)\r\n  }\r\n\r\n  /**\r\n   * 查找白板\r\n   * @param {*} mediaId \r\n   */\r\n  _findWhiteBoard(mediaId) {\r\n    for (const board of this.whiteBoards) {\r\n      if (board.mediaId == mediaId) {\r\n        return board;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * 获取白板图片响应\r\n   * @param {*} data \r\n   */\r\n  _onGetWhiteBoardFileUrlRes(data) {\r\n    if (data.code === 0) {\r\n      let filePath = data.data.file_path\r\n      const rootPath = filePath.substr(0, filePath.lastIndexOf('/'))\r\n      let fileUrls = this.cacheFileUrlMap.get(rootPath) || new Map()\r\n      // 微信小程序只能访问https\r\n      let httpsUrl = data.data.url\r\n      if (data.data.url.search(\"https\") == -1) {\r\n        httpsUrl = data.data.url.replace(/^http/, \"https\")\r\n      }\r\n      fileUrls.set(data.data.file_path, httpsUrl)\r\n      this.cacheFileUrlMap.set(rootPath, fileUrls)\r\n    } else {\r\n      console.warn('获取图片下载url失败')\r\n    }\r\n  }\r\n\r\n  _onNotifyGetFileList(data) {\r\n    const fileList = data.data.file_list\r\n    eventRegistry.trigger('onGetFileList', fileList)\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {*} file_path\r\n   */\r\n  _getFileUrl (file_path) {\r\n    // 地址存储过 不用查询\r\n    if (!file_path) return\r\n    const rootPath = file_path.substr(0, file_path.lastIndexOf('/'))\r\n    if (this.cacheFileUrlMap.get(rootPath) && this.cacheFileUrlMap.get(rootPath).get(file_path)) return\r\n    protocolSender.sendGetWhiteBoardFileUrlReq(file_path)\r\n  }\r\n}\r\n\r\nexport default new WhiteboardManager();","\r\nimport hstWebSocket from '../../util/new_webscoket'\r\nimport { MediaType, DisplayMode, Graphics } from \"../../../common/enums\"\r\nimport MsgDispatcher from '../../util/msg-dispatcher'\r\nimport { tracelog, colorToNumber, stringToColor, dealCanvasSize } from '../../../common/common'\r\nimport logger from '../../../common/logger'\r\nimport eventRegistry from '../../../common/event-registry'\r\nimport PageStore from \"./page-store\"\r\nimport wbManager from \"../white-board-manager\"\r\nimport Render from './render/render'\r\nimport WriteBoard from './write/write'\r\nimport protocolSender from \"../../util/protocol-sender\"\r\nimport { promiseHandler } from \"../../../common/promise-handler\"\r\n\r\nconst EDIT_WHITE_BOARD = 'edit_white_board'\r\n\r\n/**\r\n * 只读的白板对象（仅接收白板数据）\r\n */\r\nclass Painter {\r\n  constructor(params) {\r\n    this.isClosing = false\r\n    this.isSelect = false\r\n    this.isRotate = false\r\n    this.isSwitchPage = false\r\n    this.rotateAngle = 0\r\n\r\n    // 页数据存储\r\n    this.pageStore = null;\r\n    this.render = null;\r\n\r\n    // 是否是第一次获取全量数据\r\n    this.firstFullData = true;\r\n\r\n    // 缩放比例\r\n    this.scaleRatio = 1;\r\n\r\n    // 白板的原始宽高\r\n    this.width = 0;\r\n    this.height = 0;\r\n\r\n    this.write = null;\r\n\r\n    // Canvas父标签宽高\r\n    this.parentWidth = 0;\r\n    this.parentHeight = 0;\r\n\r\n    // Canvas标签宽高\r\n    this.canvasWidth = 0;\r\n    this.canvasHeight = 0;\r\n\r\n\r\n    // Canvas\r\n    this.canvasEle = null;\r\n    this.canvasCtx = null;\r\n    this.canvasSizeChangeCallback = null;\r\n\r\n    // Canvas的CSS样式大小和位置\r\n    this.canvasLeft = 0;\r\n    this.canvasTop = 0;\r\n    this.canvasWidth = 0;\r\n    this.canvasHeight = 0;\r\n\r\n    // 缓存全量数据\r\n    this.sourcePaints = [];\r\n\r\n    this.firstGetFullData = false\r\n    // 服务器发送的消息序列号\r\n    this.msg_seq_id = null;\r\n\r\n    // 本地发送消息序列号\r\n    this.local_seq_id = this.msg_seq_id\r\n\r\n\r\n    // 显示模式和参数\r\n    this.displayMode = DisplayMode.DBSY;\r\n    this.displayParam = null;\r\n    \r\n    // 保存构建参数\r\n    this.userId = params.userId;\r\n    this.mediaId = params.mediaId;\r\n    this.mediaName = params.mediaName;\r\n    this.streamId = params.streamId;\r\n    this.streamToken = params.streamToken;\r\n    this.streamServer = params.streamServer\r\n    this.channelId = ''\r\n    this.seqId = parseInt(Math.random() * (1000 - 3000) + 3000)\r\n\r\n    // 注册媒体服务事件\r\n    this.msgDispatcher = new MsgDispatcher();\r\n    this.msgDispatcher.addMsgHandler(30002, this._editRes.bind(this))\r\n    this.msgDispatcher.addMsgHandler(31000, this._dealAmendData.bind(this)) // 直线\r\n    this.msgDispatcher.addMsgHandler(31002, this._dealAmendData.bind(this)) // 曲线\r\n    this.msgDispatcher.addMsgHandler(30103, this._mouseMove.bind(this)) // 鼠标点\r\n    this.msgDispatcher.addMsgHandler(31004, this._dealAmendData.bind(this)) // 矩形 圆角矩形 椭圆\r\n    this.msgDispatcher.addMsgHandler(31006, this._dealAmendData.bind(this)) // 文字\r\n    \r\n    this.msgDispatcher.addMsgHandler(31008, this._dealAmendData.bind(this)) // 图片\r\n    this.msgDispatcher.addMsgHandler(30200, this._pageChangeHandle.bind(this)) // 切页\r\n    this.msgDispatcher.addMsgHandler(30202, this._moveGraph.bind(this)) // 移动\r\n    \r\n    this.msgDispatcher.addMsgHandler(30000, this._heartBeat.bind(this))\r\n    this.msgDispatcher.addMsgHandler(30004, this._dealFullData.bind(this))\r\n    this.msgDispatcher.addMsgHandler(19005, this._processLoginResp.bind(this));\r\n\r\n    this.msgDispatcher.addMsgHandler(101, this._onConnectSuccess.bind(this)) //监听通道建立成功\r\n\r\n    // 创建WebSocket连接\r\n    this.websocket = hstWebSocket\r\n    this.websocket.createProxyConnect({\r\n      backward_addr: this.streamServer,\r\n      handler: this.msgDispatcher,\r\n      seq_id: this.seqId,\r\n      closed: this._onWebsocketClosed.bind(this),\r\n      error: this._onWebsocketError.bind(this)\r\n    });\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 登录接收通道响应\r\n   * @param {*} msg \r\n   */\r\n  @tracelog\r\n  _processLoginResp(msg) {\r\n    if (msg.result != 0) {\r\n      logger.warn(\"Login white board receive channel failed!\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * WebSocket建立成功\r\n   */\r\n  @tracelog\r\n  _onWebsocketOpen(channelId) {\r\n    protocolSender.sendLoginRecvChannelReq({\r\n      mediaType: MediaType.WHITE_BOARD,\r\n      mediaId: \"\",\r\n      streamId: this.streamId,\r\n      streamToken: this.streamToken,\r\n      channelId\r\n    })\r\n  }\r\n\r\n  /**\r\n   * WebSocekt关闭\r\n   */\r\n  @tracelog\r\n  _onWebsocketClosed() {\r\n    if (!this.isClosing) {\r\n      if (this.websocket.reconnectNum < 10 ) {\r\n        setTimeout(() => {\r\n          this.websocket.reconnect({\r\n              backward_addr: this.streamServer,\r\n              handler: this.msgDispatcher,\r\n              seq_id: this.seqId,\r\n              closed: this._onWebsocketClosed.bind(this),\r\n              error: this._onWebsocketError.bind(this)\r\n            })\r\n        }, 1000)\r\n      } else {\r\n        // throw error  \r\n        eventRegistry.trigger('onError') \r\n      }\r\n  }\r\n   \r\n    // if (!this.isClosing) {\r\n    //   asyncWrapper(()=>{eventRegistry.trigger(\"restoreWhiteBoard\", {\r\n    //     userId: this.userId,\r\n    //     mediaId: this.mediaId,\r\n    //     parentEle: this.parentEle,\r\n    //     displayMode: this.displayMode,\r\n    //     displayParam: this.displayParam})\r\n    //   })\r\n    //   this.close();\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * WebSocket错误\r\n   */\r\n  @tracelog\r\n  _onWebsocketError() {\r\n  }\r\n\r\n  _onConnectSuccess(msg, socket) {\r\n    console.warn('_onConnectSuccess msg', msg)\r\n    const {result, channel_id, seq} = msg\r\n    if (result === 0) {\r\n      if (seq === this.seqId) {\r\n        this.channelId = channel_id\r\n        this._onWebsocketOpen(channel_id)\r\n      } else {\r\n        logger.info('proxyChannel has exist')\r\n      }\r\n    }\r\n  }\r\n\r\n  switchBoard() {\r\n    // 切换白板时canvasCtx里面canvas的宽高没有变化，需要手动重新赋值\r\n    this.canvasCtx.canvas.width = this.canvasWidth\r\n    this.canvasCtx.canvas.height = this.canvasHeight\r\n    this.canvasSizeChangeCallback && this.canvasSizeChangeCallback(\r\n      this.canvasLeft,\r\n      this.canvasTop,\r\n      this.canvasWidth, \r\n      this.canvasHeight\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 设置显示模式\r\n   * @param {*} mode \r\n   * @param {*} param \r\n   */\r\n  setDisplayMode(mode, param) {\r\n    if (this.displayMode != mode // 显示模式改变\r\n      || (mode == DisplayMode.DBSF && param && this.displayParam != param)) { // 等比缩放参数改变\r\n      this.displayMode = mode;\r\n      this.displayParam = param;\r\n      this._showWhiteBoard();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 等比完整显示\r\n   */\r\n  _showWhiteBoardDbwz() {\r\n    // 计算宽高比\r\n    let showRatio = this.parentHeight / this.parentWidth.toFixed(6);\r\n    let dataRatio =  this.height / this.width.toFixed(6);\r\n\r\n    // 显示窗口比数据窗口显得更加修长，则基于宽度进行缩放\r\n    if (showRatio > dataRatio ) {\r\n      // 设置Canvas宽高\r\n      this.canvasWidth = this.parentWidth;\r\n      this.canvasHeight = this.height * this.parentWidth / this.width.toFixed(6);\r\n\r\n      // 设置Canvas位置\r\n      this.canvasLeft = 0;\r\n      this.canvasTop = (this.parentHeight - this.canvasHeight) / 2\r\n    } else { // 显示窗口比数据窗口显得更加扁平，则基于高度进行缩放\r\n      // 设置Canvas宽高\r\n      this.canvasWidth = this.width * this.parentHeight / this.height.toFixed(6);\r\n      this.canvasHeight = this.parentHeight;\r\n\r\n      // 设置Canvas位置\r\n      this.canvasLeft = (this.parentWidth - this.canvasWidth) / 2;\r\n      this.canvasTop = 0;\r\n    }\r\n\r\n    // 通知上层应用调整Canvas宽高\r\n    this.canvasSizeChangeCallback(\r\n      this.canvasLeft,\r\n      this.canvasTop,\r\n      this.canvasWidth, \r\n      this.canvasHeight)\r\n\r\n    // 更新缩放比例，供显示的时候使用\r\n    this.scaleRatio = this.canvasHeight / this.height.toFixed(6);\r\n    this.canvasEle.width = this.canvasWidth\r\n    this.canvasEle.height = this.canvasHeight\r\n\r\n    this._refreshRender();\r\n  }\r\n\r\n  /**\r\n   * 等比适应显示\r\n   */\r\n  _showWhiteBoardDbsy() {\r\n    // 计算宽高比\r\n    let showRatio = this.parentHeight / Number(this.parentWidth).toFixed(6);\r\n    let dataRatio =  this.height / Number(this.width).toFixed(6);\r\n\r\n    // 显示窗口比数据窗口显得更加修长，则基于高度进行缩放\r\n    if (showRatio > dataRatio ) {\r\n      // 设置Canvas宽高\r\n      this.canvasWidth = this.width * this.parentHeight / Number(this.height).toFixed(6);\r\n      this.canvasHeight = this.parentHeight;\r\n\r\n      // 设置Canvas位置\r\n      this.canvasLeft = 0;\r\n      this.canvasTop = 0;\r\n    } else { // 显示窗口比数据窗口显得更加扁平，则基于宽度进行缩放\r\n      // 设置Canvas宽高\r\n      this.canvasWidth = this.parentWidth;\r\n      this.canvasHeight = this.height * this.parentWidth / Number(this.width).toFixed(6);\r\n\r\n      // 设置Canvas位置\r\n      this.canvasLeft = 0;\r\n      this.canvasTop = 0;\r\n    }\r\n\r\n    const { width, height } = dealCanvasSize(this.canvasWidth, this.canvasHeight)\r\n    this.canvasWidth = Number(width).toFixed(6)\r\n    this.canvasHeight = Number(height).toFixed(6)\r\n\r\n    // 通知上层应用调整Canvas宽高\r\n    this.canvasSizeChangeCallback(\r\n      this.canvasLeft,\r\n      this.canvasTop,\r\n      this.canvasWidth, \r\n      this.canvasHeight)\r\n\r\n    // 更新缩放比例，供显示的时候使用\r\n    this.scaleRatio = this.canvasHeight / this.height.toFixed(6);\r\n\r\n    // 更新Canvas宽高\r\n    this.canvasEle.width = this.canvasWidth\r\n    this.canvasEle.height = this.canvasHeight\r\n\r\n    this._refreshRender();\r\n  }\r\n\r\n  /**\r\n   * 等比缩放显示\r\n   */\r\n  _showWhiteBoardDbsf() {\r\n     // 设置Canvas宽高\r\n     this.canvasWidth = this.width * this.displayParam.toFixed(6) / 100;\r\n     this.canvasHeight = this.height * this.displayParam.toFixed(6) / 100;\r\n \r\n     // 设置Canvas位置\r\n     if (this.canvasWidth >= this.parentWidth) {\r\n       this.canvasLeft = 0;\r\n       // this.parentEle.style.overflowX = 'scroll';\r\n     } else {\r\n       this.canvasLeft = (this.parentWidth - this.canvasWidth) / 2;\r\n       // this.parentEle.style.overflowX = 'hidden';\r\n     }\r\n     \r\n     if (this.canvasHeight >= this.parentHeight) {\r\n       this.canvasTop = 0;\r\n       // this.parentEle.style.overflowY = 'scroll';\r\n     } else {\r\n       this.canvasTop = (this.parentHeight - this.canvasHeight) / 2;\r\n       // this.parentEle.style.overflowY = 'hidden';\r\n     }\r\n \r\n     // 通知上层应用调整Canvas宽高\r\n     this.canvasSizeChangeCallback(\r\n       this.canvasLeft,\r\n       this.canvasTop,\r\n       this.canvasWidth, \r\n       this.canvasHeight)\r\n \r\n     // 更新缩放比例\r\n     this.scaleRatio = this.displayParam.toFixed(6) / 100;\r\n \r\n     // 更新Canvas宽高\r\n     this.canvasEle.width = this.canvasWidth\r\n     this.canvasEle.height = this.canvasHeight\r\n\r\n    this._refreshRender();\r\n  }\r\n\r\n  /**\r\n   * 渲染白板\r\n   */\r\n  _showWhiteBoard() {\r\n    if (!this.canvasEle || !this.canvasCtx) {\r\n      console.warn(\"Invalid canvas render!\")\r\n      return;\r\n    }\r\n\r\n    // 绘制背景图片\r\n    if (this.pageStore && this.pageStore.getConvertFilePath()) {\r\n      this.render && this.render._insertImage()\r\n    }\r\n\r\n    // 绘制图形\r\n    if (this.displayMode == DisplayMode.DBWZ) {\r\n      this._showWhiteBoardDbwz();\r\n    } else if (this.displayMode == DisplayMode.DBSY) {\r\n      this._showWhiteBoardDbsy();\r\n    } else if (this.displayMode == DisplayMode.DBSF) {\r\n      this._showWhiteBoardDbsf();\r\n    } else {\r\n      logger.error(\"Unknown display mode: \" + this.displayMode);\r\n    }\r\n  }\r\n\r\n  /**\r\n * 设置Canvas父节点\r\n * @param {*} parentEle \r\n */\r\n  @tracelog\r\n  setRenderElement(renderEle, params) {\r\n    logger.warn(\"Set render element: \" + JSON.stringify(params));\r\n    logger.warn(\"renderEle\", [renderEle]);\r\n    if (renderEle) {\r\n      this.canvasEle = renderEle;\r\n\r\n      // this.canvasEle.width = this.width\r\n      // this.canvasEle.height = this.height\r\n\r\n      this.parentWidth = params.parentWidth;\r\n      this.parentHeight = params.parentHeight;\r\n\r\n      if (!params.parentWidth || !params.parentWidth) {\r\n        const { screenWidth, screenHeigh } = wx.getSystemInfoSync()\r\n        this.parentWidth = screenWidth\r\n        this.parentHeight = screenHeigh\r\n      }\r\n\r\n      this.displayParam = params.scaleRatio || 1\r\n      this.canvasSizeChangeCallback = params.canvasSizeChange;\r\n\r\n      // 获取Canvas上下文\r\n      this.canvasCtx = this.canvasEle.getContext('2d');\r\n\r\n      if (this.pageStore) {\r\n        this.pageStore = new PageStore(this.sourcePaints)\r\n        this.render = new Render(this, this.pageStore)\r\n        this.write = new WriteBoard(this, this.pageStore)\r\n      }\r\n\r\n      // 设置父节点后立即显示\r\n      this._showWhiteBoard();\r\n    } else {\r\n      // 清除画布图元\r\n      this._emptyCanvas();\r\n\r\n      // 移除Canvas节点\r\n      if (this.canvasEle) {\r\n        this.canvasEle.width = 0\r\n        this.canvasEle.height = 0\r\n        this.canvasCtx = null;\r\n        this.canvasEle = null;\r\n      }\r\n    \r\n      this.canvasSizeChangeCallback = null;\r\n\r\n      this.parentWidth = 0;\r\n      this.parentHeight = 0;\r\n      throw new Error('can not find canvasEle!!')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化canvas画板\r\n   * @param {*} boardInfo \r\n   */\r\n  _initCanvas (boardInfo) {\r\n    // 保存白板逻辑大小\r\n    this.width = boardInfo.width\r\n    this.height = boardInfo.height\r\n\r\n    // 先清除一下白板内容\r\n    if (this.canvasCtx) {\r\n      this.canvasCtx.clearRect(0, 0, boardInfo.width, boardInfo.height);\r\n    }\r\n\r\n    // 获取图片URL（不一次性请求所有图片）\r\n    // wbManager._getFileUrl(boardInfo.convert_file_path, boardInfo.page)\r\n    \r\n    // 绘制背景图片\r\n    if (this.pageStore && this.pageStore.getConvertFilePath()) {\r\n      this.render && this.render._insertImage()\r\n    }\r\n    // 绘制图形\r\n    this._refreshRender()\r\n  }\r\n\r\n  /**\r\n   * 等待从服务器获取图片URL\r\n   */\r\n   _waitGetImageUrl() {\r\n    const convertPath = this.pageStore.getConvertFilePath()\r\n    return new Promise(function(resolve, reject) {\r\n      let count = 0\r\n      let handle = setInterval(() => {\r\n        ++count\r\n        if (wbManager.cacheFileUrlMap.get(convertPath)) {\r\n          clearInterval(handle)\r\n          resolve()\r\n        } else {\r\n          if (count > 10) { // 最多等待5秒\r\n            clearInterval(handle)\r\n            reject(\"等待获取图片URL失败\")\r\n          }\r\n        }\r\n      }, 500)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 插入背景图片\r\n   */\r\n  _drawImage() {\r\n    let self = this\r\n    const convertPath = this.pageStore.getConvertFilePath()\r\n    let rootPath = convertPath\r\n    const curPage = this.pageStore.getCurPage()\r\n    let fullPath = convertPath\r\n    if (!String(fullPath).toLowerCase().includes('.jpg')) {\r\n      fullPath = `${convertPath}/${curPage}.jpg`\r\n    } else {\r\n      rootPath = convertPath.substr(0, convertPath.lastIndexOf('/'))\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n      let imgUrl = wbManager.cacheFileUrlMap.get(rootPath).get(fullPath)\r\n      logger.info('imgUrl')\r\n      logger.info(imgUrl)\r\n      wx.downloadFile({\r\n        url: imgUrl,\r\n        timeout: 5000,\r\n        success: (res)=> {\r\n          logger.info('downloadFile res')\r\n          logger.info(JSON.stringify(res))\r\n          if (res.statusCode === 200 && self.canvasEle) {\r\n            let seal = self.canvasEle.createImage();\r\n            seal.src = res.tempFilePath\r\n            seal.onload = function() {\r\n              try {\r\n                logger.info(\"加载图片成功\")\r\n                if (self.canvasCtx) {\r\n                  self.canvasCtx.drawImage(\r\n                    seal, \r\n                    0,\r\n                    0,\r\n                    self.canvasWidth, \r\n                    self.canvasHeight);\r\n                }\r\n                resolve();\r\n              } catch(err) {\r\n                logger.error('draw image error', err);\r\n              }\r\n            }\r\n            seal.onerror = function(res) {\r\n              logger.error(\"加载图片失败\", res)\r\n              reject()\r\n            }\r\n          }\r\n        },\r\n        fail: function(err) {\r\n          logger.warn(\"download image failed!\")\r\n          logger.warn(err)\r\n          reject()\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 重绘render，需要保证背景图片比图元先绘制\r\n   */\r\n   _refreshRender() {\r\n    let self = this\r\n    self._emptyCanvas()\r\n    if (self.pageStore && self.pageStore.getConvertFilePath()) {\r\n      self._waitGetImageUrl().then(()=>{\r\n        logger.log(\"Image url is ready.\")\r\n        self._drawImage().then(()=>{\r\n          logger.log(\"Draw image finished.\")\r\n          this.render && this.render._drawAllPaint()\r\n        }).catch(()=>{\r\n          logger.log(\"Draw image failed!\")\r\n        })\r\n      }).catch((err)=>{\r\n        logger.warn(err)\r\n      })\r\n    } else {\r\n      logger.log(\"无需绘制背景图片\")\r\n      this.render && this.render._drawAllPaint()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 清除画板\r\n   */\r\n  _emptyCanvas() {\r\n    if (this.canvasCtx) {\r\n      this.canvasCtx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\r\n    }\r\n  }\r\n\r\n  /**\r\n * 全量重新绘图\r\n */\r\n  _drawAllPaint() {\r\n    if (this.pageStore) {\r\n      let paintObjs = this.pageStore.findPagePaints(this.pageStore.getCurPage())\r\n      paintObjs.map((item) => {\r\n        this._drawPaint(item.type, item[item.type])\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 增量绘图\r\n   * @param {*} pageData \r\n   * @param {*} paintObj \r\n   */\r\n  _drawAmendData (pageData, paintObj) {\r\n    if (paintObj.type !== Graphics.CURVE) {\r\n      this._emptyCanvas()\r\n      this._drawAllPaint()\r\n    } else { // 只需绘制修改图元\r\n      const paint = this.pageStore.findPaintByGid(pageData, paintObj[paintObj.type].gid)\r\n      if (paint) {\r\n        this._drawPaint(paint.type, paint[paint.type])\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 修改/删除/新增 图元\r\n   * @param {*} paintObj \r\n   */\r\n  _dealAmendData (paintObj) {\r\n    if (paintObj.channel_id !== this.channelId) return\r\n    this._updateMsgSeq(paintObj);\r\n    this.render && this.render.dealAmendData(paintObj)\r\n  }\r\n\r\n  /**\r\n   * 页变化\r\n   * @param {*} pageObj \r\n   */\r\n  _pageChangeHandle (pageObj) {\r\n    if (pageObj.channel_id !== this.channelId) return\r\n    this._updateMsgSeq(pageObj);\r\n    this.render && this.render.pageChange(pageObj)\r\n  }\r\n\r\n  /**\r\n   * 移动图元\r\n   * @param {*} paintObj \r\n   */\r\n  _moveGraph (paintObj) {\r\n    this._updateMsgSeq(paintObj);\r\n    this.render && this.render.moveGraph(paintObj)\r\n  }\r\n  /**\r\n   * 鼠标移动\r\n   * @param {*} paintObj \r\n   */\r\n  _mouseMove (paintObj) {\r\n    this._updateMsgSeq(paintObj)\r\n    const { rotate_angle, cur_page } = paintObj\r\n    if (rotate_angle || rotate_angle === 0) {\r\n      this.rotateAngle = rotate_angle\r\n      eventRegistry.trigger('shareOperation', {\r\n        userId: this.userId,\r\n        mediaId: this.mediaId, \r\n        rotateAngle: rotate_angle,\r\n        type: 'rotate'\r\n      })\r\n    }\r\n    if (cur_page || cur_page === 0) {\r\n      this._pageChangeHandle(paintObj)\r\n    }\r\n  }\r\n\r\n  // 编辑响应\r\n  _editRes (data) {\r\n    if (data.channel_id !== this.channelId) return\r\n    this.pageStore.editConfig.id = data.edit_id\r\n    if (this.isSelect) {\r\n      protocolSender.sendSwitchWhiteBoard(data.edit_id, this.channelId)\r\n      this.isSelect = false\r\n    } else if (this.isRotate) {\r\n      const params = {\r\n        edit_id: data.edit_id,\r\n        rotateAngle: this.rotateAngle,\r\n      }\r\n      protocolSender.sendChangeWhiteBoardProperty(params, this.channelId)\r\n      this.isRotate = false\r\n    } else if (this.isSwitchPage) {\r\n      const params = {\r\n        edit_id: this.pageStore.editConfig.id,\r\n        cur_page: this.pageStore.getCurPage(),\r\n      }\r\n      protocolSender.sendChangeWhiteBoardProperty(params, this.channelId)\r\n      this.isSwitchPage = false\r\n    } else {\r\n      this.pageStore.editConfig.status = true\r\n      eventRegistry.trigger(EDIT_WHITE_BOARD, 0, true)\r\n    }\r\n  }\r\n\r\n  // select() {\r\n  //   if (this.pageStore && this.pageStore.editConfig && this.pageStore.editConfig.id) {\r\n  //     protocolSender.sendSwitchWhiteBoard(this.pageStore.editConfig.id, this.channelId)\r\n  //   } else {\r\n  //     this.isSelect = true\r\n  //     protocolSender.sendOpenEdit(this.channelId)\r\n  //   }\r\n  // }\r\n\r\n  rotate(rotateAngle) {\r\n    this.rotateAngle = rotateAngle\r\n    if (this.pageStore.editConfig.id) {\r\n      const params = {\r\n        edit_id: this.pageStore.editConfig.id,\r\n        rotateAngle,\r\n      }\r\n      protocolSender.sendChangeWhiteBoardProperty(params, this.channelId)\r\n    } else {\r\n      this.isRotate = true\r\n      protocolSender.sendOpenEdit(this.channelId)\r\n    }\r\n  }\r\n\r\n  switchBoardPage(curPage, needNotifyOthers) {\r\n    this.pageStore.setCurPage(curPage)\r\n    if (needNotifyOthers) {\r\n      if (this.pageStore.editConfig.id) {\r\n        const params = {\r\n          edit_id: this.pageStore.editConfig.id,\r\n          cur_page: curPage,\r\n        }\r\n        protocolSender.sendChangeWhiteBoardProperty(params, this.channelId)\r\n      } else {\r\n        this.isSwitchPage = true\r\n        protocolSender.sendOpenEdit(this.channelId)\r\n      }\r\n    } else {\r\n      if (this.pageStore && this.pageStore.getConvertFilePath()) {\r\n        this.render && this.render._insertImage()\r\n      }\r\n      this._refreshRender()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭白板\r\n   */\r\n  @tracelog\r\n  close() {\r\n    logger.log(\"Close white board: \" + this.mediaId)\r\n    this.isClosing = true;\r\n\r\n    this.pageStore = null;\r\n    this.msgDispatcher = null;\r\n\r\n    if (this.intervalHandle) {\r\n      clearInterval(this.intervalHandle);\r\n      this.intervalHandle = null;\r\n    }\r\n\r\n    if (this.parentEle && this.canvasEle) {\r\n      this.parentEle.removeChild(this.canvasEle);\r\n      //this.parentEle = null;\r\n      this.canvasEle = null;\r\n    }\r\n\r\n    if (this.websocket) {\r\n      this.websocket.close();\r\n      this.websocket = null;\r\n    }\r\n    // let params = {\r\n    //   userId: null,\r\n    //   mediaType: MediaType.WHITE_BOARD,\r\n    //   mediaId: this.mediaId,\r\n    //   mediaName: this.pageStore.getBoardName()\r\n    // };\r\n    // eventRegistry.trigger(\"onUnPublishMedia\", params);\r\n  }\r\n  \r\n  /**\r\n   * 处理全量数据\r\n   * @param {*} msg \r\n   */\r\n  _dealFullData(msg) {\r\n    if (msg.channel_id !== this.channelId) return\r\n    // 有可能会有多个消息，先缓存\r\n    this.sourcePaints = this.sourcePaints.concat(msg.data)\r\n    // 全量数据同步完成\r\n    if (msg.sync_end) {\r\n      logger.log(\"Get white board full data complete.\");\r\n      this.pageStore = new PageStore(this.sourcePaints)\r\n      this.render = new Render(this, this.pageStore)\r\n      this.write = new WriteBoard(this, this.pageStore)\r\n      if (this.sourcePaints[0].board) {\r\n        this._initCanvas(this.sourcePaints[0].board)\r\n      } else {\r\n        logger.error(\"Invalid source paints: \" + JSON.stringify(this.sourcePaints));\r\n        this.sourcePaints = [];\r\n        return;\r\n      }\r\n\r\n      // 通知上层开始渲染\r\n      if (this.firstFullData) {\r\n        if (!wbManager.tryRestoreWhiteBoardRender(this.mediaId)) {\r\n          const board = this.sourcePaints[0].board\r\n          const rotateAngle = board.property && board.property.rotate_angle || 0\r\n          const { rights_index = 0, name, ex_name } = JSON.parse(board.user_data)\r\n          let boardName = name\r\n          if (ex_name && !String(boardName).includes(String(ex_name))) {\r\n            boardName = `${name}.${ex_name}`\r\n          }\r\n          eventRegistry.trigger(\"onRemoteMediaAdd\", { \r\n            userId: this.userId, \r\n            mediaType: MediaType.WHITE_BOARD, \r\n            mediaId: this.mediaId,\r\n            rotateAngle,\r\n            rightIndex: rights_index,\r\n            mediaName: boardName || this.pageStore.getBoardName(),\r\n            totalPage: this.pageStore.getPageCount(),\r\n            curPage: this.pageStore.getCurPage(),\r\n          })\r\n        }\r\n        this.firstFullData = false;\r\n      }\r\n\r\n      this.sourcePaints = [];\r\n    }\r\n  }\r\n  _updateMsgSeq (msg) {\r\n    const { channel_id, seq_id } = msg\r\n    if (channel_id === this.channelId) {\r\n      this.msg_seq_id = seq_id\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查是否有丢消息，如果消息序列号异常，需要重新拉取全量数据\r\n   * @param {*} msg \r\n   */\r\n  _checkMsgSeq(msg) {\r\n    const { seq_id } = msg\r\n    if (!this.firstGetFullData || !this.msg_seq_id // 第一次收到心跳\r\n      || (this.msg_seq_id !== null && seq_id - this.msg_seq_id != 1)) { // 序列号不连续\r\n      protocolSender.sendGetWhiteBoardFullDataReq(this.channelId);\r\n      this.firstGetFullData = true\r\n    }\r\n    this.msg_seq_id = seq_id\r\n    this.local_seq_id = this.msg_seq_id\r\n  }\r\n\r\n  /**\r\n   * 心跳\r\n   * @param {*} msg \r\n   */\r\n  _heartBeat (msg) {\r\n    if (msg.channel_id === this.channelId) {\r\n      this._checkMsgSeq(msg);\r\n    }\r\n  }\r\n    /**\r\n   * \r\n   * @param {*} type 图型 \r\n   * @param {*} params  图型数据\r\n   * @param {*} action 1 新增 2 修改  3 删除 5 结束画线\r\n   */\r\n  _sendGraphMsg (type, params, action) {\r\n    let msg = {\r\n      type: type,\r\n      seq_id: ++this.local_seq_id,\r\n      edit_id: this.pageStore.editConfig.id,\r\n      channelId: this.channelId\r\n    }\r\n    params.action = action\r\n    params.line_shape = 0\r\n    msg[type] = params\r\n    if (type === Graphics.LINE) {\r\n      msg.id = 31000\r\n    } else if(type === Graphics.CURVE || type === Graphics.MASK_CURVE) {\r\n      msg.id = 31002\r\n    } else if (type === Graphics.TEXT) {\r\n      msg.id = 31006\r\n    } else if (type === Graphics.GMOV) {\r\n      delete params.action\r\n      msg.id = 30202\r\n    }\r\n    protocolSender.sendGraphMsg(msg)\r\n  }\r\n  /**\r\n   * 清空白板\r\n   */\r\n  clear () {\r\n    let params = {\r\n      curPage: this.pageStore.getCurPage(),\r\n      edit_id: this.pageStore.editConfig.id,\r\n      // seq_id: this.msg_seq_id + 1,\r\n      action: 3,\r\n      channelId: this.channelId\r\n    }\r\n    protocolSender.sendPageInfoMsg(params)\r\n    this.pageStore.revokeStack = []\r\n    this.pageStore.restoreStack = []\r\n  }\r\n  // 选择线型大小\r\n  brushSize (size) {\r\n    // 没有输入参数 获取值\r\n    if (size === undefined) {\r\n      return this.pageStore.brush_size\r\n    }\r\n    this.pageStore.brush_size = parseInt(size) || this.pageStore.brush_size\r\n  }\r\n  // 选择颜色\r\n  brushColor (color) {\r\n    if (color === undefined) {\r\n      return stringToColor(this.pageStore.color)\r\n    }\r\n    this.pageStore.color = colorToNumber(color) || this.pageStore.color\r\n  }\r\n  // 选择图形\r\n  toolType (shape) {\r\n    if (shape === undefined) {\r\n      return this.pageStore.shape\r\n    }\r\n    this.pageStore.shape = shape || this.pageStore.shape\r\n  }\r\n  _transrate (stack1, stack2) {\r\n    let paint = stack1.pop();\r\n    if(!paint) return\r\n    let graphType = paint.type\r\n    let pageData = this.pageStore.findPagePaints(paint[graphType].pid);\r\n    let movePaint = this.pageStore.findPaintByGid(pageData, paint[graphType].gid)\r\n    // 当前找不到 则是恢复删除的线段 用原本保存的值\r\n    paint = movePaint || paint\r\n    if (paint[graphType].action === 1 || paint[graphType].action === 2) {\r\n      this._sendGraphMsg(graphType, paint[graphType], 3)\r\n      stack2.push(paint);\r\n    } else if (paint[graphType].action === 3) {\r\n      this._sendGraphMsg(graphType, paint[graphType], 1)\r\n      stack2.push(paint);\r\n    }\r\n  }\r\n  // 撤销\r\n  revoke () {\r\n    this._transrate(this.pageStore.revokeStack, this.pageStore.restoreStack)\r\n  }\r\n  // 恢复\r\n  restore () {\r\n    this._transrate(this.pageStore.restoreStack, this.pageStore.revokeStack)\r\n  }\r\n   /**\r\n   * 是否开启编辑\r\n   */\r\n  edit (isEdit) {\r\n    if (isEdit === undefined) {\r\n      return this.pageStore.editConfig.status\r\n    } else {\r\n      if(isEdit) {\r\n        protocolSender.sendOpenEdit(this.channelId)\r\n        return promiseHandler(EDIT_WHITE_BOARD)\r\n      } else {\r\n        this.pageStore.editConfig.status = false\r\n        return Promise.resolve(false)\r\n      }\r\n    }\r\n  }\r\n  page (num) {\r\n    if (num === undefined) {\r\n      return this.pageStore.getCurPage()\r\n    }\r\n    // 页面超出限制\r\n    if(num >= this.pageStore.getPageCount() || num < 1 ) return logger.warn('page number is not reasonable')\r\n    let params = {\r\n      curPage: num,\r\n      edit_id: this.pageStore.editConfig.id,\r\n      // seq_id: this.msg_seq_id + 1,\r\n      action: 0,\r\n      channelId: this.channelId\r\n    }\r\n    protocolSender.sendPageInfoMsg(params)\r\n  }\r\n\r\n  startPainting(event) {\r\n    eventRegistry.trigger(`touchStart${this.mediaId}`, event)\r\n  }\r\n\r\n  painting(event) {\r\n    eventRegistry.trigger(`touchMove${this.mediaId}`, event)\r\n  }\r\n\r\n  stopPainting(event) {\r\n    eventRegistry.trigger(`touchEnd${this.mediaId}`, event)\r\n  }\r\n}\r\n\r\nexport default Painter","\r\nimport { Graphics } from \"../../../common/enums\"\r\nimport { isPointAt } from '../../util/math'\r\nimport { fromPoints, fromLine } from '../../../core/bbox'\r\n/**\r\n * 白板数据\r\n */\r\nclass PageStore {\r\n  constructor(data) {\r\n    /**\r\n     * 全量数据存储\r\n     * boardData : {\r\n     *     seq_id: '' // 暂时不清楚作用\r\n     *     board_name: 'xxx',\r\n     *     board_type: 'xxx',\r\n     *     \"width\":1280,\r\n     *     \"height\":720,\r\n     *     \"page\":10,\r\n     *     \"current_pid\":2,\r\n     *     \"file_path\":,\r\n     *     \"convert_file_path\",\r\n     *     paintMap:   // map key: 页码 value: [obj]  图元对象\r\n     * }\r\n     */\r\n    this.boardData = { paintMap: new Map() }\r\n    // 白板编辑状态\r\n    this.editConfig = {\r\n      id: 1, \r\n      status: false\r\n    }\r\n    this.shape = Graphics.CURVE\r\n    this.color  = 4278190080\r\n    this.brush_size = 4\r\n    // 撤销栈\r\n    this.revokeStack = []\r\n    // 恢复栈\r\n    this.restoreStack = []\r\n    // 图元增量\r\n    this.graphIdSeed = 0\r\n\r\n    this._init(data)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 初始化\r\n   * @param {*} data \r\n   */\r\n  _init(data) {\r\n    // 第一个元素是白板属性数据\r\n    let pageData = data.slice(0, 1)\r\n\r\n    // 后面的元素是白板图元数据\r\n    let paintObjs = data.slice(1)\r\n\r\n    // 保存白板属性数据\r\n    this.boardData = Object.assign(this.boardData, pageData[0].board)\r\n    this.editConfig.id = this.boardData.edit_id\r\n\r\n    // 解析所有白板图元\r\n    if (paintObjs.length > 0) {\r\n      paintObjs.map((item) => {\r\n        let items = this.boardData.paintMap.get(item[item.type].pid)\r\n        if (!items) {\r\n          this.boardData.paintMap.set(item[item.type].pid, [item])\r\n          return\r\n        }\r\n        items.push(item)\r\n        this.boardData.paintMap.set(item[item.type].pid, items)\r\n      })\r\n    } else {\r\n      this.boardData.paintMap.set(pageData[0].board.current_pid, [])\r\n    }\r\n\r\n  }\r\n  clearPaints () {\r\n    this.boardData.paintMap = new Map()\r\n    this.boardData.paintMap.set(this.getCurPage(), [])\r\n  }\r\n\r\n  /**\r\n   * 获取当前显示第几页\r\n   */\r\n  getCurPage () {\r\n    return this.boardData.current_pid\r\n  }\r\n\r\n  /**\r\n   * 获取白板总页数\r\n   */\r\n  getPageCount() {\r\n    return this.boardData.page;\r\n  }\r\n\r\n  /**\r\n   * TODO：？？？\r\n   */\r\n  getFilePath() {\r\n    return this.boardData.convert_file_path;\r\n  }\r\n\r\n  /**\r\n   * 获取白板图片URL\r\n   */\r\n  getConvertFilePath() {\r\n    return this.boardData.convert_file_path\r\n  }\r\n\r\n  /**\r\n   * 设置当前显示的页码\r\n   * @param {*} pid \r\n   */\r\n  setCurPage (pid) {\r\n    this.boardData.current_pid = pid\r\n  }\r\n\r\n  /**\r\n   * 获取白板名称\r\n   */\r\n  getBoardName() {\r\n    return this.boardData.board_name;\r\n  }\r\n\r\n  /**\r\n   * 删除白板页\r\n   * @param {*} item \r\n   */\r\n  deletePage (item) {\r\n    let items = this.boardData.paintMap.get(item[item.type].pid)\r\n    if (items) {\r\n      this.boardData.paintMap.set(item[item.type].pid, [])\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取白板页上的所有图元\r\n   * @param {*} pid \r\n   */\r\n  findPagePaints(pid) {\r\n    if (!this.boardData.paintMap.get(pid)) {\r\n      this.boardData.paintMap.set(pid, [])\r\n    }\r\n    return this.boardData.paintMap.get(pid)\r\n  }\r\n\r\n  /**\r\n   * 根据gid查找图元数据\r\n   * @param {*} pageData \r\n   * @param {*} gid \r\n   */\r\n  findPaintByGid (pageData, gid) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      // 判断ObjId是否相等\r\n      if (data[data.type].gid === gid) {\r\n        // 替换全量对应ID的Obj\r\n        return data\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 删除图元\r\n   * @param {*} pageData 页图元数据组\r\n   * @param {*} paintObj\r\n   */\r\n  deletePaintObj(pageData, gid) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      // 判断ObjId是否相等\r\n      if (data[data.type].gid === gid) {\r\n        // 替换全量对应ID的Obj\r\n        pageData.splice(i, 1)\r\n        console.log('===>', pageData)\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加图元\r\n   * @param {*} pageData \r\n   * @param {*} paintObj \r\n   */\r\n  addPaintObj (pageData, paintObj) {\r\n    pageData.push(paintObj)\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {*} pageData \r\n   * @param {*} paintObj \r\n   */\r\n  amendPaintObj(pageData, paintObj) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      // 判断ObjId是否相等\r\n      if (data[data.type].gid === paintObj[paintObj.type].gid) {\r\n        // 替换全量对应ID的Obj\r\n        if (data.type === Graphics.CURVE) {\r\n          data[data.type].points.push(...paintObj[paintObj.type].points)\r\n        } else {\r\n          pageData.splice(i, 1, paintObj)\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 替换图元\r\n   * @param {*} pageData \r\n   * @param {*} gid \r\n   * @param {*} paintData \r\n   */\r\n  repalcePaintObj (pageData, gid, paintData) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      if (data[data.type].gid === gid) {\r\n        data[data.type] = paintData\r\n        break\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 移动图元\r\n   * @param {*} pageData \r\n   * @param {*} gid \r\n   * @param {*} paintObj \r\n   */\r\n  movePaintObj(pageData, gid, paintObj) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      // 判断ObjId是否相等\r\n      if (data[data.type].gid === gid) {\r\n        // 替换全量对应ID的Obj\r\n        if (data.type === Graphics.CURVE) {\r\n          data[data.type].points = data[data.type].points.map((item) => {\r\n            return (item = [item[0] + paintObj.ox, item[1] + paintObj.oy])\r\n          })\r\n        } else if (data.type === Graphics.TEXT) {\r\n          data[data.type].left += paintObj.ox\r\n          data[data.type].top += paintObj.oy\r\n        } else {\r\n          data[data.type].x1 += paintObj.ox\r\n          data[data.type].y1 += paintObj.oy\r\n          data[data.type].x2 += paintObj.ox\r\n          data[data.type].y2 += paintObj.oy\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n  deletePaintObj(pageData, gid) {\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      // 判断ObjId是否相等\r\n      if (data[data.type].gid === gid) {\r\n        try {\r\n          return pageData.splice(i, 1)[0]\r\n        } catch (er) {\r\n          return null\r\n        }\r\n        \r\n      }\r\n    }\r\n    return null\r\n  }\r\n  findPaintsByPoint (pageData, target) {\r\n    let flag = false\r\n    for (var i = 0; i < pageData.length; i++) {\r\n      let data = pageData[i]\r\n      if (data.type === Graphics.CURVE || data.type === Graphics.MASK_CURVE) {\r\n        let points = data[data.type].points\r\n        for(let j = 0; j < points.length - 1; j++) {\r\n          let point0 = points[j]\r\n          let point1 = points[j + 1]\r\n          flag = isPointAt(target, {x: point0[0], y: point0[1]}, {x: point1[0], y: point1[1]})\r\n          if (flag) break;\r\n        }\r\n      } else if (data.type === Graphics.LINE) {\r\n        let points = data[data.type]\r\n        flag = isPointAt(target, {x: points.x1, y: points.y1}, {x: points.x2, y: points.y2})\r\n      }\r\n      if (flag) return data\r\n    }\r\n    return null\r\n  }\r\n \r\n  containPaintObj (rect) {\r\n    let pageData = this.findPagePaints(this.boardData.current_pid)\r\n    let paints = []\r\n    pageData.map((data) => {\r\n      // 替换全量对应ID的Obj\r\n      if (data.type === Graphics.CURVE) {\r\n        let isContain = true\r\n        data[data.type].points.map((item) => {\r\n          if (item[0] < rect.x1 || item[0] > rect.x2 || item[1] < rect.y1 || item[1] > rect.y2) {\r\n            isContain = false\r\n          }\r\n        })\r\n        if (isContain) {\r\n          paints.push(data[data.type].gid)\r\n        }\r\n      } else if (data.type === Graphics.TEXT) {\r\n        // data[data.type].left += paintObj.ox\r\n        // data[data.type].top += paintObj.oy\r\n      } else if (data.type === Graphics.LINE){\r\n        let item = data[data.type]\r\n        if (item.x1 < rect.x1 || item.x2 > rect.x2 || item.y1 < rect.y1 || item.y2 > rect.y2) return\r\n        paints.push(data[data.type].gid)\r\n      }\r\n    })\r\n    return paints\r\n  }\r\n  boundingRect (gid) {\r\n    let pageData = this.findPagePaints(this.boardData.current_pid)\r\n    let graph = this.findPaintByGid(pageData, gid)\r\n    let min = []\r\n    let max = []\r\n    if (graph.type  === 'line') {\r\n      let points = graph[graph.type]\r\n      fromLine(points.x1, points.y1, points.x2, points.y2, min, max)\r\n    } else if (graph.type === 'curve') {\r\n      fromPoints(graph[graph.type].points, min, max)\r\n    }\r\n    return {\r\n      x1: min[0],\r\n      y1: min[1],\r\n      x2: max[0],\r\n      y2: max[1]\r\n    }\r\n  }\r\n  groupBoundingRect (childrens) {\r\n    // let pageData = this.findPagePaints(this.boardData.current_pid)\r\n    let rect = null\r\n    childrens.map((gid) => {\r\n      let childRect = this.boundingRect(gid)\r\n      rect = rect || childRect\r\n      rect.x1 = Math.min(rect.x1, childRect.x1)\r\n      rect.y1 = Math.min(rect.y1, childRect.y1)\r\n      rect.x2 = Math.max(rect.x2, childRect.x2)\r\n      rect.y2 = Math.max(rect.y2, childRect.y2)\r\n    })\r\n    return rect\r\n  }\r\n}\r\n\r\nexport default PageStore;","// import { PaasRender } from './paasRender'\r\n// import { CloudRender } from './cloudRender'\r\n// 8fff55e8-43db-4641-9592-6926e2962047\r\nimport draw from \"../../../util/draw\"\r\nimport wbManager from \"../../white-board-manager\"\r\nimport eventRegistry from '../../../../common/event-registry'\r\nclass Render {\r\n  constructor (painter, pageStore) {\r\n    this.painter = painter\r\n    this.pageStore = pageStore\r\n  }\r\n  /**\r\n   * 全量重新绘图\r\n   */\r\n  _drawAllPaint() {\r\n    // this._emptyCanvas()\r\n    if (this.pageStore) {\r\n      let paintObjs = this.pageStore.findPagePaints(this.pageStore.getCurPage())\r\n      paintObjs.map((item) => {\r\n        this._drawPaint(item.type, item[item.type])\r\n      })\r\n    }\r\n  }\r\n   /**\r\n   * 设置背景图(重试10次)\r\n   */\r\n   _insertImage (n = 0) {\r\n    if (n > 10) {\r\n      console.warn(\"insertImage failed!\");\r\n      return\r\n    }\r\n    const convertPath = this.pageStore.getConvertFilePath()\r\n    let rootPath = convertPath\r\n    const curPage = this.pageStore.getCurPage()\r\n    let fullPath = convertPath\r\n    if (!String(fullPath).toLowerCase().includes('.jpg')) {\r\n      fullPath = `${convertPath}/${curPage}.jpg`\r\n    } else {\r\n      rootPath = convertPath.substr(0, convertPath.lastIndexOf('/'))\r\n    }\r\n    if (wbManager.cacheFileUrlMap.get(rootPath) && wbManager.cacheFileUrlMap.get(rootPath).get(fullPath)) {\r\n      if (this.painter.canvasEle) {\r\n        this.painter._refreshRender()\r\n      } else {\r\n        console.warn(\"Invalid canvas element!\");\r\n      }\r\n    } else {\r\n      wbManager._getFileUrl(fullPath)\r\n      setTimeout((() => {\r\n        this._insertImage(++n)\r\n      }).bind(this), 3000)\r\n    }\r\n  }\r\n  /**\r\n   * 清除画板\r\n   */\r\n  _emptyCanvas() {\r\n    if (this.painter.canvasCtx) {\r\n      this.painter.canvasCtx.clearRect(0, 0, this.painter.canvasWidth, this.painter.canvasHeight);\r\n    }\r\n  }\r\n  /**\r\n   * 根据图形绘图\r\n   * @param {*} type \r\n   * @param {*} obj \r\n   */\r\n  _drawPaint (type, obj) {\r\n    if (this.painter.canvasCtx) {\r\n      try {\r\n        draw[type](this.painter.canvasCtx, obj, this.painter.scaleRatio, this.painter.canvasEle)\r\n      } catch (err) {\r\n        console.error(\"Draw type: \" + type + \", error: \" + err);\r\n      }\r\n    }\r\n  }\r\n  drawAmendData (pageData, paintObj) {\r\n    this._drawAllPaint()\r\n    const paint = this.pageStore.findPaintByGid(pageData, paintObj[paintObj.type].gid)\r\n    if (paint) {\r\n      this._drawPaint(paint.type, paint[paint.type])\r\n    }\r\n  }\r\n  /**\r\n   * 修改/删除/新增 图元\r\n   * @param {*} paintObj \r\n   */\r\n  dealAmendData (paintObj) {\r\n    let pageData = this.pageStore.findPagePaints(this.pageStore.getCurPage())\r\n    if (paintObj[paintObj.type].action === 1) { // 添加\r\n      this.pageStore.addPaintObj(pageData, paintObj)\r\n      this.drawAmendData(pageData, paintObj)\r\n    } else if (paintObj[paintObj.type].action === 2) { // 修改\r\n      this.pageStore.amendPaintObj(pageData, paintObj)\r\n      this.drawAmendData(pageData, paintObj)\r\n    } else if (paintObj[paintObj.type].action === 3) { // 删除\r\n      this.pageStore.deletePaintObj(pageData, paintObj[paintObj.type].gid)\r\n      this._emptyCanvas()\r\n      this._drawAllPaint()\r\n    } else if (paintObj[paintObj.type].action === 4) {\r\n      this.pageStore.repalcePaintObj(pageData, paintObj[paintObj.type].gid, paintObj[paintObj.type])\r\n      this._drawAllPaint()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 页变化\r\n   * @param {*} pageObj \r\n   */\r\n  pageChange (pageObj) {\r\n    if (!this.pageStore) return\r\n    const { cur_page } = pageObj\r\n    if (cur_page === this.pageStore.getCurPage()) return\r\n    this.pageStore.setCurPage(pageObj.cur_page)\r\n    if (this.pageStore.getConvertFilePath()) {\r\n      this._insertImage()\r\n    }\r\n    // 通知白板页切换\r\n    eventRegistry.trigger(\"shareOperation\", {\r\n      type: 'pageChange',\r\n      mediaId: this.painter.mediaId, \r\n      curPage: this.pageStore.getCurPage()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 移动图元\r\n   * @param {*} paintObj \r\n   */\r\n  moveGraph (paintObj) {\r\n    let pageData = this.pageStore.findPagePaints(paintObj.gmov.pid)\r\n    paintObj.gmov.graphs.map((gid) => {\r\n      this.pageStore.movePaintObj(pageData, gid, paintObj.gmov)\r\n    })\r\n    this._emptyCanvas()\r\n    this._drawAllPaint()\r\n  }\r\n  // 绘制包围盒\r\n  drawBoundingRect (obj) {\r\n    if (!obj) return\r\n    this.painter.canvasCtx.beginPath()\r\n    this.painter.canvasCtx.lineWidth = 1 // 线宽\r\n    this.painter.canvasCtx.strokeStyle = '#00ff00' // 线颜色\r\n\r\n    let x1 = parseInt(obj.x1) * this.painter.scaleRatio\r\n    let y1 = parseInt(obj.y1) * this.painter.scaleRatio;\r\n    let x2 = parseInt(obj.x2) * this.painter.scaleRatio;\r\n    let y2 = parseInt(obj.y2) * this.painter.scaleRatio;\r\n\r\n    this.painter.canvasCtx.rect(x1, y1, (x2 - x1), (y2 - y1));\r\n    this.painter.canvasCtx.closePath();\r\n    this.painter.canvasCtx.stroke();\r\n  }\r\n}\r\n\r\nexport default Render","import Store from \"../../../util/store\"\r\nimport { Graphics } from \"../../../../common/enums\"\r\nimport eventRegistry from \"../../../../common/event-registry\"\r\n\r\nexport default class WriteBoard{\r\n  constructor (painter, pageStore) {\r\n    // super(params)\r\n    this.painter = painter\r\n    this.pageStore = pageStore || {}\r\n    this.render = this.painter.render\r\n    this.userId = Store.userInfo.userId\r\n    this.parttern = {}\r\n   \r\n    this.getGraphId()\r\n    \r\n    // 选择的线条\r\n    this.graphChildren = []\r\n    // 包围盒对象\r\n    this.boundingRect = null\r\n    // 选择对象移动状态\r\n    this.moveStatus = false\r\n\r\n    this.registryTouchEvent()\r\n  }\r\n\r\n  registryTouchEvent() {\r\n    const startId = `touchStart${this.painter.mediaId}`\r\n    const moveId = `touchMove${this.painter.mediaId}`\r\n    const endId = `touchEnd${this.painter.mediaId}`\r\n    // 先清除注册，因为可能会执行多次导致有多个相同的事件callBack\r\n    eventRegistry.off(startId)\r\n    eventRegistry.off(moveId)\r\n    eventRegistry.off(endId)\r\n    eventRegistry.on(startId, this.touchMoveStart.bind(this))\r\n    eventRegistry.on(moveId, this.touchMoveEvent.bind(this))\r\n    eventRegistry.on(endId, this.touchMoveEnd.bind(this))\r\n  }\r\n\r\n  // 获取图元id\r\n  getGraphId () {\r\n    return ((this.userId << 16) | this.pageStore.graphIdSeed ++)\r\n  }\r\n  /**\r\n   * canvas触摸开始事件\r\n   */\r\n  touchMoveStart (e) {\r\n    this.rateX = this.painter.width / this.painter.canvasWidth\r\n    this.rateY = this.painter.height / this.painter.canvasHeight\r\n    let canvasDis = this._calcXY(e.touches[0].x, e.touches[0].y)\r\n    // 橡皮檫处理\r\n    if (this.pageStore.shape === Graphics.ERASER) {\r\n      let pageData = this.pageStore.findPagePaints(this.pageStore.getCurPage())\r\n      // 遍历查找点是否在线上\r\n      let paints = this.pageStore.findPaintsByPoint(pageData, canvasDis)\r\n      if (paints) {\r\n        this.painter._sendGraphMsg(paints.type, paints[paints.type], 3)\r\n        this._storeStack(paints.type, paints[paints.type])\r\n      }\r\n      return\r\n    }\r\n    this._createShapeObject()\r\n    // 曲线处理\r\n    if (this.pageStore.shape === Graphics.CURVE || this.pageStore.shape === Graphics.MASK_CURVE) {\r\n      this.parttern.points.push([canvasDis.x, canvasDis.y])\r\n      this.painter._sendGraphMsg(this.pageStore.shape, this.parttern, 1)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * canvas触摸移动事件\r\n   */\r\n   touchMoveEvent (e) {\r\n    const endx = Math.floor(e.touches[0].x * this.rateX)\r\n    const endy = Math.floor(e.touches[0].y * this.rateY)\r\n    let canvasDis = this._calcXY(e.touches[0].x, e.touches[0].y)\r\n    // 橡皮檫处理\r\n    if (this.pageStore.shape === Graphics.ERASER) {\r\n      let pageData = this.pageStore.findPagePaints(this.pageStore.getCurPage())\r\n      // 遍历查找点是否在线上\r\n      let paints = this.pageStore.findPaintsByPoint(pageData, canvasDis)\r\n      if (paints) {\r\n        this.painter._sendGraphMsg(paints.type, paints[paints.type], 3)\r\n        this._storeStack(paints.type, paints[paints.type])\r\n      }\r\n    } else if (this.pageStore.shape === Graphics.LINE) {\r\n      this.parttern.x2 = endx\r\n      this.parttern.y2 = endy\r\n      this.painter._sendGraphMsg(this.pageStore.shape, this.parttern, 2)\r\n    } else if (this.pageStore.shape === Graphics.CURVE) {\r\n      this.parttern.points = [[endx, endy]]\r\n      this.painter._sendGraphMsg(this.pageStore.shape, this.parttern, 2)\r\n    } else if(this.pageStore.shape === Graphics.GMOV) {\r\n      if (this.moveStatus) {\r\n        this.parttern.ox = endx - canvasDis.x\r\n        this.parttern.oy = endy - canvasDis.y\r\n        this.parttern.graphs = this.graphChildren\r\n        this.painter._sendGraphMsg(Graphics.GMOV, this.parttern)\r\n        canvasDis.x = endx\r\n        canvasDis.y = endy\r\n      } else {\r\n        this.painter.render._drawAllPaint()\r\n        this.boundingRect =  {x1: canvasDis.x, y1: canvasDis.y, x2: endx,y2: endy}\r\n        this.render.drawBoundingRect(this.boundingRect)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * canvas触摸结束事件\r\n   */\r\n   touchMoveEnd (e) {\r\n    // 移动暂时无法撤销\r\n    if (this.pageStore.shape !== Graphics.GMOV) {\r\n      this._storeStack(this.pageStore.shape, this.parttern)\r\n      this.painter._sendGraphMsg(this.pageStore.shape, this.parttern, 5)\r\n    }\r\n    if (this.pageStore.shape === Graphics.GMOV) {\r\n      this.moveStatus = false\r\n      this.render._drawAllPaint()\r\n      if (this.boundingRect) {\r\n        this.graphChildren = this.pageStore.containPaintObj(this.boundingRect)\r\n        this.boundingRect = this.pageStore.groupBoundingRect(this.graphChildren)\r\n        // 绘制包围盒\r\n        this.render.drawBoundingRect(this.boundingRect)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  _storeStack (shape, parttern) {\r\n    let params = {\r\n      type: shape,\r\n    }\r\n    params[shape] = parttern\r\n    this.pageStore.revokeStack.push(params)\r\n  }\r\n  /**\r\n   * 创建图型对象\r\n   */\r\n  _createShapeObject () {\r\n    switch (this.pageStore.shape) {\r\n      case Graphics.LINE: this.parttern = {\r\n          pid: this.pageStore.getCurPage(),\r\n          gid: this.getGraphId(),\r\n          action: null,\r\n          graph: 1,\r\n          brush_size: this.pageStore.brush_size,\r\n          color: this.pageStore.color,\r\n          x1: null,\r\n          y1: null,\r\n          x2: null,\r\n          y2: null\r\n        }\r\n        break;\r\n      case Graphics.CURVE:\r\n        this.parttern = {\r\n          pid: this.pageStore.getCurPage(),\r\n          gid: this.getGraphId(),\r\n          action: null,\r\n          graph: 2,\r\n          brush_size: this.pageStore.brush_size,\r\n          color: this.pageStore.color,\r\n          points: []\r\n        }\r\n        break;\r\n      case Graphics.MASK_CURVE: \r\n        this.parttern = {\r\n          pid: this.pageStore.getCurPage(),\r\n          gid: this.getGraphId(),\r\n          action: null,\r\n          graph: 2,\r\n          brush_size: this.pageStore.brush_size,\r\n          color: this.pageStore.color,\r\n          points: []\r\n        }\r\n        break;\r\n      case Graphics.TEXT: this.parttern = {\r\n          pid: this.pageStore.getCurPage(),\r\n          gid: this.getGraphId(),\r\n          text: '',\r\n          action: null,\r\n          color: this.pageStore.color,\r\n          left: '',\r\n          top: '',\r\n          right: '',\r\n          bottom: '',\r\n          font: '新宋体',\r\n          fontsize: 20,\r\n        }\r\n        break\r\n      case Graphics.GMOV: this.parttern = {\r\n          pid: this.pageStore.getCurPage(),\r\n          ox: null,\r\n          oy: null,\r\n          graphs: []\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 计算横纵坐标\r\n   * @param {*} x \r\n   * @param {*} y \r\n   */\r\n  _calcXY (x, y) {\r\n    return {\r\n      x: Math.ceil(this.rateX * x),\r\n      y: Math.ceil(this.rateY * y)\r\n    }\r\n  }\r\n  /**\r\n   * 计算输入框相对于画布的横纵坐标\r\n   * @param {*} x \r\n   * @param {*} y \r\n   */\r\n  _calcTextDisance (x, y) {\r\n    // 等比适应 坐标不用转换\r\n    if (\r\n      this.painter.displayMode == DisplayMode.DBSY) {\r\n      return {\r\n        x,\r\n        y\r\n      }\r\n    } else {\r\n      return {\r\n        x: Math.ceil(x + (this.painter.parentEle.offsetWidth - this.painter.canvasWidth) / 2),\r\n        y: Math.ceil(y + (this.painter.parentEle.offsetHeight - this.painter.canvasHeight) / 2)\r\n      }\r\n    }\r\n   \r\n  }\r\n}","import protocolSender from \"../util/protocol-sender\"\r\nimport Store from \"../util/store\"\r\nimport eventRegistry from \"../../common/event-registry\"\r\n\r\nclass MessageManager {\r\n  constructor() {\r\n    Store.msgDispatcher.addMsgHandler(11000, this._onRecvUserMsg.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(11006, this._onRecvGroupMsg.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(11010, this._onRecvServerAck.bind(this));\r\n  }\r\n\r\n  /**\r\n   * 发送单播消息\r\n   * @param {*} params \r\n   */\r\n  sendUserMsg(params) {\r\n    protocolSender.sendUserMsg(params);\r\n  };\r\n\r\n  /**\r\n   * 发送白名单消息\r\n   * @param {*} params \r\n   */\r\n  sendGroupMsgWithWhiteList(params) {\r\n    protocolSender.sendGroupMsgWithWhiteList(params);\r\n  };\r\n\r\n  /**\r\n   * 发送黑名单消息\r\n   * @param {*} params \r\n   */\r\n  sendGroupMsgWithBlackList(params) {\r\n    protocolSender.sendGroupMsgWithBlackList(params);\r\n  };\r\n\r\n  /**\r\n   * 发送广播消息\r\n   * @param {*} params \r\n   */\r\n  sendGroupMsg(params) {\r\n    protocolSender.sendGroupMsg(params);\r\n  };\r\n\r\n  /**\r\n   * 收到用户消息\r\n   * @param {*} data \r\n   */\r\n  _onRecvUserMsg(data) {\r\n    eventRegistry.trigger(\"onRecvUserMsg\", {\r\n      srcUserId: data.src_user_id,\r\n      msg: data.msg,\r\n      msgId: data.msg_id\r\n    });\r\n    protocolSender.sendUserMsgAck(data);\r\n  };\r\n\r\n  /**\r\n   * 收到分组消息\r\n   * @param {*} data \r\n   */\r\n  _onRecvGroupMsg(data) {\r\n    eventRegistry.trigger(\"onRecvGroupMsg\", {\r\n      srcUserId: data.src_user_id,\r\n      groupId: data.group_id,\r\n      msg: data.msg,\r\n      msgId: data.msg_id\r\n    });\r\n    protocolSender.sendGroupMsgAck(data);\r\n  }\r\n\r\n  /**\r\n   * 收到服务器Ack消息，说明服务器已经收到\r\n   * @param {*} data \r\n   */\r\n  _onRecvServerAck(data) {\r\n    // TODO: 暂时不做处理\r\n  }\r\n}\r\n\r\nexport default new MessageManager();","import { EventResult, EventType } from \"../../common/enums\"\r\nimport Store from \"../util/store\"\r\nimport eventRegistry from \"../../common/event-registry\"\r\n\r\nclass OnlineManager {\r\n  constructor() {\r\n    // 全量用户数据可能会分页\r\n    this.cachedUserList = null;\r\n\r\n    // 注册消息处理函数\r\n    Store.msgDispatcher.addMsgHandler(12120, this.onGetOnlineUsersRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(12123, this.onOnlineUsersNotify.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14001, this.onInviteRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14002, this.onNotifyInvite.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14004, this.onNotifyIgnoreInvite.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14007, this.onCancelInviteRes.bind(this));\r\n    Store.msgDispatcher.addMsgHandler(14008, this.onNotifyCancelInvite.bind(this));\r\n  }\r\n\r\n  /**\r\n   * 获取所有在线用户列表\r\n   */\r\n  getOnlineUsers() {\r\n    let msg = {\r\n      business: \"PS\",\r\n      id: 12119,\r\n      seq_id: (Math.floor(Math.random()*4096))\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  };\r\n\r\n  /**\r\n   * 获取在线用户列表响应\r\n   * @param {*} data \r\n   */\r\n  onGetOnlineUsersRes(data) {\r\n    if (data.result != 0) {\r\n      eventRegistry.trigger(\r\n        EventType.EVENT_GET_ONLINE_USERS, \r\n        EventResult.FAILED);\r\n      return;\r\n    }\r\n    \r\n    let pageInfo = {\r\n      totalPages: data.page_info.total_pages,\r\n      curPage: data.page_info.cur_page\r\n    };\r\n    \r\n    let userInfo = [];\r\n    for (const user of data.member_state_list) {\r\n      let u = {\r\n        userId: user.uid,\r\n        onlineInfo: []\r\n      };\r\n  \r\n      for (const info of user.online_info) {\r\n        let state = {\r\n          mutexType: info.mutex_type,\r\n          customState: info.custom_state,\r\n          state: info.state,\r\n          extendInfo: info.extend_info\r\n        };\r\n        u.onlineInfo.push(state);\r\n      }\r\n  \r\n      userInfo.push(u);\r\n    }\r\n  \r\n    let params = {\r\n      pageInfo: pageInfo,\r\n      userInfo: userInfo\r\n    };\r\n  \r\n    eventRegistry.trigger(\r\n      EventType.EVENT_GET_ONLINE_USERS, \r\n      EventResult.SUCCESS, \r\n      params);\r\n\r\n    this.cachedUserList = null;\r\n  };\r\n\r\n  /**\r\n   * 邀请其他用户加入分组\r\n   * @param {*} params \r\n   */\r\n  invite(params) {\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14000,\r\n      seq_id: params.seqId,\r\n      group_id: params.groupId,\r\n      callee_info: [],\r\n      extend_info: params.extendInfo\r\n    };\r\n\r\n    // 转换userId字段名\r\n    for (const userId of params.calleeInfo) {\r\n      msg.callee_info.push({user_id: userId});\r\n    }\r\n\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  };\r\n\r\n  /**\r\n   * 响应邀请\r\n   * @param {*} params \r\n   */\r\n  replyInvite(params) {\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14003,\r\n      seq_id: params.seqId,\r\n      group_id: params.groupId,\r\n      operate: params.operation,\r\n      extend_info: params.extendInfo\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  };\r\n\r\n  /**\r\n   * 邀请方取消邀请协议\r\n   * @param {*} params \r\n   */\r\n  cancelInvite(params) {\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14006,\r\n      seq_id: params.seqId,\r\n      group_id: params.groupId,\r\n      callee_info: params.calleeInfo\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  };\r\n\r\n  /**\r\n   * 增量在线用户推送\r\n   * @param {*} data \r\n   */\r\n  onOnlineUsersNotify(data) {\r\n    let result = data.result;\r\n    let params = {\r\n      userId: data.user_id,\r\n      mutexType: data.mutex_type,\r\n      state: data.operation,\r\n      customState: data.custom_state,\r\n      extendInfo: data.extend_info\r\n    };\r\n    eventRegistry.trigger(\"onOnlineUserState\", params);\r\n  };\r\n\r\n  /**\r\n   * 邀请响应\r\n   * @param {*} data \r\n   */\r\n  onInviteRes(data) {\r\n    let params = {\r\n      seqId: data.seq_id,\r\n      userId: data.user_id,\r\n      result: data.result\r\n    };\r\n    eventRegistry.trigger(\"onInviteReply\", params);\r\n  };\r\n\r\n  /**\r\n   * 服务器通知被邀请者\r\n   * @param {*} data \r\n   */\r\n  onNotifyInvite(data) {\r\n    let params = {\r\n      seqId: data.seq_id,\r\n      groupId: data.group_id,\r\n      userId: data.user_id,\r\n      userName: data.user_name,\r\n      extendInfo: data.extend_info\r\n    };\r\n    eventRegistry.trigger(\"onCommingInvite\", params);\r\n  };\r\n\r\n  /**\r\n   * 服务器通知被邀请者忽略邀请\r\n   * @param {*} data \r\n   */\r\n  onNotifyIgnoreInvite(data) {\r\n    let params = {\r\n      groupId: data.group_id,\r\n      userId: data.user_id,\r\n      userName: data.user_name\r\n    };\r\n    eventRegistry.trigger(EventType.EVENT_NOTICE_IGNORE_INVITE, params);\r\n  };\r\n\r\n  /**\r\n   * 取消邀请响应\r\n   * @param {*} data \r\n   */\r\n  onCancelInviteRes(data) {\r\n    let result = data.result;\r\n    let params = {\r\n      seqId: data.seq_id,\r\n      userId: data.user_id,\r\n    };\r\n    eventRegistry.trigger(EventType.EVENT_CANCEL_INVITE, result, params);\r\n  };\r\n\r\n  /**\r\n   * 服务器通知取消邀请\r\n   * @param {*} data \r\n   */\r\n  onNotifyCancelInvite(data) {\r\n    let params = {\r\n      seqId: data.seq_id,\r\n      userId: data.user_id,\r\n    };\r\n    eventRegistry.trigger(EventType.EVENT_NOTICE_CANCEL_INVITE, params);\r\n  };\r\n\r\n  _dealMsg(msg, channelId) {\r\n    if (!channelId) {\r\n      channelId = Store.mainWebsocketChannelId\r\n    }\r\n    return {\r\n      id: 102,\r\n      channel_id: channelId,\r\n      msg: JSON.stringify(msg),\r\n    }\r\n  }\r\n}\r\n\r\nexport default new OnlineManager();","\r\nimport StateMachine from 'javascript-state-machine'\r\nimport Store from './util/store'\r\nimport { asyncWrapper, getAddrs } from '../common/common'\r\nimport hstWebSocket from './util/new_webscoket'\r\nimport { EventResult, EventType } from '../common/enums'\r\nimport protocolSender from './util/protocol-sender'\r\nimport logger from \"../common/logger\"\r\nimport boardManager from \"./media/white-board-manager\"\r\nimport eventRegistry from '../common/event-registry'\r\nimport txRoom from \"./util/tx-room\"\r\n\r\n/**\r\n * 主引擎状态机\r\n */\r\nlet RtcEngine = new StateMachine({\r\n  init: 'uninit',\r\n  transitions: [\r\n    {name: 'doInit',        from: ['uninit', 'restoring'],    to: 'initing'},   // 初始化\r\n    {name: 'initSuccess',   from: 'initing',   to: 'inited'},    // 初始化成功\r\n    {name: 'initFailed',    from: 'initing',   to: 'uninit'},    // 初始化失败\r\n    {name: 'doLogin',       from: 'inited',    to: 'logining'},  // 登陆\r\n    {name: 'loginSuccess',  from: 'logining',  to: 'logined'},   // 登陆成功\r\n    {name: 'loginFailed',   from: 'logining',  to: 'inited'},    // 登陆失败\r\n    {name: 'doJoin',        from: 'logined',   to: 'joining'},   // 加入分组\r\n    {name: 'joinSuccess',   from: 'joining',   to: 'joined'},    // 加入分组成功\r\n    {name: 'joinFailed',    from: 'joining',   to: 'logined'},   // 加入分组失败\r\n    {name: 'doLeave',       from: 'joined',    to: 'leaving'},   // 离开分组\r\n    {name: 'leaveSuccess',  from: 'leaving',   to: 'logined'},   // 离开分组成功\r\n    {name: 'leaveFailed',   from: 'leaving',   to: 'joined'},    // 离开分组失败\r\n    {name: 'doLogout',      from: 'logined',   to: 'logouting'}, // 退出登录\r\n    {name: 'logoutSuccess', from: 'logouting', to: 'inited'},    // 退出登录成功\r\n    {name: 'logoutFailed',  from: 'logouting', to: 'logined'},   // 退出登录失败\r\n    {name: 'doDestroy',     from: ['logined', 'joined','inited', 'logining', 'joining', 'restoring', 'uninit', 'initing'], to: 'uninit'},    // 销毁\r\n    {name: 'doRestore',     from: 'joined',    to: 'restoring'}, // 断线重连 \r\n  ],\r\n  data: {\r\n    registered: false,\r\n    forceLogouted: false,\r\n    kickedOut: false,\r\n    hasLogin: false\r\n  },\r\n  methods: {\r\n    /**\r\n     * websocket关闭\r\n     */\r\n    onWebSocketClosed() {\r\n      logger.warn(\"Signalling websocket closed, state: \" + this.state)\r\n      if (Store.websocket) {\r\n        Store.websocket.close()\r\n        Store.websocket = null\r\n      }\r\n\r\n      // TODO: 当前只处理以下一种状态\r\n      if (this.state == 'joined' && !this.forceLogouted && !this.kickedOut) {\r\n        this.doRestore();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 离开分组处理\r\n     */\r\n    onLeaveGroup() {\r\n      Store.userInfo.groupId = null;\r\n      boardManager.reinitialize();\r\n    },\r\n\r\n    /**\r\n     * 登出处理\r\n     */\r\n    onLogout() {\r\n      this.onLeaveGroup();\r\n      Store.userInfo.userId = null;\r\n    },\r\n\r\n    /**\r\n     * 销毁引擎处理\r\n     */\r\n    onDestroy() {\r\n      this.onLogout();\r\n\r\n      this.hasLogin = false\r\n\r\n      Store.userInfo.appId = null;\r\n      Store.userInfo.token = null;\r\n      Store.userInfo.companyId = null;\r\n      \r\n      if (Store.websocket) {\r\n        Store.websocket.close();\r\n        Store.websocket = null;\r\n      }\r\n    },\r\n\r\n    //--------------------------------------------------------------------------\r\n    // 协议处理\r\n    //--------------------------------------------------------------------------\r\n    \r\n    /**\r\n     * 登录响应\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onLoginRes(msg, socket) {\r\n      let self = this;\r\n      if (msg.result == 0) {\r\n        txRoom.getLoginInfo(Store.userInfo.userId, \r\n          function(res) {\r\n            self.loginSuccess({\r\n              sdkAppId: res.data.sdkAppID,\r\n              userSig: res.data.userSig,\r\n              accountType: res.data.accountType})\r\n          }, \r\n          function(res) {\r\n            self.loginFailed();\r\n          }\r\n        );\r\n      } else {\r\n        self.loginFailed(msg.result)\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 登出响应\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onLogoutRes(msg, socket) {\r\n      (msg.result == 0) ? this.logoutSuccess() : this.logoutFailed();\r\n    },\r\n\r\n    /**\r\n     * 加入分组响应\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onJoinGroupRes(msg, socket) {\r\n      let self = this;\r\n      if (msg.result == 0) {\r\n        let userId = Store.userInfo.userId\r\n        txRoom.isPass && (userId = msg.room_id + \"_\" + userId)\r\n        const success = (res, sdkAppId, userSig)=> {\r\n          console.log(\"createRoom success.\" + JSON.stringify(res));\r\n          self.joinSuccess({\r\n            // 有两个RoomID，一个是Java服务上生成的RoomID，一个是网关生成的RoomID\r\n            // 前一个RoomID只在Java服务上生效，后一个RoomID是在微信小程序使用的\r\n            serverRoomId: res.data.roomID,\r\n            serverUserId:userId,\r\n            txRoomId: msg.room_id,\r\n            privateMapKey: res.data.privateMapKey,\r\n            sdkAppId: sdkAppId,\r\n            userSig: userSig\r\n          })\r\n        }\r\n\r\n        const fail = ()=> {\r\n          console.error(\"Creat room failed!\");\r\n          self.joinFailed();\r\n        }\r\n\r\n        txRoom.getLoginInfo(\r\n          userId,\r\n          function(res) {\r\n            let sdkAppId = res.data.sdkAppID;\r\n            let userSig = res.data.userSig;\r\n            if (txRoom.isPass) {\r\n              txRoom.createRoom(\r\n                Store.userInfo.userId, \r\n                Store.userInfo.groupId,\r\n                success(res, sdkAppId, userSig),\r\n                fail\r\n              );\r\n            } else {\r\n              txRoom.enterRoom(\r\n                Store.userInfo.userId, \r\n                msg.room_id,\r\n                success(res, sdkAppId, userSig),\r\n                fail\r\n              );\r\n            }\r\n          },\r\n          function(res) {\r\n            console.error(\"Get login info failed!\");\r\n            self.joinFailed();\r\n          }\r\n        );\r\n      } else {\r\n        this.joinFailed();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 离开分组响应\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onLeaveGroupRes(msg, socket) {\r\n      (msg.result == 0) ? this.leaveSuccess() : this.leaveFailed();\r\n    },\r\n\r\n    /**\r\n     * 被强制登出\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onForceLogout(msg, socket) {\r\n      this.forceLogouted = true\r\n      this.onLogout()\r\n      eventRegistry.trigger(\"onUserForceLogout\");\r\n    },\r\n\r\n    /**\r\n     * 被踢出（登录）\r\n     * @params {*} msg \r\n     * @params {*} socket \r\n     */\r\n    onKickOut(msg, socket) {\r\n      this.kickedOut = true\r\n      this.onLogOut()\r\n      protocolSender.sendKickOutRes(); // 直接回复消息\r\n      eventRegistry.trigger(\"onKickOut\");\r\n    },\r\n\r\n    _onConnectSuccess(msg, socket) {\r\n      if (msg.result == 0) {\r\n        // 因为webScoket只有一个，所以需要控制登录只执行一次\r\n        if (this.hasLogin) return\r\n        Store.mainWebsocketChannelId = msg.channel_id\r\n        this.hasLogin = true\r\n        let options = {\r\n          appId: Store.userInfo.appId,\r\n          userId: Store.userInfo.userId,\r\n          token: Store.loginParams.token,\r\n          companyId: Store.loginParams.companyId,\r\n          osType: \"webchat\",\r\n          mutexType: Store.loginParams.mutexType,\r\n          forceLogin: Store.loginParams.forceLogin,\r\n          registered: Store.loginParams.registered,\r\n          extendInfo: Store.loginParams.extendInfo,\r\n        }\r\n        protocolSender.sendLoginReq(options)\r\n      }\r\n    },\r\n    \r\n    //--------------------------------------------------------------------------\r\n    // 状态机处理\r\n    //--------------------------------------------------------------------------\r\n\r\n    /**\r\n     * 执行初始化\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoInit: function(lifecycle, params) {\r\n      const { txRoomUrl, appId, isPass = false } = params\r\n      txRoom.isPass = isPass\r\n      if (!txRoomUrl || !appId) {\r\n        this.initFailed()\r\n        return\r\n      }\r\n      txRoom.serverDomain = txRoomUrl\r\n      txRoom.appId = appId\r\n      if (!this.registered) {\r\n        Store.msgDispatcher.addMsgHandler(10001, this.onLoginRes.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(10003, this.onLogoutRes.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(10004, this.onForceLogout.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(12007, this.onKickOut.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(14101, this.onJoinGroupRes.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(14103, this.onLeaveGroupRes.bind(this));\r\n        Store.msgDispatcher.addMsgHandler(101, this._onConnectSuccess.bind(this));\r\n        this.registered = true;\r\n      }\r\n\r\n      asyncWrapper(()=>{this.initSuccess()});\r\n    },\r\n    /**\r\n     * 打印状态转移信息\r\n     * @param {*} lifecycle \r\n     */\r\n    onTransition(lifecycle) {\r\n      logger.state(\"transition: \" + lifecycle.transition + \", from \" + lifecycle.from + \" to \" + lifecycle.to)\r\n    },\r\n\r\n    /**\r\n     * 初始化成功\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onInitSuccess: function(lifecycle, params) {\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_INIT, EventResult.SUCCESS)\r\n      } else {\r\n        let params = {\r\n          userId: Store.userInfo.userId,\r\n          appId: Store.userInfo.appId,\r\n          companyId: Store.loginParams.companyId,\r\n          token: Store.loginParams.token,\r\n          forceLogin: true, // 防止用户冲突\r\n          mutexType: Store.loginParams.mutexType,\r\n          extendInfo: Store.loginParams.extendInfo,\r\n          accessUrl: Store.loginParams.accessUrl\r\n        }\r\n        asyncWrapper(()=>{this.doLogin(params)})\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 初始化失败\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onInitFailed: function(lifecycle, params) {\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_INIT, EventResult.FAILED);\r\n      } else {\r\n        Store.restoring = false\r\n        logger.warn(\"Restoring failed for init!\")\r\n      }\r\n    },\r\n    \r\n    /**\r\n     * 执行登录\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoLogin: function(lifecycle, params) {\r\n      console.log('paas login params', params)\r\n      if (!params.userId) {\r\n        asyncWrapper(()=>{this.loginFailed(\"Invalid userId!\")})\r\n      } else {\r\n        Store.userInfo.userId = params.userId;\r\n      }\r\n\r\n      if (!params.appId) {\r\n        asyncWrapper(()=>{this.loginFailed(\"Invalid appId!\")})\r\n      } else {\r\n        Store.userInfo.appId = params.appId;\r\n      }\r\n\r\n      if (!params.token) {\r\n        asyncWrapper(()=>{this.loginFailed(\"Invalid token!\")})\r\n      } else {\r\n        Store.loginParams.token = params.token;\r\n      }\r\n\r\n      // 如果没有指定Access地址，则默认使用公有云服务\r\n      if (!params.accessUrl) {\r\n        params.accessUrl = \"https://access.paas.hst.com/server/address\";\r\n      }\r\n      Store.loginParams.accessUrl = params.accessUrl\r\n\r\n      if (params.forceLogin) {\r\n        Store.loginParams.forceLogin = params.forceLogin ? 1 : 0;\r\n      }\r\n\r\n      if (params.extendInfo) {\r\n        Store.loginParams.extendInfo = params.extendInfo;\r\n      }\r\n\r\n      if (params.companyId) {\r\n        Store.loginParams.companyId = params.companyId;\r\n      }\r\n\r\n      if (params.mutexType) {\r\n        Store.loginParams.mutexType = params.mutexType;\r\n      }\r\n\r\n      let self = this;\r\n      try {\r\n        // 获取WebSocket信令网关地址并创建连接\r\n        wx.request({\r\n          url: Store.buildGetProxyWayUrl(params.accessUrl),\r\n          data: {},\r\n          method: 'GET',\r\n          header: {\r\n            'content-type': 'application/json' // 默认值\r\n          },\r\n          success: function (res) {\r\n            console.log(\"Response from access service: \" + JSON.stringify(res));\r\n            if (res.data.code == 0) {\r\n              const addrUrl = res.data.result\r\n              wx.request({\r\n                url: Store.buildGetGateWayUrl(params.accessUrl),\r\n                data: {},\r\n                method: 'GET',\r\n                header: {\r\n                  'content-type': 'application/json' // 默认值\r\n                },\r\n                success: function (res) {\r\n                  if (res.data.code == 0) {\r\n                    const backwardAddr = res.data.result;\r\n                    if (backwardAddr) {\r\n                      let options = {\r\n                        addrUrl,\r\n                        // addrUrl: 'wss://paas-demo-private.haoshitong.com:21000/wsproxy1',\r\n                        backward_addr: backwardAddr,\r\n                        handler: Store.msgDispatcher,\r\n                        seq_id: parseInt(Math.random() * (1 - 1000) + 1000),\r\n                        closed() { self.onWebSocketClosed(); },\r\n                        error() { self.loginFailed(\"Websocket error!\"); }\r\n                      };\r\n                      Store.websocket = hstWebSocket\r\n                      Store.websocket.createProxyConnect(options)\r\n                    }\r\n                  } else {\r\n                    throw \"Cannot find websocket gateway from response!\";\r\n                  }\r\n                },\r\n                fail: function (res) {\r\n                  throw \"Get websocket gateway failed\";\r\n                },\r\n                complete: function (res) {\r\n                  console.log(\"Get websocket gateway complete\");\r\n                }\r\n              })\r\n            } else {\r\n              throw \"Get websocket gateway error!\";\r\n            }\r\n          }\r\n        });\r\n      } catch (err) {\r\n        asyncWrapper(()=>{self.loginFailed(err);})\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 登录成功\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLoginSuccess: function(lifecycle, params) {\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_LOGIN, EventResult.SUCCESS, params);\r\n      } else {\r\n        asyncWrapper(()=>{this.doJoin(Store.userInfo.groupId)})\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 登录失败\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLoginFailed: function(lifecycle, params) {\r\n      logger.error(\"Login failed: \" + params);\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_LOGIN, EventResult.FAILED);\r\n      } else {\r\n        Store.restoring = false\r\n        logger.warn(\"Restoring failed for login!\")\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 执行加入分组\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoJoin: function(lifecycle, params) {\r\n      protocolSender.sendJoinGroupReq(params);\r\n      Store.userInfo.groupId = params;\r\n    },\r\n\r\n    /**\r\n     * 加入分组成功\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onJoinSuccess: function(lifecycle, params) {\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_JOIN_GROUP, EventResult.SUCCESS, params);\r\n      } else {\r\n        // Store.restoring = false\r\n        logger.log(\"Restoring success.\")\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 加入分组失败\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onJoinFailed: function(lifecycle, params) {\r\n      if (!Store.restoring) {\r\n        eventRegistry.trigger(EventType.EVENT_JOIN_GROUP, EventResult.FAILED);\r\n      } else {\r\n        Store.restoring = false\r\n        logger.warn(\"Restoring failed for join group!\")\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 执行离开分组\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoLeave: function(lifecycle, params) {\r\n      protocolSender.sendLeaveGroupReq();\r\n    },\r\n\r\n    /**\r\n     * 离开分组成功\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLeaveSuccess: function(lifecycle, params) {\r\n      this.onLeaveGroup();\r\n      eventRegistry.trigger(EventType.EVENT_LEAVE_GROUP, EventResult.SUCCESS);\r\n    },\r\n\r\n    /**\r\n     * 离开分组失败\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLeaveFailed: function(lifecycle, params) {\r\n      eventRegistry.trigger(EventType.EVENT_LEAVE_GROUP, EventResult.FAILED);\r\n    },\r\n\r\n    /**\r\n     * 执行登出\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoLogout: function(lifecycle, params) {\r\n      protocolSender.sendLogoutReq();\r\n    },\r\n\r\n    /**\r\n     * 登出成功\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLogoutSuccess: function(lifecycle, params) {\r\n      this.onLogout();\r\n      eventRegistry.trigger(EventType.EVENT_LOGOUT, EventResult.SUCCESS);\r\n    },\r\n\r\n    /**\r\n     * 登出失败\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onLogoutFailed: function(lifecycle, params) {\r\n      eventRegistry.trigger(EventType.EVENT_LOGOUT, EventResult.FAILED);\r\n    },\r\n\r\n    /**\r\n     * 销毁引擎\r\n     * @params {*} lifecycle \r\n     * @params {*} params \r\n     */\r\n    onDoDestroy: function(lifecycle, params) {\r\n      this.onDestroy();\r\n    },\r\n\r\n    /**\r\n     * 断线重连\r\n     * @param {*} lifecycle \r\n     * @param {*} params \r\n     */\r\n    onRestoring: function(lifecycle, params) {\r\n      // Store.restoring = true\r\n      // asyncWrapper(()=>{this.doInit()})\r\n    }\r\n  }\r\n});\r\n\r\nexport default RtcEngine;\r\n","import { getCtrlPoint, stringToColor, stringToRGBA } from '../../common/common'\r\nimport { fillMode, fillStyle } from '../../common/enums'\r\nimport wbManager from \"../media/white-board-manager\"\r\n\r\n/**\r\n * \r\n * @param {*} canv 绘画对象\r\n * @param {*} lineType 0 1 2 3 4\r\n */\r\n function setLineDash (canv, lineType, ratio) {\r\n  let width1 = 20 * ratio\r\n  let width2 = 5 * ratio\r\n  switch (lineType) {\r\n    case 0: \r\n      canv.setLineDash([]);\r\n      break;\r\n    case 1: \r\n      canv.setLineDash([width1, width2]);\r\n      break;\r\n    case 2: \r\n      canv.setLineDash([width2, width2]);\r\n      break;\r\n    case 3: \r\n      canv.setLineDash([width1, width2, width2, width2]);\r\n      break;\r\n    case 4:\r\n      canv.setLineDash([width1, width2, width2, width2, width2, width2]);\r\n      break;\r\n    default: \r\n      canv.setLineDash([]);\r\n  }\r\n}\r\n/**\r\n * \r\n * @param {*} canv \r\n * @param {*} obj \r\n * @param {*} ratio \r\n * @param {*} type 填充类型\r\n */\r\nfunction fillCustom (canv, obj, ratio, type) {\r\n  canv.clip() //必须\r\n  canv.beginPath()\r\n  canv.lineCap = \"butt\"; // 线型\r\n  canv.lineWidth = 1; // 线宽\r\n  canv.setLineDash([]);\r\n  canv.strokeStyle = stringToColor(obj.bg_color); // 线颜色\r\n  let x1 = Math.ceil(obj.left * ratio)\r\n  let y1 = Math.ceil(obj.bottom * ratio)\r\n  let x2 = Math.ceil(obj.right * ratio)\r\n  let y2 = Math.ceil(obj.top * ratio)\r\n  let width = x2 - x1\r\n  let height = y2 - y1\r\n  let space = 8\r\n  let n = Math.ceil(width / space)\r\n  let m = Math.ceil(height / space)\r\n  x2 = x1 + (n + m) * space\r\n  y2 = y1 + (m + n) * space\r\n  switch (type) {\r\n    case fillStyle.SOLID:\r\n      canv.beginPath()\r\n      canv.fillRect(x1, y1, width, height);\r\n      canv.stroke()\r\n      canv.closePath()\r\n      break;\r\n    case fillStyle.L_SLASH: \r\n      for (let i = 1; i <= m + n; i++) {\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x1 + space * i, y1)\r\n        canv.stroke()\r\n        canv.closePath()\r\n        canv.beginPath()\r\n        canv.moveTo(x2, y2 - space * i)\r\n        canv.lineTo(x2 - space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    case fillStyle.GRID: \r\n      for (let i = 1; i < n; i++) { // 竖线\r\n        canv.beginPath()\r\n        canv.moveTo(x1 + space * i, y1)\r\n        canv.lineTo(x1 + space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      for (let i = 1; i < m; i++) { // 横线\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x2, y1 + space * i)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    case fillStyle.IN_GRID: \r\n      for (let i = 1; i <= m + n; i++) {\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x1 + space * i, y1)\r\n        canv.stroke()\r\n        canv.closePath()\r\n        canv.beginPath()\r\n        canv.moveTo(x2, y2 - space * i)\r\n        canv.lineTo(x2 - space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      for (let i = 1; i <= m + n; i++) {\r\n        canv.beginPath()\r\n        canv.moveTo(x2 - space * i, y1)\r\n        canv.lineTo(x2, y1 + space * i)\r\n        canv.stroke()\r\n        canv.closePath()\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x2 - space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    case fillStyle.R_SLASH: \r\n      for (let i = 1; i <= m + n; i++) {\r\n        canv.beginPath()\r\n        canv.moveTo(x2 - space * i, y1)\r\n        canv.lineTo(x2, y1 + space * i)\r\n        canv.stroke()\r\n        canv.closePath()\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x2 - space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    case fillStyle.VERTICAL:\r\n      for (let i = 1; i < n; i++) { // 竖线\r\n        canv.beginPath()\r\n        canv.moveTo(x1 + space * i, y1)\r\n        canv.lineTo(x1 + space * i, y2)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    case fillStyle.HORIZONTAL:\r\n      for (let i = 1; i < m; i++) { // 横线\r\n        canv.beginPath()\r\n        canv.moveTo(x1, y1 + space * i)\r\n        canv.lineTo(x2, y1 + space * i)\r\n        canv.stroke()\r\n        canv.closePath()\r\n      }\r\n      break;\r\n    default: \r\n      canv.fill()\r\n  }\r\n}\r\n/**\r\n * \r\n * @param {*} canv \r\n * @param {*} obj  fill_mode 填充模式\r\n * @param {*} ratio \r\n */\r\nfunction drawFillMode (canv, obj, ratio) {\r\n  if (obj.fill_mode === undefined || obj.fill_mode === fillMode.EMPTY) {\r\n    canv.stroke();\r\n  } else if (obj.fill_mode === fillMode.FILL_WITH_BORDER){\r\n    canv.stroke();\r\n    fillCustom(canv, obj, ratio, obj.bg_shape)\r\n  } else if (obj.fill_mode === fillMode.FILL_NO_BORDER) {\r\n    fillCustom(canv, obj, ratio, obj.bg_shape)\r\n  }\r\n}\r\n\r\nconst draw = {\r\n  // 直线\r\n  line: (canv, obj, ratio) => {\r\n    canv.beginPath();\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineCap = \"butt\"; // 线型\r\n    canv.lineWidth = parseInt(obj.brush_size * ratio); // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color); // 线颜色\r\n\r\n    canv.moveTo(obj.x1 * ratio, obj.y1 * ratio)\r\n    canv.lineTo(obj.x2 * ratio, obj.y2 * ratio)\r\n\r\n    canv.stroke();\r\n    canv.closePath();\r\n  },\r\n  // 曲线\r\n  curve: (canv, obj, ratio) => {\r\n    canv.beginPath();\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineCap = \"butt\"; // 线型\r\n    canv.lineWidth = obj.brush_size * ratio; // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color); // 线颜色\r\n    const points = obj.points.map((item) => {\r\n      return {\r\n        X: parseInt(item[0] * ratio),\r\n        Y: parseInt(item[1] * ratio)\r\n      }\r\n    })\r\n    if (obj.brush_size > 4) {\r\n      canv.moveTo(points[0].X, points[0].Y);\r\n      for (let i = 1; i < points.length; i++) {\r\n        let ctrlP = getCtrlPoint(points, i - 1)\r\n        canv.bezierCurveTo(ctrlP.pA.x, ctrlP.pA.y, ctrlP.pB.x, ctrlP.pB.y, points[i].X, points[i].Y)\r\n      }\r\n    } else {\r\n      for (let i = 0; i < points.length; i++) {\r\n        canv.lineTo(points[i].X, points[i].Y)\r\n      }\r\n    }\r\n    canv.stroke()\r\n    canv.closePath()\r\n  },\r\n  // 文字\r\n  text: (canv, obj, ratio) => {\r\n    if (!Object.prototype.hasOwnProperty.call(obj, 'charset')) {\r\n      canv.beginPath();\r\n      canv.font = `${obj.fontsize * 4 / 3 * ratio}px \"${obj.color}\"`;\r\n      canv.textBaseline = \"top\";\r\n      canv.fillStyle = stringToColor(obj.color);\r\n      var indexLine = 0;\r\n  \r\n        for (var txt of obj.text.split('\\r\\n')) {\r\n          canv.fillText(txt, obj.left * ratio, (indexLine * 22) + obj.top * ratio);\r\n          indexLine++;\r\n        }\r\n    } else { // 云会议 fix bug #2201\r\n      draw.cloudText(canv, obj, ratio)\r\n    }\r\n    canv.closePath();\r\n  },\r\n \r\n  cloudText: (canv, obj, ratio) => {\r\n    let fontsize = parseInt((obj.fontsize + '').replace('-', ''))\r\n    canv.font = `${fontsize * ratio}px ${obj.font}`\r\n    canv.fillStyle = stringToColor(obj.color)\r\n    canv.textBaseline = \"middle\"\r\n    let left = obj.left * ratio\r\n    let bottom = (obj.bottom + fontsize - 10) * ratio\r\n    let maxWidth = (obj.right - obj.left) * ratio\r\n    var strArr = obj.text.split(/\\r\\n|\\n/)\r\n    var row = 0\r\n    for (var i = 0; i < strArr.length; i++) {\r\n      if (strArr[i] == '') {\r\n        row++\r\n      } else {\r\n        var lineBreakNum = drawText(canv, strArr[i], left, bottom,  maxWidth, row, fontsize)\r\n        row = row + lineBreakNum\r\n      }\r\n    }\r\n    function drawText (ctx, str, x1, y1, maxWidth, row, fontsize) {\r\n      str = str.split('')\r\n      let temp = \"\"     \r\n      let rowTextArr = [] // 存储每一行的文字\r\n      for (var i = 0; i < str.length; i++) {\r\n        // 超过最大宽度自动换行\r\n        if (ctx.measureText(temp + str[i]).width <= maxWidth) {\r\n          temp += str[i]\r\n        } else {\r\n          rowTextArr.push(temp)\r\n          temp = str[i]\r\n        }\r\n      }\r\n      rowTextArr.push(temp)\r\n      for (var j = 0; j < rowTextArr.length; j++) {\r\n        ctx.fillText(rowTextArr[j], x1, y1 + (j + row) * fontsize * ratio)\r\n      }\r\n      return rowTextArr.length\r\n    }\r\n  },\r\n  // 矩形\r\n  rectangle: (canv, obj, ratio) => {\r\n    canv.beginPath()\r\n    canv.lineWidth = obj.brush_size * ratio // 线宽\r\n    canv.strokeStyle = obj.color // 线颜色\r\n\r\n    let x1 = parseInt(obj.x1) * ratio;\r\n    let y1 = parseInt(obj.y1) * ratio;\r\n    let x2 = parseInt(obj.x2) * ratio;\r\n    let y2 = parseInt(obj.y2) * ratio;\r\n\r\n    canv.rect(x1, y1, (x2 - x1), (y2 - y1));\r\n    canv.closePath();\r\n    canv.stroke();\r\n  },\r\n  // 荧光笔\r\n  mask_curve: (canv, obj, ratio) => {\r\n    canv.beginPath();\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineCap = \"butt\"; // 线型\r\n    canv.lineWidth = obj.brush_size * ratio; // 线宽\r\n    canv.strokeStyle = stringToRGBA(stringToColor(obj.color), '.4'); // 线颜色\r\n    const points = obj.points.map((item) => {\r\n      return {\r\n        X: parseInt(item[0] * ratio),\r\n        Y: parseInt(item[1] * ratio)\r\n      }\r\n    })\r\n    if (obj.brush_size > 4) {\r\n      canv.moveTo(points[0].X, points[0].Y);\r\n      for (let i = 1; i < points.length; i++) {\r\n        let ctrlP = getCtrlPoint(points, i - 1)\r\n        canv.bezierCurveTo(ctrlP.pA.x, ctrlP.pA.y, ctrlP.pB.x, ctrlP.pB.y, points[i].X, points[i].Y)\r\n      }\r\n    } else {\r\n      for (let i = 1; i < points.length; i++) {\r\n        canv.lineTo(points[i].X, points[i].Y)\r\n      }\r\n    }\r\n    canv.stroke()\r\n    canv.closePath()\r\n  },\r\n  // 箭头\r\n  arrow: (canv, obj, ratio) => {\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineWidth = obj.brush_size * ratio // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color) // 线颜色\r\n    canv.fillStyle = stringToColor(obj.color)\r\n\r\n    drawLineArrow(canv, obj.x1 * ratio, obj.y1 * ratio, obj.x2 * ratio, obj.y2 * ratio, 10, 26)\r\n\r\n    /**\r\n     * 画箭头\r\n     * fromX / fromY 起点坐标\r\n     * toX / toY 终点坐标\r\n     * headlen 箭头线的长度\r\n     * theta 箭头线与直线的夹角\r\n     */\r\n    function drawLineArrow (ctx, fromX, fromY, toX, toY, headlen, theta) {\r\n      var arrowX, arrowY // 箭头线终点坐标\r\n      // 计算各角度和对应的箭头终点坐标\r\n      var angle = Math.atan2(fromY - toY, fromX - toX) * 180 / Math.PI\r\n      var angle1 = (angle + theta) * Math.PI / 180\r\n      var angle2 = (angle - theta) * Math.PI / 180\r\n      var topX = headlen * Math.cos(angle1)\r\n      var topY = headlen * Math.sin(angle1)\r\n      var botX = headlen * Math.cos(angle2)\r\n      var botY = headlen * Math.sin(angle2)\r\n\r\n      canv.save()\r\n      ctx.beginPath()\r\n\r\n      //画直线\r\n      ctx.moveTo(fromX, fromY)\r\n      ctx.lineTo(toX, toY)\r\n  \r\n      arrowX = toX + topX\r\n      arrowY = toY + topY\r\n\r\n      //画上边箭头线\r\n      ctx.moveTo(arrowX, arrowY)\r\n      ctx.lineTo(toX, toY)\r\n  \r\n      arrowX = toX + botX\r\n      arrowY = toY + botY\r\n\r\n      //画下边箭头线\r\n      ctx.lineTo(arrowX, arrowY)\r\n\r\n      ctx.closePath()\r\n      ctx.fill()\r\n      ctx.stroke()\r\n      ctx.restore()\r\n    }\r\n  },\r\n  rect: (canv, obj, ratio) => {\r\n    canv.save()\r\n    canv.beginPath()\r\n    if (obj.bg_color) {\r\n      canv.fillStyle = stringToColor(obj.bg_color)\r\n    }\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineWidth = obj.brush_size * ratio // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color) // 线颜色\r\n\r\n    let x1 = parseInt(obj.left) * ratio\r\n    let y1 = parseInt(obj.bottom) * ratio\r\n    let x2 = parseInt(obj.right) * ratio\r\n    let y2 = parseInt(obj.top) * ratio\r\n\r\n    canv.rect(x1, y1, (x2 - x1), (y2 - y1));\r\n    canv.closePath();\r\n    drawFillMode(canv, obj, ratio)\r\n    canv.restore()\r\n  },\r\n  // 圆角矩形\r\n  round_rect: (canv, obj, ratio) => {\r\n    canv.save()\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineWidth = obj.brush_size * ratio // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color) // 线颜色\r\n\r\n    let x1 = parseInt(obj.left) * ratio // 矩形左上角 x 轴坐标\r\n    let y1 = parseInt(obj.bottom) * ratio // 矩形左上角 y轴坐标\r\n    let width = parseInt(obj.right - obj.left) * ratio // 矩形的宽度\r\n    let height = parseInt(obj.top - obj.bottom) * ratio // 矩形的高度 \r\n    let radius = Math.min(width, height) / 10 // 圆的半径\r\n\r\n    canv.save()\r\n    canv.translate(x1, y1)\r\n    canv.beginPath()\r\n    //从右下角顺时针绘制，弧度从 0 到 1 / 2PI  \r\n    canv.arc(width - radius, height - radius, radius, 0, Math.PI / 2)\r\n    //矩形下边线\r\n    canv.lineTo(radius, height)\r\n    //左下角圆弧，弧度从 1 / 2PI 到 PI\r\n    canv.arc(radius, height - radius, radius, Math.PI / 2, Math.PI)\r\n    //矩形左边线\r\n    canv.lineTo(0, radius)\r\n    //左上角圆弧，弧度从 PI 到 3 / 2PI  \r\n    canv.arc(radius, radius, radius, Math.PI, Math.PI * 3 / 2)\r\n    //上边线\r\n    canv.lineTo(width - radius, 0)\r\n    //右上角圆弧\r\n    canv.arc(width - radius, radius, radius, Math.PI * 3 / 2, Math.PI * 2)\r\n    //右边线  \r\n    canv.lineTo(width, height - radius)\r\n    canv.closePath()\r\n    canv.restore() // 清除translate 改变中线点\r\n\r\n    drawFillMode(canv, obj, ratio)\r\n    canv.restore()\r\n  },\r\n  // 椭圆\r\n  ellipse: (canv, obj, ratio) => {\r\n    canv.save()\r\n    setLineDash(canv, obj.line_shape, ratio)\r\n    canv.lineWidth = obj.brush_size * ratio // 线宽\r\n    canv.strokeStyle = stringToColor(obj.color) // 线颜色\r\n\r\n    let a = parseInt((obj.right - obj.left) / 2) * ratio // 椭圆横半轴长度\r\n    let b = parseInt((obj.top - obj.bottom) / 2) * ratio // 椭圆纵半轴长度\r\n    let x = a + parseInt(obj.left) * ratio // 椭圆中心 x 轴坐标\r\n    let y = b + parseInt(obj.bottom) * ratio // 椭圆中心 y 轴坐标\r\n\r\n    let r = (a > b) ? a : b // 选择a、b中的较大者作为arc方法的半径参数\r\n    let ratioX = a / r // 横轴缩放比率\r\n    let ratioY = b / r // 纵轴缩放比率\r\n    canv.save()\r\n    canv.scale(ratioX, ratioY) // 进行缩放（均匀压缩）\r\n    canv.beginPath()\r\n    canv.moveTo((x + a) / ratioX, y / ratioY) //从椭圆的左端点开始逆时针绘制\r\n    canv.arc(x / ratioX, y / ratioY, r, 0, 2 * Math.PI)\r\n    canv.closePath()\r\n    canv.restore() // 清除缩放效果\r\n\r\n    drawFillMode(canv, obj, ratio)\r\n\r\n    canv.restore()\r\n  },\r\n  // 插入图片\r\n  pic: (canv, obj, ratio, canvasEle) => {\r\n    let filePath =  `/${obj.user_data.id}`\r\n    let key2 = `/${obj.user_data.id}/${0}.jpg`\r\n    // sendMessage(key2)\r\n    if (!obj.insertSuccess) {\r\n      insertImage()\r\n    }\r\n    function insertImage (n = 0) {\r\n      if (n > 20) return\r\n      if (wbManager.cacheFileUrlMap.get(filePath) && wbManager.cacheFileUrlMap.get(filePath).get(key2)) {\r\n        let left = obj.left * ratio\r\n        let bottom = obj.bottom * ratio\r\n        let right = obj.right * ratio\r\n        let top = obj.top * ratio\r\n        wx.getImageInfo({\r\n          src: wbManager.cacheFileUrlMap.get(filePath).get(key2),\r\n          success: function(res) {\r\n            console.log('getImageInfoRes', res)\r\n            if (canvasEle) {\r\n              let seal = canvasEle.createImage()\r\n              seal.src = res.path\r\n              seal.onload = function() {\r\n                console.log(\"加载图片成功\")\r\n                canv.drawImage(\r\n                    seal, \r\n                    0, \r\n                    0, \r\n                    right - left, \r\n                    top - bottom)\r\n                obj.insertSuccess = true\r\n              }\r\n              seal.onerror = function(res) {\r\n                console.error(\"加载图片失败\", res)\r\n              }\r\n            } \r\n          },\r\n          fail: function(err) {\r\n            console.warn(\"Get image info failed!\")\r\n          }\r\n        })\r\n      } else {\r\n        wbManager._getFileUrl(key2)\r\n        setTimeout(() => {\r\n          insertImage(++n)\r\n        }, 500)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// // 插入图片\r\n// pic: (canv, obj, ratio, canvasEle) => {\r\n//   let tempPathKey = `/${obj.user_data.id}/${0}.jpg`\r\n//   let left = obj.left * ratio\r\n//   let bottom = obj.bottom * ratio\r\n//   let right = obj.right * ratio\r\n//   let top = obj.top * ratio\r\n//   const imgPath = wbManager.cacheTempPathMap && wbManager.cacheTempPathMap.get(tempPathKey)\r\n//   if (imgPath) {\r\n//     preloadImage(canvasEle, imgPath, (img)=> {\r\n//       canv.drawImage(\r\n//         img, \r\n//         0, \r\n//         0, \r\n//         right - left, \r\n//         top - bottom)\r\n//     }, ()=> {\r\n//       wbManager.cacheTempPathMap.delete(tempPathKey)\r\n//       insertImage(canv, obj, ratio, canvasEle)\r\n//     })\r\n//   } else {\r\n//     insertImage(canv, obj, ratio, canvasEle)\r\n//   }\r\n// },\r\n// }\r\n\r\n// function insertImage(canv, obj, ratio, canvasEle) {\r\n// let filePath =  `/${obj.user_data.id}`\r\n// let key2 = `/${obj.user_data.id}/${0}.jpg`\r\n// let left = obj.left * ratio\r\n// let bottom = obj.bottom * ratio\r\n// let right = obj.right * ratio\r\n// let top = obj.top * ratio\r\n// if (wbManager.cacheFileUrlMap.get(filePath) && wbManager.cacheFileUrlMap.get(filePath).get(key2)) {\r\n//   getTempPath(wbManager.cacheFileUrlMap.get(filePath).get(key2), (path)=> {\r\n//     wbManager.cacheTempPathMap.set(key2, path)\r\n//       if (canvasEle) {\r\n//         preloadImage(canvasEle, path, (img)=> {\r\n//           console.log('加载图片成功')\r\n//           canv.drawImage(\r\n//             img, \r\n//             0, \r\n//             0, \r\n//             right - left, \r\n//             top - bottom)\r\n//         }, ()=> {\r\n//           console.log('加载图片失败')\r\n//         })\r\n//       } \r\n//   })\r\n// } else {\r\n//   wbManager._getFileUrl(key2)\r\n//   setTimeout(() => {\r\n//     insertImage(canv, obj, ratio, canvasEle)\r\n//   }, 500)\r\n// }\r\n// }\r\n\r\nexport default draw","\r\n\r\n/**\r\n * \r\n * @param {*} target\r\n * @param {*} p0 \r\n * @param {*} p1 \r\n */\r\nfunction isPointAt (target, p0, p1) {\r\n  let maxAllowOffsetLength = 15\r\n  const A = p1.y- p0.y\r\n  const B = p0.x - p1.x\r\n  const C = p1.x * p0.y - p0.x* p1.y\r\n  // 点到直线的距离方程\r\n  let dis = Math.abs(A * target.x + B * target.y + C) / Math.sqrt(Math.pow(A, 2) + Math.pow(A, 2))\r\n  if (dis > maxAllowOffsetLength) {\r\n    return false\r\n  } else {\r\n    const D = (A * target.y - B * target.x);\r\n    const jiaoX = -(A * C + B *D) / (Math.pow(B, 2) + Math.pow(A, 2));\r\n    //判断jiaoX是否在线段上，t如果在0~1之间说明在线段上，大于1则说明不在线段且靠近端点p1，小于0则不在线段上且靠近端点p0，这里用了插值的思想\r\n    const t = (jiaoX - p0.x) / (p1.x - p0.x);\r\n    if (t > 1  || isNaN(t)) {\r\n    //最小距离为到p1点的距离\r\n      dis = getLengthOfTwoPoint(p1, target);\r\n    }else if (t < 0){\r\n    //最小距离为到p2点的距离\r\n      dis = getLengthOfTwoPoint(p0, target);\r\n    }\r\n    //再次判断真正的最小距离是否小于允许值，小于则该点在直线上，反之则不在\r\n    if (dis <= maxAllowOffsetLength) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n//这里是求两点距离公式\r\nfunction getLengthOfTwoPoint(point1, point2){\r\n  return Math.sqrt(Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2));\r\n}\r\n\r\nexport {\r\n  isPointAt\r\n}","\r\nimport logger from \"../../common/logger\";\r\n\r\n/**\r\n * 消息分发器\r\n */\r\nclass MsgDispatcher {\r\n  constructor() {\r\n    this.handlerMap = new Map();\r\n  }\r\n\r\n  /**\r\n   * 添加消息处理器\r\n   * @param {*} msgId \r\n   * @param {*} handler \r\n   */\r\n  addMsgHandler(msgId, handler) {\r\n    if (!this.handlerMap[msgId]) {\r\n      this.handlerMap[msgId] = handler;\r\n    } else {\r\n      logger.error(\"Message: \" + msgId + \" handler already exists!\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除消息处理器\r\n   * @param {*} msgId \r\n   */\r\n  removeMsgHandler(msgId) {\r\n    if (this.handlerMap[msgId]) {\r\n      this.handlerMap.delete(msgId);\r\n    } else {\r\n      logger.warn(\"Cannot find message handler: \" + msgId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除所有处理器\r\n   */\r\n  clearMsgHandler() {\r\n    this.handlerMap = new Map();\r\n  }\r\n\r\n  /**\r\n   * 消息处理\r\n   * @param {*} msg \r\n   * @param {*} socket \r\n   */\r\n  onMessage(msg, socket) {\r\n    try {\r\n      if (msg.id) {\r\n        if (this.handlerMap[msg.id]) {\r\n          this.handlerMap[msg.id](msg, socket);\r\n        } else {\r\n          // msg.id !== 30000 && logger.warn(\"No handler for msg: \" + msg.id);\r\n        }\r\n      } else {\r\n        logger.error(\"Unexpected!!!\");\r\n      }\r\n    } catch (e) {\r\n     console.error(e) \r\n    }\r\n  }\r\n}\r\n\r\nexport default MsgDispatcher;\r\n\r\n","import logger from \"../../common/logger\"\r\nimport MsgDispatcher from '../util/msg-dispatcher'\r\nimport { ProxyEventType } from '../../common/enums'\r\nimport eventRegistry from \"../../common/event-registry\"\r\nimport store from \"./store\"\r\n\r\n/**\r\n * 对原生websocket的封装\r\n */\r\nclass HstWebSocket {\r\n  constructor() {\r\n    this.curAddrUrl = ''\r\n    this.socket = {}\r\n    this.allSocket = {}\r\n    this.handlers = [] // 事件监听处理队列\r\n    this.connected_hooks = [] // socket握手成功钩子函数列表\r\n    this.closed_hooks = [] // socket链接断开钩子函数列表\r\n    this.error_hooks = []\r\n    this.limitConnect = this.getTimer()\r\n    this.proxyIndex = 0\r\n    this.timer = null\r\n    this.lockReconnect = false\r\n    const msgDispatcher = new MsgDispatcher()\r\n    msgDispatcher.addMsgHandler(ProxyEventType.CREATE_CHANNEL_SUCCESS, this._onConnectSuccess.bind(this))\r\n    this.handlers.push(msgDispatcher)\r\n  }\r\n\r\n  /**\r\n   * 创建websocket\r\n   */\r\n  _createWebsocket(key) {\r\n    let self = this\r\n    const { addrUrl } = this.allSocket[key]\r\n    this.curAddrUrl = addrUrl\r\n    if (!addrUrl) {\r\n      throw new Error(\"Can't find webscoket link !\");\r\n    }\r\n    let options = {\r\n      url: addrUrl,\r\n      success: function() {\r\n        logger.info(\"Create websocket success.\")\r\n      },\r\n      fail: function(res) {\r\n        logger.error(\"Create websocket failed, url: \" + self.curAddrUrl);\r\n        console.error(res)\r\n      },\r\n      complete: function() {\r\n        logger.info(\"Create websocket complete.\");\r\n      }\r\n    }\r\n    this.socket = wx.connectSocket(options);\r\n    if (!this.socket) {\r\n      logger.error(\"Connect socket failed: \" + this.curAddrUrl);\r\n      return;\r\n    }\r\n    this._eventBind(key);\r\n  }\r\n\r\n  _sendCreateProxyMsg(key) {\r\n    const { backward_addr } =  this.allSocket[key]\r\n    const msg = {\r\n      id: ProxyEventType.CREATE_CHANNEL,\r\n      backward_addr: backward_addr,\r\n      seq: key\r\n    }\r\n    if (this.socket && this.socket.readyState === 1) {\r\n      this.socket.send({\r\n        data: JSON.stringify(msg),\r\n        success: (res) => {\r\n        },\r\n        fail: function(res) {\r\n          console.warn('res', res)\r\n          logger.error(\"Send failed!\");\r\n          resolve(false)\r\n        },\r\n        complete: function(res) {\r\n        }\r\n      })\r\n    } else {\r\n      logger.warn('socket error')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绑定事件处理\r\n   * @param {*} socket \r\n   */\r\n  _eventBind(key) {\r\n    let self = this\r\n    this.socket.onOpen(function(res){\r\n      logger.warn(\"Websocket opened: \" + self.curAddrUrl);\r\n      this.proxyIndex = 1\r\n      console.error(res)\r\n      self._sendCreateProxyMsg(key)\r\n    })\r\n\r\n    this.socket.onClose(function(res){\r\n      logger.warn(\"Websocket closed: \" + self.curAddrUrl);\r\n      console.error(res)\r\n      self.closed_hooks.map(item => {\r\n        item(arguments)\r\n      })\r\n      self.handlers = []\r\n      self.connected_hooks = []\r\n      self.closed_hooks = []\r\n      self.error_hooks = []\r\n      if (res.code !== 1000) {\r\n        eventRegistry.trigger('onError', { code: 101 })\r\n      }\r\n    })\r\n\r\n    this.socket.onMessage(function(res) {\r\n      let msg = JSON.parse(res.data);\r\n      const { channel_id } = msg\r\n      if (channel_id == store.mainWebsocketChannelId && msg.id == ProxyEventType.CONNECT_ERROR && msg.result == 2) {\r\n        eventRegistry.trigger('onError', { code: 101 })\r\n        if (self.socket !== undefined) {\r\n          self.socket.close()\r\n        }\r\n      }\r\n      if (msg.id == ProxyEventType.BUSINESS_MESSAGE) {\r\n        msg.msg && (msg = JSON.parse(msg.msg))\r\n      }\r\n      msg.channel_id = channel_id\r\n      if (msg.id != 30000) { // 白板心跳消息太多了\r\n        logger.log(\"===> Recv msg from \" + self.curAddrUrl + \": \" + JSON.stringify(msg));\r\n      }\r\n      self.handlers.map(handler => {\r\n        handler.onMessage(msg)\r\n      });\r\n    });\r\n\r\n    this.socket.onError(function(res){\r\n      logger.warn('Error res', res)\r\n      self.error_hooks.map(item => {\r\n        item(arguments)\r\n      })\r\n      if (self.socket !== undefined) {\r\n        self.socket.close()\r\n      }\r\n    })\r\n  }\r\n\r\n  _onConnectSuccess() {\r\n    this.connected_hooks.map(item => {\r\n      item(arguments)\r\n    })\r\n  }\r\n\r\n  createProxyConnect(options) {\r\n    const key = options.seq_id\r\n    if (this.allSocket[key]) {\r\n      logger.info('Proxy connect already exists !')\r\n    } else {\r\n      const { handler = {}, opened = ()=>{}, closed = ()=>{}, error = ()=>{} } = options\r\n      this.handlers.push(handler)\r\n      this.connected_hooks.push(opened)\r\n      this.closed_hooks.push(closed)\r\n      this.error_hooks.push(error)\r\n      this.allSocket[key] = {...options}\r\n      if (this.socket && this.socket.readyState === 1) {\r\n        this._sendCreateProxyMsg(key)\r\n      } else {\r\n        this._createWebsocket(key)\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 重连处理\r\n   */\r\n   reconnect() {\r\n     console.warn('start reconnect')\r\n     if (this.lockReconnect) return\r\n     this.lockReconnect = true\r\n     clearTimeout(this.timer)\r\n     this.timer = null;\r\n     if (this.proxyIndex < 2) {\r\n        this.timer = setTimeout(()=> {\r\n          this.lockReconnect = false\r\n          for(const key in this.allSocket) {\r\n            if (this.socket && this.socket.readyState === 1) {\r\n              this._sendCreateProxyMsg(key)\r\n            } else {\r\n              this._createWebsocket(key)\r\n            }\r\n          }\r\n        }, 5000)\r\n        this.proxyIndex ++\r\n     } else {\r\n      clearInterval(this.timer)\r\n      this.timer = null;\r\n      throw new Error('重连失败')\r\n     }\r\n   }\r\n  // reconnect() {\r\n  //   if (!this.connectStatus) return\r\n  //   this.limitConnect(function() {\r\n  //     this.proxyIndex++;\r\n  //   });\r\n\r\n  //   this.createProxyConnect();\r\n  // }\r\n\r\n  // /**\r\n  //  * 获取原生websocket\r\n  //  */\r\n  // getSocket() {\r\n  //   if (this.socket && this.socket.readyState === 1) {\r\n  //     return this.socket;\r\n  //   }\r\n  //   return null;\r\n  // }\r\n\r\n  /**\r\n   * 暂时没使用\r\n   */\r\n  getTimer() {\r\n    var timerArray = [];\r\n    return function(fn) {\r\n      timerArray.push(new Date().getTime());\r\n      var timer = new Date().getTime();\r\n      if (timer - timerArray[0] > 5000) {\r\n        timerArray = [];\r\n        fn.apply(this, arguments);\r\n      }\r\n    };\r\n  }\r\n\r\n  // /**\r\n  //  * 暂时没使用\r\n  //  * @param {*} val \r\n  //  */\r\n  // setAddr(val) {\r\n  //   if (!(val instanceof Array)) {\r\n  //     throw new Error(\"value is not Array\");\r\n  //   }\r\n  //   this.addrUrls = val;\r\n  //   this.proxyIndex = 0;\r\n  //   this.createWebsocket();\r\n  // }\r\n\r\n  /**\r\n   * 发送消息\r\n   * @param {*} msg \r\n   */\r\n  send(msg) {\r\n    if (this.socket && this.socket.readyState === 1) {\r\n      logger.log(\"<=== Send msg to \" + this.curAddrUrl + \": \" + msg);\r\n      this.socket.send({\r\n        data: msg,\r\n        success: function(res) {\r\n        },\r\n        fail: function(res) {\r\n          logger.error(\"Send failed!\");\r\n        },\r\n        complete: function(res) {\r\n        }\r\n      });\r\n    } else {\r\n      logger.error(\"Send msg failed: \" + msg);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 关闭websocket\r\n   */\r\n  close() {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n  }\r\n}\r\nexport default new HstWebSocket()\r\n","import Store from \"./store\"\r\nimport { generateGUID } from \"../../common/common\"\r\nimport { MediaType, RecvMagicMode } from \"../../common/enums\"\r\nimport audioManager from \"../media/audio-manager\"\r\n\r\nclass ProtocolSender {\r\n  sendJoinGroupReq(groupId) {\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14100,\r\n      group_id: groupId\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendLeaveGroupReq() {\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14102\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendResolutionReport(params) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 18004,\r\n      stream_id: params.streamId,\r\n      width: params.width,\r\n      height: params.height,\r\n      channel_type: params.channelType,\r\n      report_type: params.reportType\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendLogoutReq(){\r\n    let msg = {\r\n      business: \"BASE\",\r\n      id: 10002\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendLoginReq(options){\r\n    let msg = {\r\n      business: \"BASE\",\r\n      id: 10000,\r\n      app_id: options.appId,\r\n      company_id: options.companyId,\r\n      token: options.token,\r\n      user_id: options.userId,\r\n      client_guid: generateGUID(), // FIXME：不唯一\r\n      os_type: options.osType,\r\n      mutex_type: options.mutexType,\r\n      force_login: options.forceLogin, \r\n      registered_user: options.registered,\r\n      protocol_version: \"0.0.1\",\r\n      sdk_type: 26,\r\n      extend_info: options.extendInfo,\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendPublishMediaReq(operation, mediaType, mediaId, mediaOwner){\r\n    let msg = {\r\n      business: \"GS\",\r\n      id: 14104,\r\n      //媒体类型，0为屏幕共享，1为音频，2为视频\r\n      media_type: mediaType,\r\n      // TODO 如果需要发布多路流，需要传入MediaId，单路流不影响\r\n      media_id: mediaId,\r\n      media_owner: mediaOwner,\r\n      //操作类型，0停止广播，1开启广播\r\n      operation: operation\r\n    };\r\n  \r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendRecvMediaReq(recvState, userId, mediaType, mediaId) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 18002,\r\n      group_id: Store.userInfo.groupId,\r\n      user_id: userId,\r\n      media_type: mediaType, //媒体类型，0为屏幕共享，1为音频，2为视频\r\n      media_id: mediaId,\r\n      recv: recvState       //0停止接收，1开启接收\r\n    };\r\n  \r\n    if (mediaType == MediaType.AUDIO) {\r\n      // 接收变声，但media_id没有_magic后缀，则加上后缀\r\n      if (audioManager.recvMagicAudio == RecvMagicMode.ONLY_MAGIC) {\r\n        if (mediaId.indexOf(\"_magic\") == -1) {\r\n          msg.media_id = mediaId + \"_magic\";\r\n        }  \r\n      } else if (audioManager.recvMagicAudio == RecvMagicMode.ONLY_ORIGIN) { // 接收原声，但media_id有_magic后缀，则剥掉后缀\r\n        if (mediaId.indexOf(\"_magic\") != -1) {\r\n          msg.media_id = mediaId.substr(0, mediaId.length - 6);\r\n        }\r\n      } else {\r\n        // Do nothing\r\n      }\r\n    }\r\n\r\n    // 白板属于组内资源\r\n    if (mediaType == MediaType.WHITE_BOARD) {\r\n      msg.media_owner = \"group\"\r\n    } else {\r\n      msg.media_owner = \"user\"\r\n    }\r\n  \r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendRecvWhiteboardReq(recvState, mediaType, mediaId) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 18002,\r\n      group_id: Store.userInfo.groupId,\r\n      media_type: mediaType, //媒体类型，0为屏幕共享，1为音频，2为视频, 4为白板\r\n      media_id: mediaId,\r\n      recv: recvState,       //0停止接收，1开启接收\r\n      source_type: 1,\r\n      user_data: {}\r\n    };\r\n\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendCreateWhiteboardReq(parmas) {\r\n    let msg = {\r\n      business: \"WBS\",\r\n      id: 19000,\r\n      cli_seq_id: 1,\r\n      board_type: 0, \r\n      width: 1280, \r\n      height: 768,\r\n      file_path: '',\r\n      convert_file_path: '',\r\n      page: 1\r\n    }\r\n    msg = Object.assign(msg, parmas)\r\n    msg.convert_file_path = msg.convert_file_path.toUpperCase()\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n  \r\n  sendCloseWhiteboardReq(mediaId) {\r\n    let msg = {\r\n      business: \"WBS\",\r\n      id: 19002,\r\n      board_id: mediaId\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendOpenUpload ({ file_path, size }) {\r\n    let msg = {\r\n      business: 'STORE',\r\n      id: 20010,\r\n      upload_id: Store.userInfo.userId,\r\n      checksum: '',\r\n      file_path: file_path,\r\n      file_size: size,\r\n      upload_mode: 0\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  sendUploadEnd (params) {\r\n    let msg = {\r\n      business: 'STORE',\r\n      id: 20002,\r\n      ...params\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n  sendTransCodeMsg (file_path) {\r\n    let msg = {\r\n      business: 'DC',\r\n      id: 21000,\r\n      file_path: file_path\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n  \r\n  sendNotifySendStreamRes(params) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 18001,\r\n      stream_id: params.streamId,\r\n      send: params.send,\r\n      result: params.result\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  } \r\n\r\n  sendLogoutRecvChannelReq(streamId) {\r\n    let msg = {\r\n      business: 'SS',\r\n      id: 19012,\r\n      stream_id: streamId,\r\n      client_id: \"{\" + Store.userInfo.appId + \";\" + Store.userInfo.groupId + \"};\" + Store.userInfo.userId\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendLoginRecvChannelReq(params, bindId) {\r\n    let msg = {\r\n      business: 'WBS',\r\n      id: 19004,\r\n      stream_id: params.streamId,\r\n      stream_token: params.streamToken,\r\n      media_type: params.media_type,\r\n      media_id: params.media_id,\r\n      client_id: \"{\" + Store.userInfo.appId + \";\" + Store.userInfo.groupId + \"};\" + Store.userInfo.userId,\r\n      version: \"1.0.0\",\r\n      bind_id: bindId\r\n    }\r\n    msg = this._dealMsg(msg, params.channelId)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendSdpInfo(description, pcId) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 19008,\r\n      type: description.type,\r\n      pc_id: pcId,\r\n      sdp: description.sdp\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendCandidate(event, pcId) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 19008,\r\n      pc_id: pcId,\r\n      candidate: event.candidate.candidate,\r\n      sdpMid: event.candidate.sdpMid,\r\n      sdpMLineIndex: event.candidate.sdpMLineIndex\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendLoginSendChannelReq(params, bindId) {\r\n    let msg = {\r\n      business: 'WBS',\r\n      id: 19006,\r\n      stream_id: params.streamId,\r\n      stream_token: params.streamToken,\r\n      media_type: params.mediaType,\r\n      media_id: params.mediaId,\r\n      client_id: Store.getClientId(),\r\n      version: \"1.0.0\",\r\n      bind_id: bindId\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendSetAudioMagic(streamId, value) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 19010,\r\n      stream_id: streamId,\r\n      client_id: Store.getClientId(),\r\n      param: [{\r\n        param_type: \"SoundTouch\",\r\n        param_value: value.toString()\r\n      }]\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  SendSetAudioMagicReq(streamId, value) {\r\n    let msg = {\r\n      business: \"SS\",\r\n      id: 19010,\r\n      stream_id: streamId,\r\n      client_id: Store.getClientId(),\r\n      param: [{\r\n        param_type: \"SoundTouch\",\r\n        param_value: value.toString()\r\n      }]\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendGetWhiteBoardFullDataReq(channelId) {\r\n    let msg = {\r\n      id: 30003\r\n    };\r\n    msg = this._dealMsg(msg, channelId)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendChangeWhiteBoardProperty(params, channelId) {\r\n    let msg = {\r\n      id: 30103,\r\n      seq_id: Math.floor(Math.random() * 1000),\r\n      edit_id: params.edit_id,\r\n      zoom: params.zoom,\r\n      rotate_angle: params.rotateAngle,\r\n      mouse_posx: params.mouse_posx,\r\n      mouse_posy: params.mouse_posy,\r\n      scroll_posx: params.scroll_posx,\r\n      cur_page: params.cur_page\r\n    };\r\n    msg = this._dealMsg(msg, channelId)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  sendSwitchWhiteBoard(editId ,channelId) {\r\n    let msg = {\r\n      id: 30101,\r\n      seq_id: Math.floor(Math.random() * 100),\r\n      edit_id: editId,\r\n      is_select: true\r\n    }\r\n    msg = this._dealMsg(msg, channelId)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  sendRecvBoardFileList(filePath) {\r\n    let msg = {\r\n      business: 'STORE',\r\n      id: 20004,\r\n      path: filePath,\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  sendGetWhiteBoardFileUrlReq(filePath) {\r\n    let msg = {\r\n      business: 'STORE',\r\n      id: 20006,\r\n      file_path: filePath\r\n    }\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendUserMsg(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11000,\r\n      dst_user_id: params.dstUserId,\r\n      msg_id: 1024,\r\n      msg: params.msg\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendUserMsgAck(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11004,\r\n      src_user_id: params.src_user_id,\r\n      msg_id: params.msg_id\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendGroupMsgWithWhiteList(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11006,\r\n      group_id: params.groupId,\r\n      white_list: params.whiteList,\r\n      msg_id: 1024,\r\n      msg: params.msg\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendGroupMsgWithBlackList(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11006,\r\n      group_id: params.groupId,\r\n      black_list: params.blackList,\r\n      msg_id: 1024,\r\n      msg: params.msg\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendGroupMsg(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11006,\r\n      group_id: params.groupId,\r\n      msg_id: 1024,\r\n      msg: params.msg\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendGroupMsgAck(params) {\r\n    let msg = {\r\n      business: \"SG\",\r\n      id: 11010,\r\n      group_id: params.group_id,\r\n      src_user_id: params.src_user_id,\r\n      msg_id: params.msg_id\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  sendKickOutRes() {\r\n    let msg = {\r\n      business: \"PS\",\r\n      id: 12008\r\n    };\r\n    msg = this._dealMsg(msg)\r\n    Store.websocket.send(JSON.stringify(msg));\r\n  }\r\n\r\n  /**\r\n   * 获取编辑\r\n   * @param {*} websocket \r\n   */\r\n   sendOpenEdit (channelId) {\r\n    let msg = {\r\n      id: 30001\r\n    }\r\n    msg = this._dealMsg(msg, channelId)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n  sendPageInfoMsg (params) {\r\n    let msg = {\r\n      id: 30200,\r\n      page: {\r\n        pid: params.curPage,\r\n        action: params.action\r\n      },\r\n      edit_id: params.edit_id,\r\n      seq_id: params.seq_id,\r\n      type: 'page',\r\n    }\r\n    msg = this._dealMsg(msg, params.channelId)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  sendGraphMsg (parmas) {\r\n    // let msg = Object.assign({id: 31000}, parmas)\r\n    let msg = this._dealMsg(parmas, parmas.channelId)\r\n    Store.websocket.send(JSON.stringify(msg))\r\n  }\r\n\r\n  _dealMsg(msg, channelId) {\r\n    if (!channelId) {\r\n      channelId = Store.mainWebsocketChannelId\r\n    }\r\n    return {\r\n      id: 102,\r\n      channel_id: channelId,\r\n      msg: JSON.stringify(msg),\r\n    }\r\n  }\r\n}\r\n\r\nexport default new ProtocolSender();","import MsgDispatcher from \"./msg-dispatcher\"\r\nimport { detectOS, getAddrs } from \"../../common/common\"\r\nimport logger from \"../../common/logger\";\r\n/**\r\n * 全局数据保存区\r\n * 注意：数据应该优先放到对应模块中，只有明确放在全局可以简化依赖关系，\r\n * 有利于降低代码复杂度，才可以放到Store中\r\n */\r\nclass Store {\r\n  constructor() {\r\n    // 与信令网关之间的连接\r\n    this.websocket = null;\r\n\r\n    // 断线恢复标志\r\n    this.restoring = false;\r\n\r\n    // 用户信息\r\n    this.userInfo = {\r\n      appId: null,\r\n      groupId: null,\r\n      userId: null,\r\n    };\r\n\r\n    // 登录信息\r\n    this.loginParams = {\r\n      accessUrl: \"\",\r\n      token: null,\r\n      companyId: \"\",\r\n      forceLogin: 1,    // 0是非强制登录 1是强制登录\r\n      extendInfo: \"\",\r\n      mutexType: \"web\",\r\n      registered: 1,    // 0是非注册，1是注册\r\n      sessionId: ''\r\n    }\r\n\r\n    // websocket主通道id\r\n    this.mainWebsocketChannelId = ''\r\n\r\n    // Protocol handler\r\n    this.msgDispatcher = new MsgDispatcher();\r\n  }\r\n  \r\n  /**\r\n   * 获取ClientID\r\n   */\r\n  getClientId() {\r\n    return \"{\" + this.userInfo.appId \r\n      + \";\" + this.userInfo.groupId \r\n      + \"};\" + this.userInfo.userId;\r\n  }\r\n\r\n  /**\r\n   * 构造获取CP的URL参数\r\n   */\r\n  buildGetGateWayUrl(accessUrl) {\r\n    return accessUrl + \"?appType=47&appId=\" + this.userInfo.appId \r\n      + \"&ver=\" + SDK_VERSION \r\n      + \"&comid=\" + this.loginParams.companyId \r\n      + \"&os=wechat\"\r\n      + \"&token=\" + this.loginParams.token;\r\n  }\r\n\r\n  /**\r\n   * 构造获取代理的URL参数\r\n   */\r\n   buildGetProxyWayUrl(accessUrl) {\r\n    return accessUrl + \"?appType=48&appId=\" + this.userInfo.appId \r\n      + \"&ver=\" + SDK_VERSION \r\n      + \"&comid=\" + this.loginParams.companyId \r\n      + \"&os=wechat\"\r\n      + \"&token=\" + this.loginParams.token;\r\n  }\r\n}\r\n\r\nexport default new Store();\r\n","class TxRoom {\r\n    constructor() {\r\n        // this.serverDomain = 'https://fspwxlite.hst.com:443/weapp/webrtc_room';\r\n        // this.serverDomain = 'https://fspwxlite.haoshitong.com:8443/weapp/webrtc_room';\r\n        // this.serverDomain = 'https://xiaochengxu.haoshitong.com:8443';\r\n        this.serverDomain = '';\r\n        // 生产环境\r\n        // this.serverDomain = 'https://wxlite-webrtc.hst.com';\r\n        this.appId = ''\r\n        this.isPass = false\r\n        this.sessionId = ''\r\n        this.requestNum = 0;\r\n        this.heart = 0; // 判断心跳变量\r\n        this.heartBeatReq = 0;\r\n        this.requestSeq = 0; // 请求id\r\n        this.requestTask = []; // 请求task\r\n    }\r\n  \r\n    /**\r\n     * [request 封装request请求]\r\n     * @param {options}\r\n     *   url: 请求接口url\r\n     *   data: 请求参数\r\n     *   success: 成功回调\r\n     *   fail: 失败回调\r\n     *   complete: 完成回调\r\n     */\r\n    request(options) {\r\n      var self = this;\r\n      self.requestNum++;\r\n      if (!this.isPass && !this.sessionId) {\r\n        self.getSessionId(options);\r\n        return\r\n      }\r\n      var req = wx.request({\r\n        url: self.serverDomain + options.url,\r\n        data: options.data || {},\r\n        method: 'POST',\r\n        header: {\r\n          'content-type': 'application/json', // 默认值\r\n          sessionId: this.sessionId\r\n        },\r\n        // dataType: 'json',\r\n        success: function (res) {\r\n          if (!self.isPass && 401 == res.statusCode){\r\n            self.getSessionId(options)\r\n            return\r\n          }\r\n          if (res.data.code) {\r\n            console.error('服务器请求失败' + ', url=' + options.url + ', params = ' + (options.data ? JSON.stringify(options.data) : '') + ', 错误信息=' + JSON.stringify(res));\r\n            options.fail && options.fail({\r\n              errCode: res.data.code,\r\n              errMsg: res.data.message\r\n            })\r\n          } else {\r\n            options.success && options.success(res);\r\n          }\r\n        },\r\n        fail: function (res) {\r\n          console.error('请求失败' + ', url=' + options.url + ', 错误信息=' + JSON.stringify(res));\r\n          options.fail && options.fail(res);\r\n        },\r\n        complete: function () {\r\n          self.requestNum--;\r\n          console.log('complete requestNum: ', self.requestNum);\r\n        }\r\n      });\r\n      self.requestTask[self.requestSeq++] = req;\r\n      return req;\r\n    }\r\n  \r\n    /**\r\n     * [clearRequest 中断请求]\r\n     * @param {options}\r\n     */\r\n    clearRequest() {\r\n      var self = this;\r\n      for (var i = 0; i < self.requestSeq; i++) {\r\n        self.requestTask[i].abort();\r\n      }\r\n      self.requestTask = [];\r\n      self.requestSeq = 0;\r\n    }\r\n\r\n    /**\r\n   * 登录\r\n   */\r\n    getSessionId(options) {\r\n      var self = this;\r\n      wx.login({\r\n        success: res_login => {\r\n          if (!res_login.code) {\r\n            return\r\n          }\r\n          wx.request({\r\n            url: self.serverDomain + '/wx/toLogin',\r\n            data: { //wxfe13865e106f19fb\r\n              appid: this.appId,\r\n              code: res_login.code\r\n            },\r\n            method: 'POST',\r\n            header: {\r\n              'content-type': 'application/json' // 默认值\r\n            },\r\n            success: (res)=> {            \r\n              this.sessionId = res.data.result.sessionId\r\n              options && self.request(options);\r\n            },\r\n            fail: (err)=> {console.error('getSessionId err', err)}\r\n          })\r\n        }\r\n      })\r\n    }\r\n  \r\n    getLoginInfo(userID, success, fail) {\r\n      var self = this;\r\n      var data = {};\r\n      if (userID) {\r\n        data.userID = userID;\r\n      }\r\n      self.request({\r\n        url: '/weapp/webrtc_room/get_login_info',\r\n        data: data,\r\n        success: success,\r\n        fail: fail\r\n      })\r\n    }\r\n  \r\n    getRoomList(index, count, success, fail) {\r\n      var self = this;\r\n      self.request({\r\n        url: '/weapp/webrtc_room/get_room_list',\r\n        data: {\r\n          index: index,\r\n          count: count,\r\n          roomType: 'trtc'\r\n        },\r\n        success: success,\r\n        fail: fail\r\n      })\r\n    }\r\n  \r\n    createRoom(userID, roomInfo, success, fail) {\r\n      console.log('roomInfo', roomInfo);\r\n      var self = this;\r\n      self.request({\r\n        url: '/weapp/webrtc_room/create_room',\r\n        data: {\r\n          userID: userID,\r\n          roomInfo: roomInfo,\r\n          roomType: 'trtc'\r\n        },\r\n  \r\n        success: function (res) {\r\n          success && success(res);\r\n        },\r\n  \r\n        fail: fail\r\n      });\r\n    }\r\n  \r\n    enterRoom(userID, roomID, success, fail) {\r\n      var self = this;\r\n      self.request({\r\n        url: '/weapp/webrtc_room/enter_room',\r\n        data: {\r\n          userID: userID,\r\n          roomID: roomID\r\n        },\r\n        success: function (res) {\r\n          success && success(res);\r\n        },\r\n        fail: fail\r\n      })\r\n    }\r\n  \r\n    quitRoom(userID, roomID, success, fail) {\r\n      var self = this;\r\n      self.request({\r\n        url: '/weapp/webrtc_room/quit_room',\r\n        data: {\r\n          userID: userID,\r\n          roomID: roomID\r\n        },\r\n        success: success,\r\n        fail: fail\r\n      });\r\n      // self.stopHeartBeat();\r\n    }\r\n  \r\n    startHeartBeat(userID, roomID, success, fail) {\r\n      var self = this;\r\n      self.heart = '1';\r\n      self.heartBeat(userID, roomID, success, fail);\r\n    }\r\n  \r\n    stopHeartBeat() {\r\n      var self = this;\r\n      self.heart = '';\r\n      if (self.heartBeatReq) {\r\n        console.log('停止心跳');\r\n        self.heartBeatReq.abort();\r\n        self.heartBeatReq = null;\r\n      }\r\n    }\r\n  \r\n    heartBeat(userID, roomID, success, fail) {\r\n      var self = this;\r\n      if (!self.heart) {\r\n        self.clearRequest();\r\n        return;\r\n      }\r\n      self.heartBeatReq = self.request({\r\n        url: '/weapp/webrtc_room/heartbeat',\r\n        data: {\r\n          userID: userID,\r\n          roomID: roomID\r\n        },\r\n        success: function (res) {\r\n          if (self.heart) {\r\n            console.log('心跳成功');\r\n            success && success(res);\r\n            setTimeout(() => {\r\n              self.heartBeat(userID, roomID, success, fail);\r\n            }, 7000);\r\n          }\r\n        },\r\n        fail: function (res) {\r\n          fail && fail(res);\r\n          if (self.heart) {\r\n            setTimeout(() => {\r\n              self.heartBeat(userID, roomID, success, fail);\r\n            }, 7000);\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n  \r\n  export default new TxRoom();\r\n  "],"sourceRoot":""}